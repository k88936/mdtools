import{g as $r}from"./_commonjsHelpers-CE1G-McA.js";function Kr(et,tt){for(var ke=0;ke<tt.length;ke++){const de=tt[ke];if(typeof de!="string"&&!Array.isArray(de)){for(const te in de)if(te!=="default"&&!(te in et)){const Qe=Object.getOwnPropertyDescriptor(de,te);Qe&&Object.defineProperty(et,te,Qe.get?Qe:{enumerable:!0,get:()=>de[te]})}}}return Object.freeze(Object.defineProperty(et,Symbol.toStringTag,{value:"Module"}))}var hr={},lr;function ei(){return lr||(lr=1,(function(){var et={401:function(de,te){MathJax._.components.global.isObject,MathJax._.components.global.combineConfig,te.PV=MathJax._.components.global.combineDefaults,MathJax._.components.global.combineWithMathJax,te.NI=MathJax._.components.global.MathJax},771:function(de,te){te.v=MathJax._.core.MmlTree.MML.MML},376:function(de,te){te.Ls=MathJax._.core.MmlTree.MmlNode.TEXCLASS,MathJax._.core.MmlTree.MmlNode.TEXCLASSNAMES,MathJax._.core.MmlTree.MmlNode.indentAttributes,te.oI=MathJax._.core.MmlTree.MmlNode.AbstractMmlNode,MathJax._.core.MmlTree.MmlNode.AbstractMmlTokenNode,MathJax._.core.MmlTree.MmlNode.AbstractMmlLayoutNode,MathJax._.core.MmlTree.MmlNode.AbstractMmlBaseNode,MathJax._.core.MmlTree.MmlNode.AbstractMmlEmptyNode,MathJax._.core.MmlTree.MmlNode.TextNode,MathJax._.core.MmlTree.MmlNode.XMLNode},226:function(de,te){MathJax._.util.BBox.BBoxStyleAdjust,te.bK=MathJax._.util.BBox.BBox},238:function(de,te){te.VK=MathJax._.input.tex.Configuration.Configuration,MathJax._.input.tex.Configuration.ConfigurationHandler,MathJax._.input.tex.Configuration.ParserConfiguration},953:function(de,te){te.Z=MathJax._.input.tex.ParseMethods.default},166:function(de,te){MathJax._.input.tex.SymbolMap.AbstractSymbolMap,MathJax._.input.tex.SymbolMap.RegExpMap,MathJax._.input.tex.SymbolMap.AbstractParseMap,MathJax._.input.tex.SymbolMap.CharacterMap,MathJax._.input.tex.SymbolMap.DelimiterMap,MathJax._.input.tex.SymbolMap.MacroMap,te.QQ=MathJax._.input.tex.SymbolMap.CommandMap,te.QM=MathJax._.input.tex.SymbolMap.EnvironmentMap},847:function(de,te){te.Z=MathJax._.input.tex.TexError.default},789:function(de,te){te.Z=MathJax._.input.tex.TexParser.default},361:function(de,te){te.Z=MathJax._.input.tex.base.BaseMethods.default},81:function(de,te){MathJax._.output.chtml.Wrapper.FONTSIZE,MathJax._.output.chtml.Wrapper.SPACE,te.wO=MathJax._.output.chtml.Wrapper.CHTMLWrapper},748:function(de,te){te.w=MathJax._.output.chtml.Wrappers_ts.CHTMLWrappers},952:function(de,te){te.y=MathJax._.output.svg.Wrapper.SVGWrapper},84:function(de,te){te.N=MathJax._.output.svg.Wrappers_ts.SVGWrappers}},tt={};function ke(de){var te=tt[de];if(te!==void 0)return te.exports;var Qe=tt[de]={exports:{}};return et[de](Qe,Qe.exports,ke),Qe.exports}(function(){var de=ke(401);(0,de.PV)(de.NI._,"output",{common:{Wrapper:{}},chtml:{Wrapper:{},Wrappers_ts:{}},svg:{Wrapper:{},Wrappers_ts:{}}});var te=ke(238),Qe=ke(166),pr=ke(361),fr=ke(953),dr=ke(789),yr=ke(847);function ye(e,t){return console.error(e,t),new yr.Z(e,t)}var Be={whiteSpaceRegex:/^(\s+|%[^\r\n]*(\r\n|\r|\n)?)+/,lengthResolution:128,interpolationResolution:5,machinePrecision:1e-12};function Qt(e){return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qt(e)}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function En(e,t,n){return t&&An(e.prototype,t),n&&An(e,n),e}function Ln(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_t(e,t)}function _t(e,t){return _t=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},_t(e,t)}function jn(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=ht(e);if(t){var i=ht(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return vr(this,n)}}function vr(e,t){if(t&&(Qt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function ht(e){return ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ht(e)}function Wt(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var G=function e(){Wt(this,e)},Dn=(function(e){Ln(n,e);var t=jn(n);function n(r){var i;return Wt(this,n),(i=t.call(this)).get=r,i}return En(n,[{key:"isEmpty",get:function(){return!1}},{key:"isDefined",get:function(){return!0}},{key:"getOrElse",value:function(r){return this.get}},{key:"flatMap",value:function(r){return r(this.get)}},{key:"map",value:function(r){return new n(r(this.get))}},{key:"foreach",value:function(r){r(this.get)}},{key:"toString",value:function(){return"Some("+this.get+")"}}],[{key:"unapply",value:function(r){return new n(r.get)}}]),n})(G),Tn=(function(e){Ln(n,e);var t=jn(n);function n(){return Wt(this,n),t.call(this)}return En(n,[{key:"isEmpty",get:function(){return!0}},{key:"isDefined",get:function(){return!1}},{key:"getOrElse",value:function(r){return r}},{key:"flatMap",value:function(r){return this}},{key:"foreach",value:function(r){}},{key:"map",value:function(r){return this}},{key:"toString",value:function(){return"None"}}],[{key:"unapply",value:function(r){return new Dn(r)}}]),n})(G);function Nt(e){return Nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt(e)}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fn(e,t,n){return t&&Rn(e.prototype,t),n&&Rn(e,n),e}function Gn(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}function Ut(e,t){return Ut=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Ut(e,t)}function Vn(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=lt(e);if(t){var i=lt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return xr(this,n)}}function xr(e,t){if(t&&(Nt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function lt(e){return lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},lt(e)}function Xt(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}G.Some=Dn,G.None=Tn,G.empty=new Tn;var j=function e(){Xt(this,e)},mt=(function(e){Gn(n,e);var t=Vn(n);function n(r,i){var a;return Xt(this,n),(a=t.call(this)).head=r,a.tail=i,a}return Fn(n,[{key:"isEmpty",get:function(){return!1}},{key:"at",value:function(r){if(r<0||r>=this.length())throw Error("no such element at "+r+". index must be lower than "+this.length()+".");for(var i=this,a=0;a<r;a++)i=i.tail;return i.head}},{key:"length",value:function(){for(var r=this,i=0;!r.isEmpty;)i++,r=r.tail;return i}},{key:"prepend",value:function(r){return new n(r,this)}},{key:"append",value:function(r){var i=new n(r,j.empty);return this.reverse().foreach((function(a){i=new n(a,i)})),i}},{key:"concat",value:function(r){var i=r;return this.reverse().foreach((function(a){i=new n(a,i)})),i}},{key:"foldLeft",value:function(r,i){var a,s;for(a=i(r,this.head),s=this.tail;!s.isEmpty;)a=i(a,s.head),s=s.tail;return a}},{key:"foldRight",value:function(r,i){return this.tail.isEmpty?i(this.head,r):i(this.head,this.tail.foldRight(r,i))}},{key:"map",value:function(r){return new n(r(this.head),this.tail.map(r))}},{key:"flatMap",value:function(r){return r(this.head).concat(this.tail.flatMap(r))}},{key:"foreach",value:function(r){for(var i=this;!i.isEmpty;)r(i.head),i=i.tail}},{key:"reverse",value:function(){var r=j.empty;return this.foreach((function(i){r=new n(i,r)})),r}},{key:"mkString",value:function(){var r,i,a,s,c;switch(arguments.length){case 0:r=i=a="";break;case 1:i=arguments[0],r=a="";break;case 2:r=arguments[0],i=arguments[1],a="";break;default:r=arguments[0],i=arguments[1],a=arguments[2]}for(s=r+this.head.toString(),c=this.tail;c instanceof n;)s+=i+c.head.toString(),c=c.tail;return s+=a}},{key:"toString",value:function(){return this.mkString("[",", ","]")}}],[{key:"unapply",value:function(r){return new G.Some([r.head,r.tail])}}]),n})(j);j.Cons=mt;var In=(function(e){Gn(n,e);var t=Vn(n);function n(){return Xt(this,n),t.call(this)}return Fn(n,[{key:"isEmpty",get:function(){return!0}},{key:"at",value:function(r){throw Error("cannot get element from an empty list.")}},{key:"length",value:function(){return 0}},{key:"prepend",value:function(r){return new mt(r,j.empty)}},{key:"append",value:function(r){return new mt(r,j.empty)}},{key:"concat",value:function(r){return r}},{key:"foldLeft",value:function(r,i){return r}},{key:"foldRight",value:function(r,i){return r}},{key:"flatMap",value:function(r){return this}},{key:"map",value:function(r){return this}},{key:"foreach",value:function(r){}},{key:"reverse",value:function(){return this}},{key:"mkString",value:function(){switch(arguments.length){case 0:case 1:return"";case 2:return arguments[0];default:return arguments[0]+arguments[2]}}},{key:"toString",value:function(){return"[]"}}],[{key:"unapply",value:function(r){return new G.Some(r)}}]),n})(j);function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}j.Nil=In,j.empty=new In,j.fromArray=function(e){var t,n;for(t=j.empty,n=e.length-1;n>=0;)t=new mt(e[n],t),--n;return t};var pt=(function(){function e(i,a){(function(s,c){if(!(s instanceof c))throw TypeError("Cannot call a class as a function")})(this,e),this.head=i,this.tail=a}var t,n,r;return t=e,r=[{key:"unapply",value:function(i){return new Option.Some([i.head,i.tail])}}],(n=[{key:"toString",value:function(){return"("+this.head+"~"+this.tail+")"}}])&&zn(t.prototype,n),r&&zn(t,r),e})();function Qn(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _n(e,t,n){return t&&gr(e.prototype,t),e}var wr=(function(){function e(){Qn(this,e),this.cases=[]}return _n(e,[{key:"Case",value:function(t,n){return this.cases.push([t,n]),this}},{key:"match",value:function(t){var n,r,i,a;for(n=0,r=this.cases.length;n<r;){if(t instanceof(i=this.cases[n][0])&&(a=i.unapply(t)).isDefined)return this.cases[n][1](a.get);n+=1}throw new Ht(t)}}]),e})(),Ht=(function(){function e(t){Qn(this,e),this.obj=t}return _n(e,[{key:"toString",value:function(){return"MatchError("+this.obj+")"}}]),e})();function qt(e){return qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(e)}function nt(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jt(e,t)}function Jt(e,t){return Jt=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Jt(e,t)}function rt(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=ft(e);if(t){var i=ft(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Sr(this,n)}}function Sr(e,t){if(t&&(qt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function ft(e){return ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(e)}function _e(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(e,t,n){return t&&Wn(e.prototype,t),n&&Wn(e,n),e}var br=(function(){function e(t,n){_e(this,e),this.source=t,this.offset=n===void 0?0:n,this._index=null,this._line=null}return We(e,[{key:"index",value:function(){if(this._index!==null)return this._index;this._index=[],this._index.push(0);for(var t=0;t<this.source.length;)this.source.charAt(t)===`
`&&this._index.push(t+1),t+=1;return this._index.push(this.source.length),this._index}},{key:"line",value:function(){var t,n,r;if(this._line!==null)return this._line;for(t=0,n=this.index().length-1;t+1<n;)r=n+t>>1,this.offset<this.index()[r]?n=r:t=r;return this._line=t+1,this._line}},{key:"column",value:function(){return this.offset-this.index()[this.line()-1]+1}},{key:"lineContents",value:function(){var t,n;return t=this.index(),n=this.line(),this.source.substring(t[n-1],t[n])}},{key:"toString",value:function(){return this.line().toString()+"."+this.column()}},{key:"longString",value:function(){var t,n;for(t=this.lineContents()+`
`,n=0;n<this.column();)this.lineContents().charAt(n)==="	"?t+="	":t+=" ",n+=1;return t+="^"}},{key:"isLessThan",value:function(t){return t instanceof e?this.offset<t.offset:this.line()<t.line()||this.line()===t.line()&&this.column()<t.column()}}]),e})(),dt=(function(){function e(t,n,r){_e(this,e),this.source=t,this.offset=n,this.context=r}return We(e,[{key:"first",value:function(){return this.offset<this.source.length?this.source.charAt(this.offset):e.EofCh}},{key:"rest",value:function(){return this.offset<this.source.length?new e(this.source,this.offset+1,this.context):this}},{key:"pos",value:function(){return new br(this.source,this.offset)}},{key:"atEnd",value:function(){return this.offset>=this.source.length}},{key:"drop",value:function(t){var n,r;for(n=this,r=t;r>0;)n=n.rest(),--r;return n}}]),e})();dt.EofCh="";var se=(function(){function e(){_e(this,e)}return We(e,null,[{key:"parse",value:function(t,n){return t.apply(n)}},{key:"parseAll",value:function(t,n){return t.andl((function(){return e.eos()})).apply(n)}},{key:"parseString",value:function(t,n){var r=new dt(n,0,{lastNoSuccess:void 0});return e.parse(t,r)}},{key:"parseAllString",value:function(t,n){var r=new dt(n,0,{lastNoSuccess:void 0});return e.parseAll(t,r)}},{key:"_handleWhiteSpace",value:function(t){var n=t.context.whiteSpaceRegex,r=t.source,i=t.offset,a=n.exec(r.substring(i,r.length));return a===null?i:i+a[0].length}},{key:"literal",value:function(t){return new Oe((function(n){var r,i,a,s,c,l;for(r=n.source,i=n.offset,s=0,c=a=e._handleWhiteSpace(n);s<t.length&&c<r.length&&t.charAt(s)===r.charAt(c);)s+=1,c+=1;return s===t.length?new Ee(t,n.drop(c-i)):(l=a===r.length?"end of source":"`"+r.charAt(a)+"'",new Ne("`"+t+"' expected but "+l+" found",n.drop(a-i)))}))}},{key:"regex",value:function(t){if(t.toString().substring(0,2)!=="/^")throw"regex must start with `^' but "+t;return new Oe((function(n){var r,i,a,s;return r=n.source,i=n.offset,(a=t.exec(r.substring(i,r.length)))===null?(s=i===r.length?"end of source":"`"+r.charAt(i)+"'",new Ne("string matching regex "+t+" expected but "+s+" found",n)):new Ee(a[0],n.drop(a[0].length))}))}},{key:"regexLiteral",value:function(t){if(t.toString().substring(0,2)!=="/^")throw"regex must start with `^' but "+t;return new Oe((function(n){var r,i,a,s,c;return r=n.source,i=n.offset,a=e._handleWhiteSpace(n),(s=t.exec(r.substring(a,r.length)))===null?(c=a===r.length?"end of source":"`"+r.charAt(a)+"'",new Ne("string matching regex "+t+" expected but "+c+" found",n.drop(a-i))):new Ee(s[0],n.drop(a+s[0].length-i))}))}},{key:"eos",value:function(){return new Oe((function(t){var n,r;return n=t.source,t.offset,r=e._handleWhiteSpace(t),n.length===r?new Ee("",t):new Ne("end of source expected but `"+n.charAt(r)+"' found",t)}))}},{key:"commit",value:function(t){return new Oe((function(n){var r=t()(n);return new wr().Case(Ee,(function(i){return r})).Case(it,(function(i){return r})).Case(Ne,(function(i){return new it(i[0],i[1])})).match(r)}))}},{key:"elem",value:function(t){return e.accept(t).named('"'+t+'"')}},{key:"accept",value:function(t){return e.acceptIf((function(n){return n===t}),(function(n){return"`"+t+"' expected but `"+n+"' found"}))}},{key:"acceptIf",value:function(t,n){return new Oe((function(r){return t(r.first())?new Ee(r.first(),r.rest()):new Ne(n(r.first()),r)}))}},{key:"failure",value:function(t){return new Oe((function(n){return new Ne(t,n)}))}},{key:"err",value:function(t){return new Oe((function(n){return new it(t,n)}))}},{key:"success",value:function(t){return new Oe((function(n){return new Ee(t,n)}))}},{key:"log",value:function(t,n){return new Oe((function(r){console.log("trying "+n+" at "+r);var i=t().apply(r);return console.log(n+" --> "+i),i}))}},{key:"rep",value:function(t){var n=e.success(j.empty);return e.rep1(t).or((function(){return n}))}},{key:"rep1",value:function(t){return new Oe((function(n){var r,i,a,s;if(r=[],i=n,(s=(a=t()).apply(n))instanceof Ee){for(;s instanceof Ee;)r.push(s.result),i=s.next,s=a.apply(i);return new Ee(j.fromArray(r),i)}return s}))}},{key:"repN",value:function(t,n){return t===0?e.success(FP.List.empty):new Oe((function(r){var i,a,s,c;for(i=[],a=r,c=(s=n()).apply(a);c instanceof Ee;){if(i.push(c.result),a=c.next,t===i.length)return new Ee(j.fromArray(i),a);c=s.apply(a)}return c}))}},{key:"repsep",value:function(t,n){var r=e.success(j.empty);return e.rep1sep(t,n).or((function(){return r}))}},{key:"rep1sep",value:function(t,n){return t().and(e.rep(n().andr(t))).to((function(r){return new j.Cons(r.head,r.tail)}))}},{key:"chainl1",value:function(t,n,r){return t().and(e.rep(r().and(n))).to((function(i){return i.tail.foldLeft(i.head,(function(a,s){return s.head(a,s.tail)}))}))}},{key:"chainr1",value:function(t,n,r,i){return t().and(this.rep(n().and(t))).to((function(a){return new j.Cons(new pt(r,a.head),a.tail).foldRight(i,(function(s,c){return s.head(s.tail,c)}))}))}},{key:"opt",value:function(t){return t().to((function(n){return new G.Some(n)})).or((function(){return e.success(G.empty)}))}},{key:"not",value:function(t){return new Oe((function(n){return t().apply(n).successful?new Ne("Expected failure",n):new Ee(G.empty,n)}))}},{key:"guard",value:function(t){return new Oe((function(n){var r=t().apply(n);return r.successful?new Ee(r.result,n):r}))}},{key:"mkList",value:function(t){return new j.Cons(t.head,t.tail)}},{key:"fun",value:function(t){return function(){return t}}},{key:"lazyParser",value:function(t){var n,r;return t instanceof String||typeof t=="string"?(n=e.literal(t),function(){return n}):t instanceof Function?t:t instanceof Object?t instanceof Oe?function(){return t}:t instanceof RegExp?(r=e.regexLiteral(t),function(){return r}):e.err("unhandlable type"):e.err("unhandlable type")}},{key:"seq",value:function(){var t,n,r;if((t=arguments.length)===0)return e.err("at least one element must be specified");for(n=e.lazyParser(arguments[0])(),r=1;r<t;)n=n.and(e.lazyParser(arguments[r])),r+=1;return n}},{key:"or",value:function(){var t,n,r;if((t=arguments.length)===0)return e.err("at least one element must be specified");for(n=e.lazyParser(arguments[0])(),r=1;r<t;)n=n.or(e.lazyParser(arguments[r])),r+=1;return n}}]),e})(),Zt=(function(){function e(){_e(this,e)}return We(e,[{key:"isEmpty",value:function(){return!this.successful}},{key:"getOrElse",value:function(t){return this.isEmpty?t():this.get()}}]),e})();se.ParseResult=Zt;var Ee=(function(e){nt(n,e);var t=rt(n);function n(r,i){var a;return _e(this,n),(a=t.call(this)).result=r,a.next=i,a}return We(n,[{key:"successful",get:function(){return!0}},{key:"map",value:function(r){return new n(r(this.result),this.next)}},{key:"mapPartial",value:function(r,i){try{return new n(r(this.result),this.next)}catch(a){if(a instanceof Ht)return new Ne(i(this.result),this.next);throw a}}},{key:"flatMapWithNext",value:function(r){return r(this.result).apply(this.next)}},{key:"append",value:function(r){return this}},{key:"get",value:function(){return this.result}},{key:"toString",value:function(){return"["+this.next.pos()+"] parsed: "+this.result}}],[{key:"unapply",value:function(r){return new G.Some([r.result,r.next])}}]),n})(Zt);se.Success=Ee;var yt=(function(e){nt(n,e);var t=rt(n);function n(){return _e(this,n),t.call(this)}return We(n,[{key:"successful",get:function(){return!1}},{key:"_setLastNoSuccess",value:function(){var r=this.next.context;r.lastNoSuccess!==void 0&&this.next.pos().isLessThan(r.lastNoSuccess.next.pos())||(r.lastNoSuccess=this)}},{key:"map",value:function(r){return this}},{key:"mapPartial",value:function(r,i){return this}},{key:"flatMapWithNext",value:function(r){return this}},{key:"get",value:function(){return se.error("No result when parsing failed")}}]),n})(Zt);se.NoSuccess=yt;var Ne=(function(e){nt(n,e);var t=rt(n);function n(r,i){var a;return _e(this,n),(a=t.call(this)).msg=r,a.next=i,a._setLastNoSuccess(),a}return We(n,[{key:"append",value:function(r){var i=r();if(i instanceof Ee)return i;if(i instanceof yt)return i.next.pos().isLessThan(this.next.pos())?this:i;throw new Ht(i)}},{key:"toString",value:function(){return"["+this.next.pos()+"] failure: "+this.msg+`

`+this.next.pos().longString()}}],[{key:"unapply",value:function(r){return new G.Some([r.msg,r.next])}}]),n})(yt);se.Failure=Ne;var it=(function(e){nt(n,e);var t=rt(n);function n(r,i){var a;return _e(this,n),(a=t.call(this)).msg=r,a.next=i,a._setLastNoSuccess(),a}return We(n,[{key:"append",value:function(r){return this}},{key:"toString",value:function(){return"["+this.next.pos()+"] error: "+this.msg+`

`+this.next.pos().longString()}}],[{key:"unapply",value:function(r){return new G.Some([r.msg,r.next])}}]),n})(yt);se.ParseError=it;var Oe=(function(){function e(t){_e(this,e),this.apply=t,this.name=""}return We(e,[{key:"named",value:function(t){return this.name=t,this}},{key:"toString",value:function(){return"Parser ("+this.name+")"}},{key:"flatMap",value:function(t){var n=this;return new e((function(r){return n.apply(r).flatMapWithNext(t)}))}},{key:"map",value:function(t){var n=this;return new e((function(r){return n.apply(r).map(t)}))}},{key:"append",value:function(t){var n=this;return new e((function(r){return n.apply(r).append((function(){return t().apply(r)}))}))}},{key:"and",value:function(t){return this.flatMap((function(n){return t().map((function(r){return new pt(n,r)}))})).named("~")}},{key:"andr",value:function(t){return this.flatMap((function(n){return t().map((function(r){return r}))})).named("~>")}},{key:"andl",value:function(t){return this.flatMap((function(n){return t().map((function(r){return n}))})).named("<~")}},{key:"or",value:function(t){return this.append(t).named("|")}},{key:"andOnce",value:function(t){var n=this;return new Nn((function(){return n.flatMap((function(r){return se.commit(t).map((function(i){return new pt(r,i)}))})).named("~!")}))}},{key:"longestOr",value:function(t){var n=this;return new e((function(r){var i,a;return i=n.apply(r),a=t()(r),i.successful?a.successful?a.next.pos().isLessThan(i.next.pos())?i:a:i:a.successful?a:i instanceof it||a.next.pos().isLessThan(i.next.pos())?i:a})).named("|||")}},{key:"to",value:function(t){return this.map(t).named(this.toString()+"^^")}},{key:"ret",value:function(t){var n=this;return new e((function(r){return n.apply(r).map((function(i){return t()}))})).named(this.toString()+"^^^")}},{key:"toIfPossible",value:function(t,n){n===void 0&&(n=function(i){return"Constructor function not defined at "+i});var r=this;return new e((function(i){return r.apply(i).mapPartial(t,n)})).named(this.toString()+"^?")}},{key:"into",value:function(t){return this.flatMap(t)}},{key:"rep",value:function(){var t=this;return se.rep((function(){return t}))}},{key:"chain",value:function(t){var n,r;return n=this,r=function(){return n},se.chainl1(r,r,t)}},{key:"rep1",value:function(){var t=this;return se.rep1((function(){return t}))}},{key:"opt",value:function(){var t=this;return se.opt((function(){return t}))}}]),e})();se.Parser=Oe;var Nn=(function(e){nt(n,e);var t=rt(n);function n(r){return _e(this,n),t.call(this,r)}return We(n,[{key:"and",value:function(r){var i=this;return new n((function(){return i.flatMap((function(a){return se.commit(r).map((function(s){return pt(a,s)}))}))})).named("~")}}]),n})(Oe);se.OnceParser=Nn;var Yt=ke(376),$t=ke(771);function Un(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xn(e,t,n){return t&&Cr(e.prototype,t),e}var kr=(function(){function e(){Un(this,e),this.userDirMap={}}return Xn(e,[{key:"get",value:function(t){return this.userDirMap[t]}},{key:"put",value:function(t,n){this.userDirMap[t]=n}}]),e})(),Hn=(function(){function e(){Un(this,e),this.userModifierMap={}}return Xn(e,[{key:"get",value:function(t){var n=e.embeddedModifierMap[t];return n===void 0?this.userModifierMap[t]:n}},{key:"put",value:function(t,n){e.embeddedModifierMap[t]===void 0&&(this.userModifierMap[t]=n)}}]),e})(),o={repositories:{modifierRepository:new Hn,dirRepository:new kr},xypicCommandIdCounter:0,xypicCommandMap:{},textObjectIdCounter:0,wrapperOfTextObjectMap:{}};function Kt(e){return Kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(e)}function Mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&Mr(e.prototype,t),e}function W(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&en(e,t)}function en(e,t){return en=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},en(e,t)}function N(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=vt(e);if(t){var i=vt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Pr(this,n)}}function Pr(e,t){if(t&&(Kt(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function vt(e){return vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(e)}function g(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var u=function e(){g(this,e)},Ze=(function(e){W(n,e);var t=N(n);function n(r,i,a){var s;g(this,n),(s=t.call(this,r,i,a)).textMmls=a,s.texClass=Yt.Ls.ORD;var c=i["data-cmd-id"];s.cmd=o.xypicCommandMap[c];for(var l=JSON.parse(i["data-text-mml-ids"]),h=0,m=l.length;h<m;h++)a[h].xypicTextObjectId=l[h];return s}return n})(Yt.oI);Ze.defaults=Yt.oI.defaults,(u.xypic=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"kind",get:function(){return"xypic"}},{key:"toString",value:function(){return this.kind+"("+this.cmd+")"}}]),n})(Ze)).defaults=Ze.defaults,$t.v[u.xypic.prototype.kind]=u.xypic,u.xypic.newdir=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"kind",get:function(){return"xypic-newdir"}},{key:"toString",value:function(){return this.kind+"("+this.cmd+")"}}]),n})(Ze),u.xypic.newdir.defaults=Ze.defaults,$t.v[u.xypic.newdir.prototype.kind]=u.xypic.newdir,u.xypic.includegraphics=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"kind",get:function(){return"xypic-includegraphics"}},{key:"toString",value:function(){return this.kind+"("+this.cmd+")"}}]),n})(Ze),u.xypic.includegraphics.defaults=Ze.defaults,$t.v[u.xypic.includegraphics.prototype.kind]=u.xypic.includegraphics,u.PosDecor=(function(){function e(t,n){g(this,e),this.pos=t,this.decor=n}return S(e,[{key:"toString",value:function(){return this.pos.toString()+" "+this.decor}}]),e})(),(u.Pos=function e(){g(this,e)}).Coord=(function(){function e(t,n){g(this,e),this.coord=t,this.pos2s=n}return S(e,[{key:"toString",value:function(){return this.coord.toString()+" "+this.pos2s.mkString(" ")}}]),e})(),u.Pos.Plus=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"+("+this.coord+")"}}]),e})(),u.Pos.Minus=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"-("+this.coord+")"}}]),e})(),u.Pos.Skew=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"!("+this.coord+")"}}]),e})(),u.Pos.Cover=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return".("+this.coord+")"}}]),e})(),u.Pos.Then=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return",("+this.coord+")"}}]),e})(),u.Pos.SwapPAndC=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return";("+this.coord+")"}}]),e})(),u.Pos.SetBase=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return":("+this.coord+")"}}]),e})(),u.Pos.SetYBase=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"::("+this.coord+")"}}]),e})(),u.Pos.ConnectObject=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"**("+this.object+")"}}]),e})(),u.Pos.DropObject=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"*("+this.object+")"}}]),e})(),u.Pos.Place=(function(){function e(t){g(this,e),this.place=t}return S(e,[{key:"toString",value:function(){return"?("+this.place+")"}}]),e})(),u.Pos.PushCoord=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"@+("+this.coord+")"}}]),e})(),u.Pos.EvalCoordThenPop=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"@-("+this.coord+")"}}]),e})(),u.Pos.LoadStack=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"@=("+this.coord+")"}}]),e})(),u.Pos.DoCoord=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"@@("+this.coord+")"}}]),e})(),u.Pos.InitStack=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"@i"}}]),e})(),u.Pos.EnterFrame=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"@("}}]),e})(),u.Pos.LeaveFrame=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"@)"}}]),e})(),u.Pos.SavePos=(function(){function e(t){g(this,e),this.id=t}return S(e,[{key:"toString",value:function(){return'="'+this.id+'"'}}]),e})(),u.Pos.SaveMacro=(function(){function e(t,n){g(this,e),this.macro=t,this.id=n}return S(e,[{key:"toString",value:function(){return"=("+this.macro+' "'+this.id+'")'}}]),e})(),u.Pos.SaveBase=(function(){function e(t){g(this,e),this.id=t}return S(e,[{key:"toString",value:function(){return'=:"'+this.id+'"'}}]),e})(),u.Pos.SaveStack=(function(){function e(t){g(this,e),this.id=t}return S(e,[{key:"toString",value:function(){return'=@"'+this.id+'"'}}]),e})(),(u.Coord=function e(){g(this,e)}).Vector=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return this.vector.toString()}}]),e})(),u.Coord.C=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"c"}}]),e})(),u.Coord.P=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"p"}}]),e})(),u.Coord.X=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"x"}}]),e})(),u.Coord.Y=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"y"}}]),e})(),u.Coord.Id=(function(){function e(t){g(this,e),this.id=t}return S(e,[{key:"toString",value:function(){return'"'+this.id+'"'}}]),e})(),u.Coord.Group=(function(){function e(t){g(this,e),this.posDecor=t}return S(e,[{key:"toString",value:function(){return"{"+this.posDecor+"}"}}]),e})(),u.Coord.StackPosition=(function(){function e(t){g(this,e),this.number=t}return S(e,[{key:"toString",value:function(){return"s{"+this.number+"}"}}]),e})(),u.Coord.DeltaRowColumn=(function(){function e(t,n,r){g(this,e),this.prefix=t,this.dr=n,this.dc=r}return S(e,[{key:"toString",value:function(){return"["+(this.prefix===""?"":'"'+this.prefix+'"')+this.dr+","+this.dc+"]"}}]),e})(),u.Coord.Hops=(function(){function e(t,n){g(this,e),this.prefix=t,this.hops=n}return S(e,[{key:"toString",value:function(){return"["+(this.prefix===""?"":'"'+this.prefix+'"')+this.hops.mkString("")+"]"}}]),e})(),u.Coord.HopsWithPlace=(function(){function e(t,n,r){g(this,e),this.prefix=t,this.hops=n,this.place=r}return S(e,[{key:"toString",value:function(){return"["+(this.prefix===""?"":'"'+this.prefix+'"')+this.hops.mkString("")+this.place+"]"}}]),e})(),(u.Vector=function e(){g(this,e)}).InCurBase=(function(){function e(t,n){g(this,e),this.x=t,this.y=n}return S(e,[{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}}]),e})(),u.Vector.Abs=(function(){function e(t,n){g(this,e),this.x=t,this.y=n}return S(e,[{key:"toString",value:function(){return"<"+this.x+", "+this.y+">"}}]),e})(),u.Vector.Angle=(function(){function e(t){g(this,e),this.degree=t}return S(e,[{key:"toString",value:function(){return"a("+this.degree+")"}}]),e})(),u.Vector.Dir=(function(){function e(t,n){g(this,e),this.dir=t,this.dimen=n}return S(e,[{key:"toString",value:function(){return"/"+this.dir+" "+this.dimen+"/"}}]),e})(),u.Vector.Corner=(function(){function e(t,n){g(this,e),this.corner=t,this.factor=n}return S(e,[{key:"toString",value:function(){return this.corner.toString()+"("+this.factor+")"}}]),e})(),(u.Corner=function e(){g(this,e)}).L=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"L"}}]),e})(),u.Corner.R=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"R"}}]),e})(),u.Corner.D=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"D"}}]),e})(),u.Corner.U=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"U"}}]),e})(),u.Corner.CL=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"CL"}}]),e})(),u.Corner.CR=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"CR"}}]),e})(),u.Corner.CD=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"CD"}}]),e})(),u.Corner.CU=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"CU"}}]),e})(),u.Corner.LD=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"LD"}}]),e})(),u.Corner.RD=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"RD"}}]),e})(),u.Corner.LU=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"LU"}}]),e})(),u.Corner.RU=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"RU"}}]),e})(),u.Corner.NearestEdgePoint=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"E"}}]),e})(),u.Corner.PropEdgePoint=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"P"}}]),e})(),u.Corner.Axis=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"A"}}]),e})(),(u.Place=(function(){function e(t,n,r,i){g(this,e),this.shaveP=t,this.shaveC=n,this.factor=r,this.slide=i}return S(e,[{key:"compound",value:function(t){return new u.Place(this.shaveP+t.shaveP,this.shaveC+t.shaveC,t.factor===void 0?this.factor:t.factor,t.slide)}},{key:"toString",value:function(){for(var t="",n=0;n<this.shaveP;n++)t+="<";for(var r=0;r<this.shaveC;r++)t+=">";return this.factor!==void 0&&(t+="("+this.factor+")"),this.slide.dimen.foreach((function(i){t+="/"+i+"/"})),t}}]),e})()).Factor=(function(){function e(t){g(this,e),this.factor=t}return S(e,[{key:"isIntercept",get:function(){return!1}},{key:"toString",value:function(){return this.factor.toString()}}]),e})(),u.Place.Intercept=(function(){function e(t){g(this,e),this.pos=t}return S(e,[{key:"isIntercept",get:function(){return!0}},{key:"toString",value:function(){return"!{"+this.pos+"}"}}]),e})(),u.Slide=(function(){function e(t){g(this,e),this.dimen=t}return S(e,[{key:"toString",value:function(){return this.dimen.getOrElse("")}}]),e})(),u.Object=(function(){function e(t,n){g(this,e),this.modifiers=t,this.object=n}return S(e,[{key:"dirVariant",value:function(){return this.object.dirVariant()}},{key:"dirMain",value:function(){return this.object.dirMain()}},{key:"isDir",value:function(){return this.object.isDir()}},{key:"toString",value:function(){return this.modifiers.mkString()+this.object.toString()}}]),e})(),(u.ObjectBox=(function(){function e(){g(this,e)}return S(e,[{key:"isEmpty",get:function(){return!1}},{key:"dirVariant",value:function(){}},{key:"dirMain",value:function(){}},{key:"isDir",value:function(){return!1}}]),e})()).Text=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).math=r,i}return S(n,[{key:"toString",value:function(){return"{"+this.math.toString()+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Empty=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"isEmpty",get:function(){return!0}},{key:"toString",value:function(){return"{}"}}]),n})(u.ObjectBox),u.ObjectBox.Xymatrix=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).xymatrix=r,i}return S(n,[{key:"toString",value:function(){return this.xymatrix.toString()}}]),n})(u.ObjectBox),u.ObjectBox.Txt=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).width=r,a.textObject=i,a}return S(n,[{key:"toString",value:function(){return"\\txt"+this.width+"{"+this.textObject.toString()+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Txt.Width=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return n})(u.ObjectBox),u.ObjectBox.Txt.Width.Vector=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).vector=r,i}return S(n,[{key:"toString",value:function(){return this.vector.toString()}}]),n})(u.ObjectBox),u.ObjectBox.Txt.Width.Default=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return""}}]),n})(u.ObjectBox),u.ObjectBox.WrapUpObject=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).object=r,i}return S(n,[{key:"toString",value:function(){return"\\object"+this.object.toString()}}]),n})(u.ObjectBox),u.ObjectBox.CompositeObject=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).objects=r,i}return S(n,[{key:"toString",value:function(){return"\\composite{"+this.objects.mkString(" * ")+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Xybox=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).posDecor=r,i}return S(n,[{key:"toString",value:function(){return"\\xybox{"+this.posDecor.toString()+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Cir=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).radius=r,a.cir=i,a}return S(n,[{key:"toString",value:function(){return"\\cir"+this.radius+"{"+this.cir+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Cir.Radius=function e(){g(this,e)},u.ObjectBox.Cir.Radius.Vector=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return this.vector.toString()}}]),e})(),u.ObjectBox.Cir.Radius.Default=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.ObjectBox.Cir.Cir=function e(){g(this,e)},u.ObjectBox.Cir.Cir.Segment=(function(){function e(t,n,r){g(this,e),this.startDiag=t,this.orient=n,this.endDiag=r}return S(e,[{key:"toString",value:function(){return this.startDiag.toString()+this.orient+this.endDiag}}]),e})(),u.ObjectBox.Cir.Cir.Full=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.ObjectBox.Dir=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).variant=r,a.main=i,a}return S(n,[{key:"dirVariant",value:function(){return this.variant}},{key:"dirMain",value:function(){return this.main}},{key:"isDir",value:function(){return!0}},{key:"toString",value:function(){return"\\dir"+this.variant+"{"+this.main+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Curve=(function(e){W(n,e);var t=N(n);function n(r,i,a){var s;return g(this,n),(s=t.call(this)).modifiers=r,s.objects=i,s.poslist=a,s}return S(n,[{key:"dirVariant",value:function(){return""}},{key:"dirMain",value:function(){return"-"}},{key:"isDir",value:function(){return!1}},{key:"toString",value:function(){return"\\curve"+this.modifiers.mkString("")+"{"+this.objects.mkString(" ")+" "+this.poslist.mkString("&")+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Curve.Modifier=function e(){g(this,e)},u.ObjectBox.Curve.Modifier.p=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~p"}}]),e})(),u.ObjectBox.Curve.Modifier.P=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~P"}}]),e})(),u.ObjectBox.Curve.Modifier.l=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~l"}}]),e})(),u.ObjectBox.Curve.Modifier.L=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~L"}}]),e})(),u.ObjectBox.Curve.Modifier.c=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~c"}}]),e})(),u.ObjectBox.Curve.Modifier.C=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~C"}}]),e})(),u.ObjectBox.Curve.Modifier.pc=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~pc"}}]),e})(),u.ObjectBox.Curve.Modifier.pC=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~pC"}}]),e})(),u.ObjectBox.Curve.Modifier.Pc=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~Pc"}}]),e})(),u.ObjectBox.Curve.Modifier.PC=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~PC"}}]),e})(),u.ObjectBox.Curve.Modifier.lc=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~lc"}}]),e})(),u.ObjectBox.Curve.Modifier.lC=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~lC"}}]),e})(),u.ObjectBox.Curve.Modifier.Lc=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~Lc"}}]),e})(),u.ObjectBox.Curve.Modifier.LC=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~LC"}}]),e})(),u.ObjectBox.Curve.Modifier.cC=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~cC"}}]),e})(),u.ObjectBox.Curve.Object=function e(){g(this,e)},u.ObjectBox.Curve.Object.Drop=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"~*"+this.object}}]),e})(),u.ObjectBox.Curve.Object.Connect=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"~**"+this.object}}]),e})(),u.ObjectBox.Curve.PosList=function e(){g(this,e)},u.ObjectBox.Curve.PosList.CurPos=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.ObjectBox.Curve.PosList.Pos=(function(){function e(t){g(this,e),this.pos=t}return S(e,[{key:"toString",value:function(){return this.pos.toString()}}]),e})(),u.ObjectBox.Curve.PosList.AddStack=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~@"}}]),e})(),(u.Modifier=function e(){g(this,e)}).Vector=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).vector=r,i}return S(n,[{key:"toString",value:function(){return"!"+this.vector}}]),n})(u.Modifier),u.Modifier.RestoreOriginalRefPoint=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"!"}}]),n})(u.Modifier),u.Modifier.AddOp=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).op=r,a.size=i,a}return S(n,[{key:"toString",value:function(){return this.op.toString()+" "+this.size}}]),n})(u.Modifier),u.Modifier.AddOp.Grow=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"+"}}]),e})(),u.Modifier.AddOp.Shrink=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"-"}}]),e})(),u.Modifier.AddOp.Set=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"="}}]),e})(),u.Modifier.AddOp.GrowTo=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"+="}}]),e})(),u.Modifier.AddOp.ShrinkTo=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"-="}}]),e})(),u.Modifier.AddOp.VactorSize=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"isDefault",get:function(){return!1}},{key:"toString",value:function(){return this.vector.toString()}}]),e})(),u.Modifier.AddOp.DefaultSize=(function(){function e(){g(this,e)}return S(e,[{key:"isDefault",get:function(){return!0}},{key:"toString",value:function(){return""}}]),e})(),u.Modifier.Shape=function e(){g(this,e)},u.Modifier.Shape.Point=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[.]"}}]),n})(u.Modifier),u.Modifier.Shape.Rect=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[]"}}]),n})(u.Modifier),u.Modifier.Shape.Alphabets=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).alphabets=r,i}return S(n,[{key:"toString",value:function(){return"["+this.alphabets+"]"}}]),n})(u.Modifier),u.Modifier.Shape.DefineShape=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).shape=r,i}return S(n,[{key:"toString",value:function(){return"["+this.shape+"]"}}]),n})(u.Modifier),u.Modifier.Shape.Circle=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[o]"}}]),n})(u.Modifier),u.Modifier.Shape.L=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[l]"}}]),n})(u.Modifier),u.Modifier.Shape.R=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[r]"}}]),n})(u.Modifier),u.Modifier.Shape.U=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[u]"}}]),n})(u.Modifier),u.Modifier.Shape.D=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[d]"}}]),n})(u.Modifier),u.Modifier.Shape.C=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"[c]"}}]),n})(u.Modifier),u.Modifier.Shape.ChangeColor=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).colorName=r,i}return S(n,[{key:"toString",value:function(){return"["+this.colorName+"]"}}]),n})(u.Modifier),u.Modifier.Shape.CompositeModifiers=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).modifiers=r,i}return S(n,[{key:"toString",value:function(){return this.modifiers.mkString("")}}]),n})(u.Modifier),u.Modifier.Shape.Frame=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).main=r,a.options=i,a}return S(n,[{key:"toString",value:function(){return"[F"+this.main+this.options.mkString("")+"]"}}]),n})(u.Modifier),u.Modifier.Shape.Frame.Radius=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return":"+this.vector}}]),e})(),u.Modifier.Shape.Frame.Color=(function(){function e(t){g(this,e),this.colorName=t}return S(e,[{key:"toString",value:function(){return":"+this.colorName}}]),e})(),u.Modifier.Invisible=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"i"}}]),n})(u.Modifier),u.Modifier.Hidden=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"h"}}]),n})(u.Modifier),u.Modifier.Direction=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).direction=r,i}return S(n,[{key:"toString",value:function(){return this.direction.toString()}}]),n})(u.Modifier),(u.Direction=function e(){g(this,e)}).Compound=(function(){function e(t,n){g(this,e),this.dir=t,this.rots=n}return S(e,[{key:"toString",value:function(){return this.dir.toString()+this.rots.mkString()}}]),e})(),u.Direction.Diag=(function(){function e(t){g(this,e),this.diag=t}return S(e,[{key:"toString",value:function(){return this.diag.toString()}}]),e})(),u.Direction.Vector=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return"v"+this.vector.toString()}}]),e})(),u.Direction.ConstructVector=(function(){function e(t){g(this,e),this.posDecor=t}return S(e,[{key:"toString",value:function(){return"q{"+this.posDecor.toString()+"}"}}]),e})(),u.Direction.RotVector=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return":"+this.vector.toString()}}]),e})(),u.Direction.RotAntiCW=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"_"}}]),e})(),u.Direction.RotCW=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"^"}}]),e})(),(u.Diag=function e(){g(this,e)}).Default=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.Diag.Angle=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return this.symbol}}]),e})(),u.Diag.LD=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"ld"}},{key:"ang",get:function(){return-3*Math.PI/4}},{key:"turn",value:function(r){return r==="^"?new u.Diag.RD:new u.Diag.LU}}]),n})(u.Diag.Angle),u.Diag.RD=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"rd"}},{key:"ang",get:function(){return-Math.PI/4}},{key:"turn",value:function(r){return r==="^"?new u.Diag.RU:new u.Diag.LD}}]),n})(u.Diag.Angle),u.Diag.LU=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"lu"}},{key:"ang",get:function(){return 3*Math.PI/4}},{key:"turn",value:function(r){return r==="^"?new u.Diag.LD:new u.Diag.RU}}]),n})(u.Diag.Angle),u.Diag.RU=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"ru"}},{key:"ang",get:function(){return Math.PI/4}},{key:"turn",value:function(r){return r==="^"?new u.Diag.LU:new u.Diag.RD}}]),n})(u.Diag.Angle),u.Diag.L=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"l"}},{key:"ang",get:function(){return Math.PI}},{key:"turn",value:function(r){return r==="^"?new u.Diag.D:new u.Diag.U}}]),n})(u.Diag.Angle),u.Diag.R=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"r"}},{key:"ang",get:function(){return 0}},{key:"turn",value:function(r){return r==="^"?new u.Diag.U:new u.Diag.D}}]),n})(u.Diag.Angle),u.Diag.D=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"d"}},{key:"ang",get:function(){return-Math.PI/2}},{key:"turn",value:function(r){return r==="^"?new u.Diag.R:new u.Diag.L}}]),n})(u.Diag.Angle),u.Diag.U=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"symbol",get:function(){return"u"}},{key:"ang",get:function(){return Math.PI/2}},{key:"turn",value:function(r){return r==="^"?new u.Diag.L:new u.Diag.R}}]),n})(u.Diag.Angle),u.ObjectBox.Frame=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).radius=r,a.main=i,a}return S(n,[{key:"toString",value:function(){return"\\frm"+this.radius+"{"+this.main+"}"}}]),n})(u.ObjectBox),u.ObjectBox.Frame.Radius=function e(){g(this,e)},u.ObjectBox.Frame.Radius.Vector=(function(){function e(t){g(this,e),this.vector=t}return S(e,[{key:"toString",value:function(){return this.vector.toString()}}]),e})(),u.ObjectBox.Frame.Radius.Default=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.Decor=(function(){function e(t){g(this,e),this.commands=t}return S(e,[{key:"toString",value:function(){return this.commands.mkString(" ")}}]),e})(),(u.Command=function e(){g(this,e)}).Save=(function(){function e(t){g(this,e),this.pos=t}return S(e,[{key:"toString",value:function(){return"\\save "+this.pos}}]),e})(),u.Command.Restore=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"\\restore"}}]),e})(),u.Command.Pos=(function(){function e(t){g(this,e),this.pos=t}return S(e,[{key:"toString",value:function(){return"\\POS "+this.pos}}]),e})(),u.Command.AfterPos=(function(){function e(t,n){g(this,e),this.decor=t,this.pos=n}return S(e,[{key:"toString",value:function(){return"\\afterPOS{"+this.decor+"} "+this.pos}}]),e})(),u.Command.Drop=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"\\drop "+this.object}}]),e})(),u.Command.Connect=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"\\connect "+this.object}}]),e})(),u.Command.Relax=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"\\relax"}}]),e})(),u.Command.Ignore=(function(){function e(t,n){g(this,e),this.pos=t,this.decor=n}return S(e,[{key:"toString",value:function(){return"\\ignore{"+this.pos+" "+this.decor+"}"}}]),e})(),u.Command.ShowAST=(function(){function e(t,n){g(this,e),this.pos=t,this.decor=n}return S(e,[{key:"toString",value:function(){return"\\xyshowAST{"+this.pos+" "+this.decor+"}"}}]),e})(),u.Command.Path=(function(){function e(t){g(this,e),this.path=t}return S(e,[{key:"toString",value:function(){return"\\PATH "+this.path}}]),e})(),u.Command.AfterPath=(function(){function e(t,n){g(this,e),this.decor=t,this.path=n}return S(e,[{key:"toString",value:function(){return"\\afterPATH{"+this.decor+"} "+this.path}}]),e})(),u.Command.Path.Path=(function(){function e(t){g(this,e),this.pathElements=t}return S(e,[{key:"toString",value:function(){return this.pathElements.mkString("[",", ","]")}}]),e})(),u.Command.Path.SetBeforeAction=(function(){function e(t){g(this,e),this.posDecor=t}return S(e,[{key:"toString",value:function(){return"~={"+this.posDecor+"}"}}]),e})(),u.Command.Path.SetAfterAction=(function(){function e(t){g(this,e),this.posDecor=t}return S(e,[{key:"toString",value:function(){return"~/{"+this.posDecor+"}"}}]),e})(),u.Command.Path.AddLabelNextSegmentOnly=(function(){function e(t){g(this,e),this.labels=t}return S(e,[{key:"toString",value:function(){return"~<{"+this.labels+"}"}}]),e})(),u.Command.Path.AddLabelLastSegmentOnly=(function(){function e(t){g(this,e),this.labels=t}return S(e,[{key:"toString",value:function(){return"~>{"+this.labels+"}"}}]),e})(),u.Command.Path.AddLabelEverySegment=(function(){function e(t){g(this,e),this.labels=t}return S(e,[{key:"toString",value:function(){return"~+{"+this.labels+"}"}}]),e})(),u.Command.Path.StraightSegment=(function(){function e(t){g(this,e),this.segment=t}return S(e,[{key:"toString",value:function(){return"'"+this.segment}}]),e})(),u.Command.Path.TurningSegment=(function(){function e(t,n){g(this,e),this.turn=t,this.segment=n}return S(e,[{key:"toString",value:function(){return"`"+this.turn+" "+this.segment}}]),e})(),u.Command.Path.LastSegment=(function(){function e(t){g(this,e),this.segment=t}return S(e,[{key:"toString",value:function(){return this.segment.toString()}}]),e})(),u.Command.Path.Turn=function e(){g(this,e)},u.Command.Path.Turn.Diag=(function(){function e(t,n){g(this,e),this.diag=t,this.radius=n}return S(e,[{key:"toString",value:function(){return this.diag.toString()+" "+this.radius}}]),e})(),u.Command.Path.Turn.Cir=(function(){function e(t,n){g(this,e),this.cir=t,this.radius=n}return S(e,[{key:"toString",value:function(){return this.cir.toString()+" "+this.radius}}]),e})(),u.Command.Path.TurnRadius=function e(){g(this,e)},u.Command.Path.TurnRadius.Default=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return""}}]),e})(),u.Command.Path.TurnRadius.Dimen=(function(){function e(t){g(this,e),this.dimen=t}return S(e,[{key:"toString",value:function(){return"/"+this.dimen}}]),e})(),u.Command.Path.Segment=(function(){function e(t,n,r){g(this,e),this.pos=t,this.slide=n,this.labels=r}return S(e,[{key:"toString",value:function(){return this.pos.toString()+" "+this.slide+" "+this.labels}}]),e})(),u.Command.Path.Labels=(function(){function e(t){g(this,e),this.labels=t}return S(e,[{key:"toString",value:function(){return this.labels.mkString(" ")}}]),e})(),u.Command.Path.Label=function e(t,n,r){g(this,e),this.anchor=t,this.it=n,this.aliasOption=r},u.Command.Path.Label.Above=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"toString",value:function(){return"^("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}]),n})(u.Command.Path.Label),u.Command.Path.Label.Below=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"toString",value:function(){return"_("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}]),n})(u.Command.Path.Label),u.Command.Path.Label.At=(function(e){W(n,e);var t=N(n);function n(r,i,a){return g(this,n),t.call(this,r,i,a)}return S(n,[{key:"toString",value:function(){return"|("+this.anchor+" "+this.it+" "+this.aliasOption+")"}}]),n})(u.Command.Path.Label),u.Command.Ar=(function(){function e(t,n){g(this,e),this.forms=t,this.path=n}return S(e,[{key:"toString",value:function(){return"\\ar "+this.forms.mkString(" ")+" "+this.path}}]),e})(),u.Command.Ar.Form=function e(){g(this,e)},u.Command.Ar.Form.BuildArrow=(function(e){W(n,e);var t=N(n);function n(r,i,a,s){var c;return g(this,n),(c=t.call(this)).variant=r,c.tailTip=i,c.stemConn=a,c.headTip=s,c}return S(n,[{key:"toString",value:function(){return"@"+this.variant+"{"+this.tailTip.toString()+", "+this.stemConn.toString()+", "+this.headTip.toString()+"}"}}]),n})(u.Command.Ar.Form),u.Command.Ar.Form.ChangeVariant=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).variant=r,i}return S(n,[{key:"toString",value:function(){return"@"+this.variant}}]),n})(u.Command.Ar.Form),u.Command.Ar.Form.Tip=function e(){g(this,e)},u.Command.Ar.Form.Tip.Tipchars=(function(){function e(t){g(this,e),this.tipchars=t}return S(e,[{key:"toString",value:function(){return this.tipchars}}]),e})(),u.Command.Ar.Form.Tip.Object=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"*"+this.object}}]),e})(),u.Command.Ar.Form.Tip.Dir=(function(){function e(t){g(this,e),this.dir=t}return S(e,[{key:"toString",value:function(){return this.dir}}]),e})(),u.Command.Ar.Form.Conn=function e(){g(this,e)},u.Command.Ar.Form.Conn.Connchars=(function(){function e(t){g(this,e),this.connchars=t}return S(e,[{key:"toString",value:function(){return this.connchars}}]),e})(),u.Command.Ar.Form.Conn.Object=(function(){function e(t){g(this,e),this.object=t}return S(e,[{key:"toString",value:function(){return"*"+this.object}}]),e})(),u.Command.Ar.Form.Conn.Dir=(function(){function e(t){g(this,e),this.dir=t}return S(e,[{key:"toString",value:function(){return this.dir}}]),e})(),u.Command.Ar.Form.ChangeStem=(function(){function e(t){g(this,e),this.connchar=t}return S(e,[{key:"toString",value:function(){return"@"+this.connchar}}]),e})(),u.Command.Ar.Form.DashArrowStem=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"@!"}}]),e})(),u.Command.Ar.Form.CurveArrow=(function(){function e(t,n){g(this,e),this.direction=t,this.dist=n}return S(e,[{key:"toString",value:function(){return"@/"+this.direction+" "+this.dist+"/"}}]),e})(),u.Command.Ar.Form.CurveFitToDirection=(function(){function e(t,n){g(this,e),this.outDirection=t,this.inDirection=n}return S(e,[{key:"toString",value:function(){return"@("+this.outDirection+","+this.inDirection+")"}}]),e})(),u.Command.Ar.Form.CurveWithControlPoints=(function(){function e(t){g(this,e),this.coord=t}return S(e,[{key:"toString",value:function(){return"@`{"+this.coord+"}"}}]),e})(),u.Command.Ar.Form.AddShape=(function(){function e(t){g(this,e),this.shape=t}return S(e,[{key:"toString",value:function(){return"@["+this.shape+"]"}}]),e})(),u.Command.Ar.Form.AddModifiers=(function(){function e(t){g(this,e),this.modifiers=t}return S(e,[{key:"toString",value:function(){return"@*{"+this.modifiers.mkString(" ")+"}"}}]),e})(),u.Command.Ar.Form.Slide=(function(){function e(t){g(this,e),this.slideDimen=t}return S(e,[{key:"toString",value:function(){return"@<"+this.slideDimen+">"}}]),e})(),u.Command.Ar.Form.LabelAt=(function(){function e(t,n){g(this,e),this.anchor=t,this.it=n}return S(e,[{key:"toString",value:function(){return"|"+this.anchor+" "+this.it}}]),e})(),u.Command.Ar.Form.LabelAbove=(function(){function e(t,n){g(this,e),this.anchor=t,this.it=n}return S(e,[{key:"toString",value:function(){return"^"+this.anchor+" "+this.it}}]),e})(),u.Command.Ar.Form.LabelBelow=(function(){function e(t,n){g(this,e),this.anchor=t,this.it=n}return S(e,[{key:"toString",value:function(){return"_"+this.anchor+" "+this.it}}]),e})(),u.Command.Ar.Form.ReverseAboveAndBelow=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"@?"}}]),e})(),u.Command.Xymatrix=(function(){function e(t,n){g(this,e),this.setup=t,this.rows=n}return S(e,[{key:"toString",value:function(){return"\\xymatrix"+this.setup+`{
`+this.rows.mkString("",`\\\\
`,"")+`
}`}}]),e})(),u.Command.Xymatrix.Setup=function e(){g(this,e)},u.Command.Xymatrix.Setup.Prefix=(function(){function e(t){g(this,e),this.prefix=t}return S(e,[{key:"toString",value:function(){return'"'+this.prefix+'"'}}]),e})(),u.Command.Xymatrix.Setup.ChangeSpacing=function e(t,n){g(this,e),this.addop=t,this.dimen=n},u.Command.Xymatrix.Setup.ChangeSpacing.Row=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@R"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.ChangeSpacing),u.Command.Xymatrix.Setup.ChangeSpacing.Column=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@C"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.ChangeSpacing),u.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.ChangeSpacing),u.Command.Xymatrix.Setup.PretendEntrySize=function e(t){g(this,e),this.dimen=t},u.Command.Xymatrix.Setup.PretendEntrySize.Height=(function(e){W(n,e);var t=N(n);function n(r){return g(this,n),t.call(this,r)}return S(n,[{key:"toString",value:function(){return"@!R="+this.dimen}}]),n})(u.Command.Xymatrix.Setup.PretendEntrySize),u.Command.Xymatrix.Setup.PretendEntrySize.Width=(function(e){W(n,e);var t=N(n);function n(r){return g(this,n),t.call(this,r)}return S(n,[{key:"toString",value:function(){return"@!C="+this.dimen}}]),n})(u.Command.Xymatrix.Setup.PretendEntrySize),u.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth=(function(e){W(n,e);var t=N(n);function n(r){return g(this,n),t.call(this,r)}return S(n,[{key:"toString",value:function(){return"@!="+this.dimen}}]),n})(u.Command.Xymatrix.Setup.PretendEntrySize),u.Command.Xymatrix.Setup.FixGrid=function e(){g(this,e)},u.Command.Xymatrix.Setup.FixGrid.Row=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"@!R"}}]),n})(u.Command.Xymatrix.Setup.FixGrid),u.Command.Xymatrix.Setup.FixGrid.Column=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"@!C"}}]),n})(u.Command.Xymatrix.Setup.FixGrid),u.Command.Xymatrix.Setup.FixGrid.RowAndColumn=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"@!"}}]),n})(u.Command.Xymatrix.Setup.FixGrid),u.Command.Xymatrix.Setup.AdjustEntrySize=function e(t,n){g(this,e),this.addop=t,this.dimen=n},u.Command.Xymatrix.Setup.AdjustEntrySize.Margin=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@M"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.AdjustEntrySize),u.Command.Xymatrix.Setup.AdjustEntrySize.Width=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@W"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.AdjustEntrySize),u.Command.Xymatrix.Setup.AdjustEntrySize.Height=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"@H"+this.addop+this.dimen}}]),n})(u.Command.Xymatrix.Setup.AdjustEntrySize),u.Command.Xymatrix.Setup.AdjustLabelSep=(function(){function e(t,n){g(this,e),this.addop=t,this.dimen=n}return S(e,[{key:"toString",value:function(){return"@L"+this.addop+this.dimen}}]),e})(),u.Command.Xymatrix.Setup.SetOrientation=(function(){function e(t){g(this,e),this.direction=t}return S(e,[{key:"toString",value:function(){return"@"+this.direction}}]),e})(),u.Command.Xymatrix.Setup.AddModifier=(function(){function e(t){g(this,e),this.modifier=t}return S(e,[{key:"toString",value:function(){return"@*"+this.modifier}}]),e})(),u.Command.Xymatrix.Row=(function(){function e(t){g(this,e),this.entries=t}return S(e,[{key:"toString",value:function(){return this.entries.mkString(" & ")}}]),e})(),u.Command.Xymatrix.Entry=function e(){g(this,e)},u.Command.Xymatrix.Entry.SimpleEntry=(function(e){W(n,e);var t=N(n);function n(r,i,a){var s;return g(this,n),(s=t.call(this)).modifiers=r,s.objectbox=i,s.decor=a,s}return S(n,[{key:"isEmpty",get:function(){return!1}},{key:"toString",value:function(){return this.modifiers.mkString("**{","","}")+" "+this.objectbox+" "+this.decor}}]),n})(u.Command.Xymatrix.Entry),u.Command.Xymatrix.Entry.ObjectEntry=(function(e){W(n,e);var t=N(n);function n(r,i,a){var s;return g(this,n),(s=t.call(this)).object=r,s.pos=i,s.decor=a,s}return S(n,[{key:"isEmpty",get:function(){return!1}},{key:"toString",value:function(){return"*"+this.object+" "+this.pos+" "+this.decor}}]),n})(u.Command.Xymatrix.Entry),u.Command.Xymatrix.Entry.EmptyEntry=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).decor=r,i}return S(n,[{key:"isEmpty",get:function(){return!0}},{key:"toString",value:function(){return""+this.decor}}]),n})(u.Command.Xymatrix.Entry),u.Command.Twocell=(function(){function e(t,n,r){g(this,e),this.twocell=t,this.switches=n,this.arrow=r}return S(e,[{key:"toString",value:function(){return this.twocell.toString()+this.switches.mkString("")+this.arrow}}]),e})(),u.Command.Twocell.Hops2cell=function e(t,n){g(this,e),this.hops=t,this.maybeDisplace=n},u.Command.Twocell.Twocell=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"\\xtwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}]),n})(u.Command.Twocell.Hops2cell),u.Command.Twocell.UpperTwocell=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"\\xuppertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}]),n})(u.Command.Twocell.Hops2cell),u.Command.Twocell.LowerTwocell=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"\\xlowertwocell["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}]),n})(u.Command.Twocell.Hops2cell),u.Command.Twocell.CompositeMap=(function(e){W(n,e);var t=N(n);function n(r,i){return g(this,n),t.call(this,r,i)}return S(n,[{key:"toString",value:function(){return"\\xcompositemap["+this.hops+"]"+this.maybeDisplace.getOrElse("{}")}}]),n})(u.Command.Twocell.Hops2cell),u.Command.Twocell.Switch=function e(){g(this,e)},u.Command.Twocell.Switch.UpperLabel=(function(){function e(t){g(this,e),this.label=t}return S(e,[{key:"toString",value:function(){return"^"+this.label}}]),e})(),u.Command.Twocell.Switch.LowerLabel=(function(){function e(t){g(this,e),this.label=t}return S(e,[{key:"toString",value:function(){return"_"+this.label}}]),e})(),u.Command.Twocell.Switch.SetCurvature=(function(){function e(t){g(this,e),this.nudge=t}return S(e,[{key:"toString",value:function(){return this.nudge.toString()}}]),e})(),u.Command.Twocell.Switch.DoNotSetCurvedArrows=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"\\omit"}}]),e})(),u.Command.Twocell.Switch.PlaceModMapObject=(function(){function e(){g(this,e)}return S(e,[{key:"toString",value:function(){return"~!"}}]),e})(),u.Command.Twocell.Switch.ChangeHeadTailObject=(function(){function e(t,n){g(this,e),this.what=t,this.object=n}return S(e,[{key:"toString",value:function(){return"~"+this.what+"{"+this.object+"}"}}]),e})(),u.Command.Twocell.Switch.ChangeCurveObject=(function(){function e(t,n,r){g(this,e),this.what=t,this.spacer=n,this.maybeObject=r}return S(e,[{key:"toString",value:function(){return"~"+this.what+"{"+this.spacer+(this.maybeObject.isDefined?"~**"+this.maybeObject.get:"")+"}"}}]),e})(),u.Command.Twocell.Label=(function(){function e(t,n){g(this,e),this.maybeNudge=t,this.labelObject=n}return S(e,[{key:"toString",value:function(){return this.maybeNudge.toString()+this.labelObject}}]),e})(),u.Command.Twocell.Nudge=function e(){g(this,e)},u.Command.Twocell.Nudge.Number=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).number=r,i}return S(n,[{key:"toString",value:function(){return"<"+this.number+">"}}]),n})(u.Command.Twocell.Nudge),u.Command.Twocell.Nudge.Omit=(function(e){W(n,e);var t=N(n);function n(){return g(this,n),t.call(this)}return S(n,[{key:"toString",value:function(){return"<\\omit>"}}]),n})(u.Command.Twocell.Nudge),u.Command.Twocell.Arrow=function e(){g(this,e)},u.Command.Twocell.Arrow.WithOrientation=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).tok=r,a.labelObject=i,a}return S(n,[{key:"toString",value:function(){return"{["+this.tok+"] "+this.labelObject+"}"}}]),n})(u.Command.Twocell.Arrow),u.Command.Twocell.Arrow.WithPosition=(function(e){W(n,e);var t=N(n);function n(r,i){var a;return g(this,n),(a=t.call(this)).nudge=r,a.labelObject=i,a}return S(n,[{key:"toString",value:function(){return"{["+this.nudge+"] "+this.labelObject+"}"}}]),n})(u.Command.Twocell.Arrow),u.Command.Newdir=(function(){function e(t,n){g(this,e),this.dirMain=t,this.compositeObject=n}return S(e,[{key:"toString",value:function(){return"\\newdir{"+this.dirMain+"}{"+this.compositeObject+"}"}}]),e})(),u.Pos.Xyimport=function e(){g(this,e)},u.Pos.Xyimport.TeXCommand=(function(e){W(n,e);var t=N(n);function n(r,i,a,s,c){var l;return g(this,n),(l=t.call(this)).width=r,l.height=i,l.xOffset=a,l.yOffset=s,l.graphics=c,l}return S(n,[{key:"toString",value:function(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}}]),n})(u.Pos.Xyimport),u.Pos.Xyimport.Graphics=(function(e){W(n,e);var t=N(n);function n(r,i,a,s,c){var l;return g(this,n),(l=t.call(this)).width=r,l.height=i,l.xOffset=a,l.yOffset=s,l.graphics=c,l}return S(n,[{key:"toString",value:function(){return"\\xyimport("+this.width+", "+this.height+")("+this.xOffset+", "+this.yOffset+"){"+this.graphics+"}"}}]),n})(u.Pos.Xyimport),u.Command.Includegraphics=(function(){function e(t,n,r){g(this,e),this.isClipped=t,this.attributeList=n,this.filepath=r}return S(e,[{key:"isIncludegraphics",get:function(){return!0}},{key:"toString",value:function(){return"\\includegraphics"+(this.isClipped?"*":"")+this.attributeList.mkString("[",",","]")+"{"+this.filepath+"}"}}]),e})(),u.Command.Includegraphics.Attr=function e(){g(this,e)},u.Command.Includegraphics.Attr.Width=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).dimen=r,i}return S(n,[{key:"toString",value:function(){return"width="+this.dimen}}]),n})(u.Command.Includegraphics.Attr),u.Command.Includegraphics.Attr.Height=(function(e){W(n,e);var t=N(n);function n(r){var i;return g(this,n),(i=t.call(this)).dimen=r,i}return S(n,[{key:"toString",value:function(){return"height="+this.dimen}}]),n})(u.Command.Includegraphics.Attr);var Z=se.fun,Ye=se.elem,De=function(e){return Z(se.elem(e))},k=se.literal,fe=se.regex,ce=se.regexLiteral,E=function(e){return Z(se.literal(e))},Me=se.seq,H=se.or,Se=function(e){return se.lazyParser(e)().rep()},tn=function(e){return se.lazyParser(e)().rep1()},Fe=function(e){return se.lazyParser(e)().opt()},Te=se.success,D=function(e){return function(){var t=e.memo;return t===void 0&&(t=e.memo=e()),t}},v=new se,qn={xy:D((function(){return v.posDecor().to((function(e){return e}))})),xybox:D((function(){return k("{").andr(v.posDecor).andl(E("}")).to((function(e){return e}))})),xymatrixbox:D((function(){return v.xymatrix().to((function(e){return new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty),new u.Decor(j.empty.append(e)))}))})),posDecor:D((function(){return Me(v.pos,v.decor).to((function(e){return new u.PosDecor(e.head,e.tail)}))})),pos:D((function(){return Me(v.coord,Se(v.pos2)).to((function(e){return new u.Pos.Coord(e.head,e.tail)}))})),nonemptyPos:D((function(){return H(Me(v.nonemptyCoord,Se(v.pos2)),Me(v.coord,tn(v.pos2))).to((function(e){return new u.Pos.Coord(e.head,e.tail)}))})),pos2:D((function(){return H(k("+").andr(v.coord).to((function(e){return new u.Pos.Plus(e)})),k("-").andr(v.coord).to((function(e){return new u.Pos.Minus(e)})),k("!").andr(v.coord).to((function(e){return new u.Pos.Skew(e)})),k(".").andr(v.coord).to((function(e){return new u.Pos.Cover(e)})),k(",").andr(v.coord).to((function(e){return new u.Pos.Then(e)})),k(";").andr(v.coord).to((function(e){return new u.Pos.SwapPAndC(e)})),k("::").andr(v.coord).to((function(e){return new u.Pos.SetYBase(e)})),k(":").andr(v.coord).to((function(e){return new u.Pos.SetBase(e)})),k("**").andr(v.object).to((function(e){return new u.Pos.ConnectObject(e)})),k("*").andr(v.object).to((function(e){return new u.Pos.DropObject(e)})),k("?").andr(v.place).to((function(e){return new u.Pos.Place(e)})),k("@+").andr(v.coord).to((function(e){return new u.Pos.PushCoord(e)})),k("@-").andr(v.coord).to((function(e){return new u.Pos.EvalCoordThenPop(e)})),k("@=").andr(v.coord).to((function(e){return new u.Pos.LoadStack(e)})),k("@@").andr(v.coord).to((function(e){return new u.Pos.DoCoord(e)})),k("@i").to((function(){return new u.Pos.InitStack})),k("@(").to((function(){return new u.Pos.EnterFrame})),k("@)").to((function(){return new u.Pos.LeaveFrame})),k("=:").andr(E('"')).andr(v.id).andl(De('"')).to((function(e){return new u.Pos.SaveBase(e)})),k("=@").andr(E('"')).andr(v.id).andl(De('"')).to((function(e){return new u.Pos.SaveStack(e)})),k("=").andr(E('"')).andr(v.id).andl(De('"')).to((function(e){return new u.Pos.SavePos(e)})),k("=").andr(v.nonemptyCoord).andl(E('"')).and(v.id).andl(De('"')).to((function(e){return new u.Pos.SaveMacro(e.head,e.tail)})),v.xyimport)})),coord:D((function(){return H(v.nonemptyCoord,Te("empty").to((function(){return new u.Coord.C})))})),nonemptyCoord:D((function(){return H(k("c").to((function(){return new u.Coord.C})),k("p").to((function(){return new u.Coord.P})),k("x").to((function(){return new u.Coord.X})),k("y").to((function(){return new u.Coord.Y})),v.vector().to((function(e){return new u.Coord.Vector(e)})),k('"').andr(v.id).andl(De('"')).to((function(e){return new u.Coord.Id(e)})),k("{").andr(v.posDecor).andl(E("}")).to((function(e){return new u.Coord.Group(e)})),k("s").andr(Z(ce(/^\d/))).to((function(e){return new u.Coord.StackPosition(parseInt(e))})),k("s").andr(E("{")).and(v.nonnegativeNumber).andl(E("}")).to((function(e){return new u.Coord.StackPosition(e)})),k("[").andr(Z(Fe(k('"').andr(v.id).andl(De('"'))).to((function(e){return e.getOrElse("")})))).and(v.number).andl(E(",")).and(v.number).andl(E("]")).to((function(e){return new u.Coord.DeltaRowColumn(e.head.head,e.head.tail,e.tail)})),k("[").andr(Z(Fe(k('"').andr(v.id).andl(De('"'))).to((function(e){return e.getOrElse("")})))).and(Z(Se(fe(/^[lrud]/)))).andl(E("]")).to((function(e){return new u.Coord.Hops(e.head,e.tail)})),k("[").andr(Z(Fe(k('"').andr(v.id).andl(De('"'))).to((function(e){return e.getOrElse("")})))).and(Z(tn(fe(/^[lrud]/)))).and(v.place).andl(E("]")).to((function(e){return new u.Coord.DeltaRowColumn(e.head.head,e.head.tail,new u.Pos.Place(e.tail))})))})),vector:D((function(){return H(k("(").andr(v.factor).andl(E(",")).and(v.factor).andl(E(")")).to((function(e){return new u.Vector.InCurBase(e.head,e.tail)})),k("<").andr(v.dimen).andl(E(",")).and(v.dimen).andl(E(">")).to((function(e){return new u.Vector.Abs(e.head,e.tail)})),k("<").andr(v.dimen).andl(E(">")).to((function(e){return new u.Vector.Abs(e,e)})),k("a").andr(E("(")).andr(v.number).andl(E(")")).to((function(e){return new u.Vector.Angle(e)})),k("/").andr(v.direction).and(v.looseDimen).andl(E("/")).to((function(e){return new u.Vector.Dir(e.head,e.tail)})),k("0").to((function(e){return new u.Vector.Abs("0mm","0mm")})),(function(){return v.corner().and(Z(se.opt(Z(k("(").andr(v.factor).andl(E(")")))).to((function(e){return e.getOrElse(1)})))).to((function(e){return new u.Vector.Corner(e.head,e.tail)}))}))})),corner:D((function(){return H(ce(/^(CL|LC)/).to((function(){return new u.Corner.CL})),ce(/^(CR|RC)/).to((function(){return new u.Corner.CR})),ce(/^(CD|DC)/).to((function(){return new u.Corner.CD})),ce(/^(CU|UC)/).to((function(){return new u.Corner.CU})),ce(/^(LD|DL)/).to((function(){return new u.Corner.LD})),ce(/^(RD|DR)/).to((function(){return new u.Corner.RD})),ce(/^(LU|UL)/).to((function(){return new u.Corner.LU})),ce(/^(RU|UR)/).to((function(){return new u.Corner.RU})),k("L").to((function(){return new u.Corner.L})),k("R").to((function(){return new u.Corner.R})),k("D").to((function(){return new u.Corner.D})),k("U").to((function(){return new u.Corner.U})),k("E").to((function(){return new u.Corner.NearestEdgePoint})),k("P").to((function(){return new u.Corner.PropEdgePoint})),k("A").to((function(){return new u.Corner.Axis})))})),place:D((function(){return H(k("<").andr(v.place).to((function(e){return new u.Place(1,0,void 0,void 0).compound(e)})),k(">").andr(v.place).to((function(e){return new u.Place(0,1,void 0,void 0).compound(e)})),k("(").andr(v.factor).andl(E(")")).and(v.place).to((function(e){return new u.Place(0,0,new u.Place.Factor(e.head),void 0).compound(e.tail)})),k("!").andr(E("{")).andr(v.pos).andl(E("}")).and(v.slide).to((function(e){return new u.Place(0,0,new u.Place.Intercept(e.head),e.tail)})),(function(){return v.slide().to((function(e){return new u.Place(0,0,void 0,e)}))}))})),slide:D((function(){return H(k("/").andr(v.dimen).andl(E("/")).to((function(e){return new u.Slide(new G.Some(e))})),Te("no slide").to((function(){return new u.Slide(G.empty)})))})),factor:D(Z(ce(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function(e){return parseFloat(e)})))),number:D(Z(ce(/^[+\-]?\d+/).to((function(e){return parseInt(e)})))),nonnegativeNumber:D(Z(ce(/^\d+/).to((function(e){return parseInt(e)})))),unit:D(Z(ce(/^(em|ex|px|pt|pc|in|cm|mm|mu)/).to((function(e){return e})))),dimen:D((function(){return v.factor().and(v.unit).to((function(e){return e.head.toString()+e.tail}))})),looseDimen:D((function(){return v.looseFactor().and(v.unit).to((function(e){return e.head.toString()+e.tail}))})),looseFactor:D(Z(H(ce(/^(\d \d*(\.\d*))/).to((function(e){return parseFloat(e.replace(/ /,""))})),ce(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function(e){return parseFloat(e)}))))),id:D(Z(fe(/^[^"]+/))),object:D((function(){return H(Se(v.modifier).and(v.objectbox).to((function(e){return new u.Object(e.head,e.tail)})))})),objectbox:D((function(){return H(v.mathText,k("@").andr(v.dir),k("\\dir").andr(v.dir),k("\\cir").andr(v.cirRadius).andl(E("{")).and(v.cir).andl(E("}")).to((function(e){return new u.ObjectBox.Cir(e.head,e.tail)})),k("\\frm").andr(v.frameRadius).andl(E("{")).and(v.frameMain).andl(E("}")).to((function(e){return new u.ObjectBox.Frame(e.head,e.tail)})),k("\\object").andr(v.object).to((function(e){return new u.ObjectBox.WrapUpObject(e)})),k("\\composite").and(E("{")).andr(v.compositeObject).andl(E("}")).to((function(e){return new u.ObjectBox.CompositeObject(e)})),k("\\xybox").and(E("{")).andr(v.posDecor).andl(E("}")).to((function(e){return new u.ObjectBox.Xybox(e)})),k("\\xymatrix").andr(v.xymatrix).to((function(e){return new u.ObjectBox.Xymatrix(e)})),v.txt,v.curve,fe(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)/).andl(E("{")).and(v.text).andl(E("}")).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return v.toMath(t.head+"{"+t.tail+"}",n)})))})),compositeObject:D((function(){return v.object().and(Z(Se(k("*").andr(v.object)))).to((function(e){return e.tail.prepend(e.head)}))})),mathText:D((function(){return k("{").andr(v.text).andl(De("}")).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return v.toMath("\\hbox{$\\objectstyle{"+t+"}$}",n)}))})),toMath:function(e,t){var n=t(e);return new u.ObjectBox.Text(n)},textNodeCreator:D((function(){return new se.Parser((function(e){return new se.Success(e.context.createTextNode,e)}))})),text:D((function(){return fe(/^[^{}\\%]*/).and((function(){return H(fe(/^(\\\{|\\\}|\\%|\\)/).to((function(e){return e})),Ye("{").andr(v.text).andl(De("}")).to((function(e){return"{"+e+"}"})),fe(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function(e){return" "}))).and(Z(fe(/^[^{}\\%]*/))).rep().to((function(e){var t="";return e.foreach((function(n){t+=n.head+n.tail})),t}))})).to((function(e){return e.head+e.tail}))})),txt:D((function(){return k("\\txt").andr(v.txtWidth).and(Z(fe(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)?/))).andl(E("{")).and(v.text).andl(E("}")).and(v.textNodeCreator).to((function(e){var t,n=e.head,r=e.tail,i=n.head.head,a=n.head.tail,s=n.tail,c=s.split("\\\\");if(c.length<=1)t=a+"{\\hbox{"+s+"}}";else{t=`\\hbox{$\\begin{array}{c}
`;for(var l=0;l<c.length;l++)t+=a+"{\\hbox{"+c[l].replace(/(^[\r\n\s]+)|([\r\n\s]+$)/g,"")+"}}",l!=c.length-1&&(t+=`\\\\
`);t+="\\end{array}$}"}return new u.ObjectBox.Txt(i,v.toMath(t,r))}))})),txtWidth:D((function(){return H(k("<").andr(v.dimen).andl(E(">")).to((function(e){return new u.Vector.Abs(e,e)})).to((function(e){return new u.ObjectBox.Txt.Width.Vector(e)})),Te("default").to((function(){return new u.ObjectBox.Txt.Width.Default})))})),dir:D((function(){return ce(/^[\^_0123]/).opt().andl(E("{")).and(v.dirMain).andl(E("}")).to((function(e){return new u.ObjectBox.Dir(e.head.getOrElse(""),e.tail)}))})),dirMain:D((function(){return fe(/^(-|\.|~|>|<|\(|\)|`|'|\||\*|\+|x|\/|o|=|:|[a-zA-Z@ ])+/).opt().to((function(e){return e.getOrElse("")}))})),cirRadius:D((function(){return H(v.vector().to((function(e){return new u.ObjectBox.Cir.Radius.Vector(e)})),Te("default").to((function(){return new u.ObjectBox.Cir.Radius.Default})))})),frameRadius:D((function(){return H(v.frameRadiusVector().to((function(e){return new u.ObjectBox.Frame.Radius.Vector(e)})),Te("default").to((function(){return new u.ObjectBox.Frame.Radius.Default})))})),frameRadiusVector:D((function(){return H(k("<").andr(v.dimen).andl(E(",")).and(v.dimen).andl(E(">")).to((function(e){return new u.Vector.Abs(e.head,e.tail)})),k("<").andr(v.dimen).andl(E(">")).to((function(e){return new u.Vector.Abs(e,e)})))})),frameMain:D((function(){return fe(/^(((_|\^)?(\\\{|\\\}|\(|\)))|[\-=oe,\.\*]*)/)})),cir:D((function(){return H(v.nonemptyCir,Te("full").to((function(){return new u.ObjectBox.Cir.Cir.Full})))})),nonemptyCir:D((function(){return v.diag().and(Z(ce(/^[_\^]/))).and(v.diag).to((function(e){return new u.ObjectBox.Cir.Cir.Segment(e.head.head,e.head.tail,e.tail)}))})),curve:D((function(){return k("\\crv").andr(v.curveModifier).andl(E("{")).and(v.curveObject).and(v.curvePoslist).andl(E("}")).to((function(e){return new u.ObjectBox.Curve(e.head.head,e.head.tail,e.tail)}))})),curveModifier:D((function(){return Se(Z(k("~").andr(v.curveOption)))})),curveOption:D((function(){return H(k("p").to((function(){return new u.ObjectBox.Curve.Modifier.p})),k("P").to((function(){return new u.ObjectBox.Curve.Modifier.P})),k("l").to((function(){return new u.ObjectBox.Curve.Modifier.l})),k("L").to((function(){return new u.ObjectBox.Curve.Modifier.L})),k("c").to((function(){return new u.ObjectBox.Curve.Modifier.c})),k("C").to((function(){return new u.ObjectBox.Curve.Modifier.C})),k("pc").to((function(){return new u.ObjectBox.Curve.Modifier.pc})),k("pC").to((function(){return new u.ObjectBox.Curve.Modifier.pC})),k("Pc").to((function(){return new u.ObjectBox.Curve.Modifier.Pc})),k("PC").to((function(){return new u.ObjectBox.Curve.Modifier.PC})),k("lc").to((function(){return new u.ObjectBox.Curve.Modifier.lc})),k("lC").to((function(){return new u.ObjectBox.Curve.Modifier.lC})),k("Lc").to((function(){return new u.ObjectBox.Curve.Modifier.Lc})),k("LC").to((function(){return new u.ObjectBox.Curve.Modifier.LC})),k("cC").to((function(){return new u.ObjectBox.Curve.Modifier.cC})))})),curveObject:D((function(){return Se(H(k("~*").andr(v.object).to((function(e){return new u.ObjectBox.Curve.Object.Drop(e)})),k("~**").andr(v.object).to((function(e){return new u.ObjectBox.Curve.Object.Connect(e)}))))})),curvePoslist:D((function(){return H(k("&").andr(v.curvePoslist2).to((function(e){return e.prepend(new u.ObjectBox.Curve.PosList.CurPos)})),k("~@").andr(E("&")).andr(v.curvePoslist2).to((function(e){return e.prepend(new u.ObjectBox.Curve.PosList.AddStack)})),k("~@").to((function(){return j.empty.prepend(new u.ObjectBox.Curve.PosList.AddStack)})),v.pos().andl(E("&")).and(v.curvePoslist2).to((function(e){return e.tail.prepend(new u.ObjectBox.Curve.PosList.Pos(e.head))})),v.nonemptyPos().to((function(e){return j.empty.prepend(new u.ObjectBox.Curve.PosList.Pos(e))})),Te("empty").to((function(){return j.empty})))})),curvePoslist2:D((function(){return H(k("&").andr(v.curvePoslist2).to((function(e){return e.prepend(new u.ObjectBox.Curve.PosList.CurPos)})),k("~@").andr(E("&")).andr(v.curvePoslist2).to((function(e){return e.prepend(new u.ObjectBox.Curve.PosList.AddStack)})),k("~@").to((function(){return j.empty.prepend(new u.ObjectBox.Curve.PosList.AddStack)})),v.nonemptyPos().andl(E("&")).and(v.curvePoslist2).to((function(e){return e.tail.prepend(new u.ObjectBox.Curve.PosList.Pos(e.head))})),v.nonemptyPos().to((function(e){return j.empty.prepend(new u.ObjectBox.Curve.PosList.Pos(e))})),Te("empty").to((function(){return j.empty.prepend(new u.ObjectBox.Curve.PosList.CurPos)})))})),modifier:D((function(){return H(k("!").andr(v.vector).to((function(e){return new u.Modifier.Vector(e)})),k("!").to((function(e){return new u.Modifier.RestoreOriginalRefPoint})),k("[").andr(v.shape).andl(E("]")).to((function(e){return e})),k("i").to((function(e){return new u.Modifier.Invisible})),k("h").to((function(e){return new u.Modifier.Hidden})),v.addOp().and(v.size).to((function(e){return new u.Modifier.AddOp(e.head,e.tail)})),v.nonemptyDirection().to((function(e){return new u.Modifier.Direction(e)})))})),addOp:D((function(){return H(k("+=").to((function(){return new u.Modifier.AddOp.GrowTo})),k("-=").to((function(){return new u.Modifier.AddOp.ShrinkTo})),k("+").to((function(){return new u.Modifier.AddOp.Grow})),k("-").to((function(){return new u.Modifier.AddOp.Shrink})),k("=").to((function(){return new u.Modifier.AddOp.Set})))})),size:D((function(){return H((function(){return v.vector().to((function(e){return new u.Modifier.AddOp.VactorSize(e)}))}),Te("default size").to((function(){return new u.Modifier.AddOp.DefaultSize})))})),shape:D((function(){return H(k(".").to((function(){return new u.Modifier.Shape.Point})),v.frameShape,v.alphabets().to((function(e){return new u.Modifier.Shape.Alphabets(e)})),k("=").andr(v.alphabets).to((function(e){return new u.Modifier.Shape.DefineShape(e)})),Te("rect").to((function(){return new u.Modifier.Shape.Rect})))})),frameShape:D((function(){return k("F").andr(v.frameMain).and(Z(Se(k(":").andr(Z(H(v.frameRadiusVector().to((function(e){return new u.Modifier.Shape.Frame.Radius(e)})),v.colorName().to((function(e){return new u.Modifier.Shape.Frame.Color(e)})))))))).to((function(e){var t=e.head;return t===""&&(t="-"),new u.Modifier.Shape.Frame(t,e.tail)}))})),alphabets:D((function(){return fe(/^([a-zA-Z]+)/)})),colorName:D((function(){return fe(/^([a-zA-Z][a-zA-Z0-9]*)/)})),direction:D((function(){return Me(v.direction0,Se(v.direction1)).to((function(e){return new u.Direction.Compound(e.head,e.tail)}))})),direction0:D((function(){return H(v.direction2,v.diag().to((function(e){return new u.Direction.Diag(e)})))})),direction1:D((function(){return H(k(":").andr(v.vector).to((function(e){return new u.Direction.RotVector(e)})),k("_").to((function(e){return new u.Direction.RotAntiCW})),k("^").to((function(e){return new u.Direction.RotCW})))})),direction2:D((function(){return H(k("v").andr(v.vector).to((function(e){return new u.Direction.Vector(e)})),k("q").andr(E("{")).andr(v.posDecor).andl(E("}")).to((function(e){return new u.Direction.ConstructVector(e)})))})),nonemptyDirection:D((function(){return H(Me(v.nonemptyDirection0,Se(v.direction1)),Me(v.direction0,tn(v.direction1))).to((function(e){return new u.Direction.Compound(e.head,e.tail)}))})),nonemptyDirection0:D((function(){return H(v.direction2,v.nonemptyDiag().to((function(e){return new u.Direction.Diag(e)})))})),diag:D((function(){return H(v.nonemptyDiag,Te("empty").to((function(e){return new u.Diag.Default})))})),nonemptyDiag:D((function(){return H(ce(/^(ld|dl)/).to((function(e){return new u.Diag.LD})),ce(/^(rd|dr)/).to((function(e){return new u.Diag.RD})),ce(/^(lu|ul)/).to((function(e){return new u.Diag.LU})),ce(/^(ru|ur)/).to((function(e){return new u.Diag.RU})),k("l").to((function(e){return new u.Diag.L})),k("r").to((function(e){return new u.Diag.R})),k("d").to((function(e){return new u.Diag.D})),k("u").to((function(e){return new u.Diag.U})))})),decor:D((function(){return v.command().rep().to((function(e){return new u.Decor(e)}))})),command:D((function(){return H(k("\\ar").andr(Z(Se(v.arrowForm))).and(v.path).to((function(e){return new u.Command.Ar(e.head,e.tail)})),k("\\xymatrix").andr(v.xymatrix),k("\\PATH").andr(v.path).to((function(e){return new u.Command.Path(e)})),k("\\afterPATH").andr(E("{")).andr(v.decor).andl(E("}")).and(v.path).to((function(e){return new u.Command.AfterPath(e.head,e.tail)})),k("\\save").andr(v.pos).to((function(e){return new u.Command.Save(e)})),k("\\restore").to((function(){return new u.Command.Restore})),k("\\POS").andr(v.pos).to((function(e){return new u.Command.Pos(e)})),k("\\afterPOS").andr(E("{")).andr(v.decor).andl(E("}")).and(v.pos).to((function(e){return new u.Command.AfterPos(e.head,e.tail)})),k("\\drop").andr(v.object).to((function(e){return new u.Command.Drop(e)})),k("\\connect").andr(v.object).to((function(e){return new u.Command.Connect(e)})),k("\\relax").to((function(){return new u.Command.Relax})),k("\\xyignore").andr(E("{")).andr(v.pos).and(v.decor).andl(E("}")).to((function(e){return new u.Command.Ignore(e.head,e.tail)})),k("\\xyshowAST").andr(E("{")).andr(v.pos).and(v.decor).andl(E("}")).to((function(e){return new u.Command.ShowAST(e.head,e.tail)})),v.twocellCommand)})),arrowForm:D((function(){return H(k("@").andr(Z(fe(/^([\-\.~=:])/))).to((function(e){return new u.Command.Ar.Form.ChangeStem(e)})),k("@").andr(E("!")).to((function(e){return new u.Command.Ar.Form.DashArrowStem})),k("@").andr(E("/")).andr(v.direction).and(Z(Fe(v.looseDimen))).andl(E("/")).to((function(e){return new u.Command.Ar.Form.CurveArrow(e.head,e.tail.getOrElse(".5pc"))})),k("@").andr(E("(")).andr(v.direction).andl(E(",")).and(v.direction).andl(E(")")).to((function(e){return new u.Command.Ar.Form.CurveFitToDirection(e.head,e.tail)})),k("@").andr(E("`")).andr(v.coord).to((function(e){return new u.Command.Ar.Form.CurveWithControlPoints(e)})),k("@").andr(E("[")).andr(v.shape).andl(E("]")).to((function(e){return new u.Command.Ar.Form.AddShape(e)})),k("@").andr(E("*")).andr(E("{")).andr(Z(Se(v.modifier))).andl(E("}")).to((function(e){return new u.Command.Ar.Form.AddModifiers(e)})),k("@").andr(E("<")).andr(v.dimen).andl(E(">")).to((function(e){return new u.Command.Ar.Form.Slide(e)})),k("|").andr(v.anchor).and(v.it).to((function(e){return new u.Command.Ar.Form.LabelAt(e.head,e.tail)})),k("^").andr(v.anchor).and(v.it).to((function(e){return new u.Command.Ar.Form.LabelAbove(e.head,e.tail)})),k("_").andr(v.anchor).and(v.it).to((function(e){return new u.Command.Ar.Form.LabelBelow(e.head,e.tail)})),k("@").andr(E("?")).to((function(){return new u.Command.Ar.Form.ReverseAboveAndBelow})),k("@").andr(Z(fe(/^([\^_0123])/).opt())).and(Z(Fe(v.tipConnTip))).to((function(e){var t=e.head.getOrElse("");if(e.tail.isDefined){var n=e.tail.get;return new u.Command.Ar.Form.BuildArrow(t,n.tail,n.stem,n.head)}return new u.Command.Ar.Form.ChangeVariant(t)})))})),tipConnTip:D((function(){return k("{").andr(Z(Fe(v.nonemptyTip))).and(Z(Fe(v.nonemptyConn))).and(Z(Fe(v.nonemptyTip))).andl(E("}")).to((function(e){var t,n,r,i=e.head.head,a=e.head.tail,s=e.tail,c=new u.Command.Ar.Form.Tip.Tipchars("");return a.isDefined||s.isDefined?(t=i.getOrElse(c),n=a.getOrElse(new u.Command.Ar.Form.Conn.Connchars("")),r=s.getOrElse(c)):i.isDefined?(t=c,n=new u.Command.Ar.Form.Conn.Connchars("-"),r=i.getOrElse(c)):(t=c,n=new u.Command.Ar.Form.Conn.Connchars(""),r=c),{tail:t,stem:n,head:r}}))})),nonemptyTip:D((function(){return H(fe(/^([<>()|'`+\/a-zA-Z ]+)/).to((function(e){return new u.Command.Ar.Form.Tip.Tipchars(e)})),k("*").andr(v.object).to((function(e){return new u.Command.Ar.Form.Tip.Object(e)})),v.dir().to((function(e){return new u.Command.Ar.Form.Tip.Dir(e)})))})),nonemptyConn:D((function(){return H(fe(/^([\-\.~=:]+)/).to((function(e){return new u.Command.Ar.Form.Conn.Connchars(e)})),k("*").andr(v.object).to((function(e){return new u.Command.Ar.Form.Conn.Object(e)})),v.dir().to((function(e){return new u.Command.Ar.Form.Conn.Dir(e)})))})),path:D((function(){return v.path2(j.empty).to((function(e){return new u.Command.Path.Path(e)}))})),path2:function(e){var t=D((function(){return v.path2(e)}));return H(v.path3().and(t).to((function(n){return n.tail.prepend(n.head)})),Me("~","{",t,"}").to((function(n){return n.head.tail})).into((function(n){return v.path2(n)})),v.segment().to((function(n){return j.empty.prepend(new u.Command.Path.LastSegment(n))})),Te(e).to((function(n){return n})))},path3:D((function(){return H(Me("~","=","{",v.posDecor,"}").to((function(e){return new u.Command.Path.SetBeforeAction(e.head.tail)})),Me("~","/","{",v.posDecor,"}").to((function(e){return new u.Command.Path.SetAfterAction(e.head.tail)})),Me("~","<","{",v.labels,"}").to((function(e){return new u.Command.Path.AddLabelNextSegmentOnly(e.head.tail)})),Me("~",">","{",v.labels,"}").to((function(e){return new u.Command.Path.AddLabelLastSegmentOnly(e.head.tail)})),Me("~","+","{",v.labels,"}").to((function(e){return new u.Command.Path.AddLabelEverySegment(e.head.tail)})),Me("'",v.segment).to((function(e){return new u.Command.Path.StraightSegment(e.tail)})),Me("`",v.turn,v.segment).to((function(e){return new u.Command.Path.TurningSegment(e.head.tail,e.tail)})))})),turn:D((function(){return H(v.nonemptyCir().and(v.turnRadius).to((function(e){return new u.Command.Path.Turn.Cir(e.head,e.tail)})),v.diag().and(v.turnRadius).to((function(e){return new u.Command.Path.Turn.Diag(e.head,e.tail)})))})),turnRadius:D((function(){return H(k("/").andr(v.dimen).to((function(e){return new u.Command.Path.TurnRadius.Dimen(e)})),Te("default").to((function(){return new u.Command.Path.TurnRadius.Default})))})),segment:D((function(){return v.nonemptyPos().and(v.pathSlide).and(v.labels).to((function(e){return new u.Command.Path.Segment(e.head.head,e.head.tail,e.tail)}))})),pathSlide:D((function(){return H(k("<").andr(v.dimen).andl(E(">")).to((function(e){return new u.Slide(new G.Some(e))})),Te("no slide").to((function(){return new u.Slide(G.empty)})))})),labels:D((function(){return v.label().rep().to((function(e){return new u.Command.Path.Labels(e)}))})),label:D((function(){return H(Me("^",v.anchor,v.it,v.alias).to((function(e){return new u.Command.Path.Label.Above(new u.Pos.Place(e.head.head.tail),e.head.tail,e.tail)})),Me("_",v.anchor,v.it,v.alias).to((function(e){return new u.Command.Path.Label.Below(new u.Pos.Place(e.head.head.tail),e.head.tail,e.tail)})),Me("|",v.anchor,v.it,v.alias).to((function(e){return new u.Command.Path.Label.At(new u.Pos.Place(e.head.head.tail),e.head.tail,e.tail)})))})),anchor:D((function(){return H(k("-").andr(v.anchor).to((function(e){return new u.Place(1,1,new u.Place.Factor(.5),void 0).compound(e)})),v.place)})),it:D((function(){return Se(k("[").andr(v.shape).andl(E("]")).to((function(e){return e}))).and(v.it2).to((function(e){return new u.Object(e.head.concat(e.tail.modifiers),e.tail.object)}))})),it2:D((function(){return H(ce(/^[0-9a-zA-Z]/).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return new u.Object(j.empty,v.toMath("\\labelstyle "+t,n))})),ce(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return new u.Object(j.empty,v.toMath("\\labelstyle "+t,n))})),k("{").andr(v.text).andl(De("}")).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return new u.Object(j.empty,v.toMath("\\labelstyle "+t,n))})),k("*").andr(v.object),k("@").andr(v.dir).to((function(e){return new u.Object(j.empty,e)})))})),alias:D((function(){return Me("=",'"',v.id,'"').opt().to((function(e){return e.map((function(t){return t.head.tail}))}))})),xymatrix:D((function(){return v.setup().andl(E("{")).and(v.rows).andl(E("}")).to((function(e){return new u.Command.Xymatrix(e.head,e.tail)}))})),setup:D((function(){return Se(Z(H(k('"').andr(Z(fe(/^[^"]+/))).andl(De('"')).to((function(e){return new u.Command.Xymatrix.Setup.Prefix(e)})),k("@!").andr(Z(fe(/^[RC]/).opt().to((function(e){return e.getOrElse("")})))).and(Z(H(Ye("0").to((function(){return"0em"})),Ye("=").andr(v.dimen)))).to((function(e){var t=e.tail;switch(e.head){case"R":return new u.Command.Xymatrix.Setup.PretendEntrySize.Height(t);case"C":return new u.Command.Xymatrix.Setup.PretendEntrySize.Width(t);default:return new u.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth(t)}})),k("@!").andr(Z(H(Ye("R").to((function(){return new u.Command.Xymatrix.Setup.FixGrid.Row})),Ye("C").to((function(){return new u.Command.Xymatrix.Setup.FixGrid.Column}))).opt().to((function(e){return e.getOrElse(new u.Command.Xymatrix.Setup.FixGrid.RowAndColumn)})))),k("@").andr(Z(fe(/^[MWHL]/))).and(v.addOp).and(v.dimen).to((function(e){var t=e.head.tail,n=e.tail;switch(e.head.head){case"M":return new u.Command.Xymatrix.Setup.AdjustEntrySize.Margin(t,n);case"W":return new u.Command.Xymatrix.Setup.AdjustEntrySize.Width(t,n);case"H":return new u.Command.Xymatrix.Setup.AdjustEntrySize.Height(t,n);case"L":return new u.Command.Xymatrix.Setup.AdjustLabelSep(t,n)}})),k("@").andr(v.nonemptyDirection).to((function(e){return new u.Command.Xymatrix.Setup.SetOrientation(e)})),k("@*[").andr(v.shape).andl(E("]")).to((function(e){return new u.Command.Xymatrix.Setup.AddModifier(e)})),k("@*").andr(v.addOp).and(v.size).to((function(e){return new u.Command.Xymatrix.Setup.AddModifier(new u.Modifier.AddOp(e.head,e.tail))})),k("@").andr(Z(fe(/^[RC]/).opt().to((function(e){return e.getOrElse("")})))).and(v.addOp).and(v.dimen).to((function(e){var t=e.head.tail,n=e.tail;switch(e.head.head){case"R":return new u.Command.Xymatrix.Setup.ChangeSpacing.Row(t,n);case"C":return new u.Command.Xymatrix.Setup.ChangeSpacing.Column(t,n);default:return new u.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn(t,n)}})),k("@1").to((function(){return new u.Command.Xymatrix.Setup.AdjustEntrySize.Margin(new u.Modifier.AddOp.Set,"1pc")})))))})),rows:D((function(){return v.row().and(Z(Se(k("\\\\").andr(v.row)))).to((function(e){var t=e.tail.prepend(e.head);if(!t.isEmpty){var n=t.at(t.length()-1);n.entries.length()===1&&n.entries.at(0).isEmpty&&(t=t.reverse().tail.reverse())}return t}))})),row:D((function(){return v.entry().and(Z(Se(k("&").andr(v.entry)))).to((function(e){return new u.Command.Xymatrix.Row(e.tail.prepend(e.head))}))})),entry:D((function(){return H(k("*").andr(v.object).and(v.pos).and(v.decor).to((function(e){var t=e.head.head,n=e.head.tail,r=e.tail;return new u.Command.Xymatrix.Entry.ObjectEntry(t,n,r)})),v.entryModifier().rep().and(v.looseObjectbox).and(v.decor).to((function(e){var t=e.head.head.foldLeft(j.empty,(function(a,s){return s.concat(a)})),n=e.head.tail.isEmpty,r=e.head.tail.object,i=e.tail;return n&&t.isEmpty?new u.Command.Xymatrix.Entry.EmptyEntry(i):new u.Command.Xymatrix.Entry.SimpleEntry(t,r,i)})))})),entryModifier:D((function(){return H(k("**").andr(E("[")).andr(v.shape).andl(E("]")).to((function(e){return j.empty.append(e)})),k("**").andr(E("{")).andr(Z(Se(v.modifier))).andl(E("}")))})),looseObjectbox:D((function(){return H(v.objectbox().to((function(t){return{isEmpty:!1,object:t}})),fe(/^[^\\{}%&]+/).opt().to((function(t){return t.getOrElse("")})).and(Z(Se(H(Ye("{").andr(v.text).andl(De("}")).to((function(t){return"{"+t+"}"})),Ye("\\").andr(Z((e=fe(/^(\\|ar|xymatrix|PATH|afterPATH|save|restore|POS|afterPOS|drop|connect|xyignore|([lrud]+(twocell|uppertwocell|lowertwocell|compositemap))|xtwocell|xuppertwocell|xlowertwocell|xcompositemap)/),se.not(se.lazyParser(e))))).andr(Z(fe(/^[{}%&]/).opt().to((function(t){return t.getOrElse("")})))).to((function(t){return"\\"+t})),fe(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function(t){return" "}))).and(Z(fe(/^[^\\{}%&]+/).opt().to((function(t){return t.getOrElse("")})))).to((function(t){return t.head+t.tail}))).to((function(t){return t.mkString("")})))).and(v.textNodeCreator).to((function(t){var n=t.head,r=t.tail,i=n.head+n.tail;return{isEmpty:i.trim().length===0,object:v.toMath("\\hbox{$\\objectstyle{"+i+"}$}",r)}})));var e})),twocellCommand:D((function(){return v.twocell().and(Z(Se(v.twocellSwitch))).and(v.twocellArrow).to((function(e){return new u.Command.Twocell(e.head.head,e.head.tail,e.tail)}))})),twocell:D((function(){return H(ce(/^\\[lrud]+twocell/).to((function(e){var t=e.substring(1,e.length-7);return new u.Command.Twocell.Twocell(t,G.empty)})),ce(/^\\[lrud]+uppertwocell/).to((function(e){var t=e.substring(1,e.length-12);return new u.Command.Twocell.UpperTwocell(t,G.empty)})),ce(/^\\[lrud]+lowertwocell/).to((function(e){var t=e.substring(1,e.length-12);return new u.Command.Twocell.LowerTwocell(t,G.empty)})),ce(/^\\[lrud]+compositemap/).to((function(e){var t=e.substring(1,e.length-12);return new u.Command.Twocell.CompositeMap(t,G.empty)})),H(k("\\xtwocell").to((function(){return u.Command.Twocell.Twocell})),k("\\xuppertwocell").to((function(){return u.Command.Twocell.UpperTwocell})),k("\\xlowertwocell").to((function(){return u.Command.Twocell.LowerTwocell})),k("\\xcompositemap").to((function(){return u.Command.Twocell.CompositeMap}))).andl(E("[")).and(Z(fe(/^[lrud]+/))).andl(E("]")).andl(E("{")).and(v.text).andl(E("}")).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail,r=new u.Object(j.empty,v.toMath("\\labelstyle "+t.tail,n));return new t.head.head(t.head.tail,new G.Some(r))})))})),twocellSwitch:D((function(){return H(k("^").andr(v.twocellLabel).to((function(e){return new u.Command.Twocell.Switch.UpperLabel(e)})),k("_").andr(v.twocellLabel).to((function(e){return new u.Command.Twocell.Switch.LowerLabel(e)})),k("\\omit").to((function(){return new u.Command.Twocell.Switch.DoNotSetCurvedArrows})),k("~!").to((function(){return new u.Command.Twocell.Switch.PlaceModMapObject})),ce(/^(~[`'])/).andl(E("{")).and(v.object).andl(E("}")).to((function(e){var t=e.head.substring(1);return new u.Command.Twocell.Switch.ChangeHeadTailObject(t,e.tail)})),ce(/^(~[\^_]?)/).andl(E("{")).and(v.object).and(Z(Fe(k("~**").andr(v.object)))).andl(E("}")).to((function(e){var t=e.head.head.substring(1),n=e.head.tail,r=e.tail;return new u.Command.Twocell.Switch.ChangeCurveObject(t,n,r)})),v.nudge().to((function(e){return new u.Command.Twocell.Switch.SetCurvature(e)})))})),twocellLabel:D((function(){return H(ce(/^[0-9a-zA-Z]/).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail,r=new u.Object(j.empty,v.toMath("\\twocellstyle "+t,n));return new u.Command.Twocell.Label(G.empty,r)})),ce(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail,r=new u.Object(j.empty,v.toMath("\\twocellstyle "+t,n));return new u.Command.Twocell.Label(G.empty,r)})),k("{").andr(Z(Fe(v.nudge))).andl(E("*")).and(v.object).andl(E("}")).to((function(e){return new u.Command.Twocell.Label(e.head,e.tail)})),k("{").andr(Z(Fe(v.nudge))).and(v.text).andl(De("}")).and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail,r=new u.Object(j.empty,v.toMath("\\twocellstyle "+t.tail,n));return new u.Command.Twocell.Label(t.head,r)})))})),nudge:D((function(){return H(k("<\\omit>").to((function(){return new u.Command.Twocell.Nudge.Omit})),k("<").andr(v.factor).andl(E(">")).to((function(e){return new u.Command.Twocell.Nudge.Number(e)})))})),twocellArrow:D((function(){return H(k("{").andr(Z(ce(/^([\^_=`'"!]|\\omit)/))).and(v.twocellLabelEntry).andl(E("}")).to((function(e){return new u.Command.Twocell.Arrow.WithOrientation(e.head,e.tail)})),k("{").andr(v.nudge).and(v.twocellLabelEntry).andl(E("}")).to((function(e){return new u.Command.Twocell.Arrow.WithPosition(e.head,e.tail)})),k("{").andr(v.twocellLabelEntry).andl(E("}")).to((function(e){return new u.Command.Twocell.Arrow.WithOrientation("",e)})),Te("no arrow label").andr(v.textNodeCreator).to((function(e){return new u.Command.Twocell.Arrow.WithOrientation("",new u.Object(j.empty,v.toMath("\\twocellstyle{}",e)))})))})),twocellLabelEntry:D((function(){return H(k("*").andr(v.object),v.text().and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return new u.Object(j.empty,v.toMath("\\twocellstyle "+t,n))})))})),newdir:D((function(){return k("{").andr(v.dirMain).andl(De("}")).andl(E("{")).and(v.compositeObject).andl(E("}")).to((function(e){return new u.Command.Newdir(e.head,new u.ObjectBox.CompositeObject(e.tail))}))})),xyimport:D((function(){return k("\\xyimport").andr(E("(")).andr(v.factor).andl(E(",")).and(v.factor).andl(E(")")).and(Z(Fe(k("(").andr(v.factor).andl(E(",")).and(v.factor).andl(E(")"))))).andl(E("{")).and(Z(H(k("\\includegraphics").andr(v.includegraphics),v.text().and(v.textNodeCreator).to((function(e){var t=e.head,n=e.tail;return v.toMath("\\hbox{$\\objectstyle{"+t+"}$}",n)}))))).andl(E("}")).to((function(e){var t,n,r=e.head.head.head,i=e.head.head.tail;e.head.tail.isDefined?(t=e.head.tail.get.head,n=e.head.tail.get.tail):(t=0,n=0);var a=e.tail;return a.isIncludegraphics===void 0?new u.Pos.Xyimport.TeXCommand(r,i,t,n,a):new u.Pos.Xyimport.Graphics(r,i,t,n,a)}))})),includegraphics:D((function(){return k("[").andr(Z(Fe(v.includegraphicsAttrList))).andl(E("]")).andl(E("{")).and(Z(ce(/^[^\s{}]+/))).andl(E("}")).to((function(e){var t=e.head.getOrElse(j.empty),n=e.tail;return new u.Command.Includegraphics(!1,t,n)}))})),includegraphicsAttrList:D((function(){return v.includegraphicsAttr().and(Z(Se(k(",").andr(v.includegraphicsAttr)))).to((function(e){return e.tail.prepend(e.head)}))})),includegraphicsAttr:D((function(){return H(k("width").andr(E("=")).andr(v.dimen).to((function(e){return new u.Command.Includegraphics.Attr.Width(e)})),k("height").andr(E("=")).andr(v.dimen).to((function(e){return new u.Command.Includegraphics.Attr.Height(e)})))}))};for(var Jn in qn)v[Jn]=qn[Jn];var at=v,Br=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},Or=function(e){return e<0?-1:e>0?1:0},xt=function(e){return Math.abs(e)<Be.machinePrecision?0:e},F=function(e,t){var n=e[t],r=function(){var a=n.call(this),s=function(){return a};return s.reset=i,e[t]=s,a},i=function(){e[t]=r};r.reset=i,i()},ot=function(e){return Math.round(100*e)/100};function nn(e){return nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nn(e)}function rn(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&an(e,t)}function an(e,t){return an=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},an(e,t)}function on(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=gt(e);if(t){var i=gt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ar(this,n)}}function Ar(e,t){if(t&&(nn(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function gt(e){return gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},gt(e)}function wt(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function St(e,t,n){return t&&Zn(e.prototype,t),n&&Zn(e,n),e}var O=(function(){function e(){wt(this,e)}return St(e,[{key:"toRect",value:function(t){return new e.Rect(this.x,this.y,t)}},{key:"toPoint",value:function(){return new e.Point(this.x,this.y)}},{key:"combineRect",value:function(t){return e.combineRect(this,t)}}],[{key:"combineRect",value:function(t,n){if(t===void 0)return n;if(n===void 0)return t;var r=-(Math.min(t.x-t.l,n.x-n.l)-t.x),i=Math.max(t.x+t.r,n.x+n.r)-t.x,a=-(Math.min(t.y-t.d,n.y-n.d)-t.y),s=Math.max(t.y+t.u,n.y+n.u)-t.y;return t.toRect({l:r,r:i,d:a,u:s})}}]),e})();function un(e){return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(e)}function z(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}function sn(e,t){return sn=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},sn(e,t)}function Q(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=bt(e);if(t){var i=bt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Er(this,n)}}function Er(e,t){if(t&&(un(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return _(e)}function _(e){if(e===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bt(e){return bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bt(e)}function V(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Lr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t&&Lr(e.prototype,t),e}O.Point=(function(e){rn(n,e);var t=on(n);function n(r,i){var a;return wt(this,n),(a=t.call(this)).x=r,a.y=i,a}return St(n,[{key:"l",get:function(){return 0}},{key:"r",get:function(){return 0}},{key:"u",get:function(){return 0}},{key:"d",get:function(){return 0}},{key:"isPoint",value:function(){return!0}},{key:"isRect",value:function(){return!1}},{key:"isCircle",value:function(){return!1}},{key:"edgePoint",value:function(r,i){return this}},{key:"proportionalEdgePoint",value:function(r,i){return this}},{key:"grow",value:function(r,i){var a=Math.max(0,r),s=Math.max(0,i);return this.toRect({l:a,r:a,u:s,d:s})}},{key:"toSize",value:function(r,i){return this.toRect({l:r/2,r:r/2,u:i/2,d:i/2})}},{key:"growTo",value:function(r,i){var a=Math.max(0,r),s=Math.max(0,i);return this.toRect({l:a/2,r:a/2,u:s/2,d:s/2})}},{key:"shrinkTo",value:function(r,i){return this}},{key:"move",value:function(r,i){return new O.Point(r,i)}},{key:"shiftFrame",value:function(r,i){return this}},{key:"rotate",value:function(r){return this}},{key:"contains",value:function(r){return!1}},{key:"toString",value:function(){return"{x:"+this.x+", y:"+this.y+"}"}}]),n})(O),O.Rect=(function(e){rn(n,e);var t=on(n);function n(r,i,a){var s;return wt(this,n),(s=t.call(this)).x=r,s.y=i,s.l=a.l||0,s.r=a.r||0,s.u=a.u||0,s.d=a.d||0,s}return St(n,[{key:"isPoint",value:function(){return this.l===0&&this.r===0&&this.u===0&&this.d===0}},{key:"isRect",value:function(){return!this.isPoint()}},{key:"isCircle",value:function(){return!1}},{key:"edgePoint",value:function(r,i){if(this.isPoint())return this;var a,s=r-this.x,c=i-this.y;return s>0?(a=c*this.r/s)>this.u?new O.Point(this.x+this.u*s/c,this.y+this.u):a<-this.d?new O.Point(this.x-this.d*s/c,this.y-this.d):new O.Point(this.x+this.r,this.y+a):s<0?(a=-c*this.l/s)>this.u?new O.Point(this.x+this.u*s/c,this.y+this.u):a<-this.d?new O.Point(this.x-this.d*s/c,this.y-this.d):new O.Point(this.x-this.l,this.y+a):c>0?new O.Point(this.x,this.y+this.u):new O.Point(this.x,this.y-this.d)}},{key:"proportionalEdgePoint",value:function(r,i){if(this.isPoint())return this;var a=r-this.x,s=i-this.y;if(Math.abs(a)<Be.machinePrecision&&Math.abs(s)<Be.machinePrecision)return new O.Point(this.x-this.l,this.y+this.u);var c,l=this.l+this.r,h=this.u+this.d,m=Math.PI,p=Math.atan2(s,a);return-3*m/4<p&&p<=-m/4?(c=(p+3*m/4)/(m/2),new O.Point(this.x+this.r-c*l,this.y+this.u)):-m/4<p&&p<=m/4?(c=(p+m/4)/(m/2),new O.Point(this.x-this.l,this.y+this.u-c*h)):m/4<p&&p<=3*m/4?(c=(p-m/4)/(m/2),new O.Point(this.x-this.l+c*l,this.y-this.d)):(c=(p-(p>0?3*m/4:-5*m/4))/(m/2),new O.Point(this.x+this.r,this.y-this.d+c*h))}},{key:"grow",value:function(r,i){return this.toRect({l:Math.max(0,this.l+r),r:Math.max(0,this.r+r),u:Math.max(0,this.u+i),d:Math.max(0,this.d+i)})}},{key:"toSize",value:function(r,i){var a,s,c,l,h=this.l+this.r,m=this.u+this.d;return h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h),m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m),this.toRect({l,r:c,u:a,d:s})}},{key:"growTo",value:function(r,i){var a=this.u,s=this.d,c=this.r,l=this.l,h=l+c,m=a+s;return r>h&&(h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h)),i>m&&(m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m)),this.toRect({l,r:c,u:a,d:s})}},{key:"shrinkTo",value:function(r,i){var a=this.u,s=this.d,c=this.r,l=this.l,h=l+c,m=a+s;return r<h&&(h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h)),i<m&&(m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m)),this.toRect({l,r:c,u:a,d:s})}},{key:"move",value:function(r,i){return new O.Rect(r,i,{l:this.l,r:this.r,u:this.u,d:this.d})}},{key:"shiftFrame",value:function(r,i){return new O.Rect(this.x,this.y,{l:Math.max(0,this.l-r),r:Math.max(0,this.r+r),u:Math.max(0,this.u+i),d:Math.max(0,this.d-i)})}},{key:"rotate",value:function(r){var i=Math.cos(r),a=Math.sin(r),s=-this.l,c=this.r,l=this.u,h=-this.d,m={x:s*i-l*a,y:s*a+l*i},p={x:s*i-h*a,y:s*a+h*i},f={x:c*i-l*a,y:c*a+l*i},y={x:c*i-h*a,y:c*a+h*i};return this.toRect({l:-Math.min(m.x,p.x,f.x,y.x),r:Math.max(m.x,p.x,f.x,y.x),u:Math.max(m.y,p.y,f.y,y.y),d:-Math.min(m.y,p.y,f.y,y.y)})}},{key:"contains",value:function(r){var i=r.x,a=r.y;return i>=this.x-this.l&&i<=this.x+this.r&&a>=this.y-this.d&&a<=this.y+this.u}},{key:"toString",value:function(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}}]),n})(O),O.Ellipse=(function(e){rn(n,e);var t=on(n);function n(r,i,a,s,c,l){var h;return wt(this,n),(h=t.call(this)).x=r,h.y=i,h.l=a,h.r=s,h.u=c,h.d=l,h}return St(n,[{key:"isPoint",value:function(){return this.r===0&&this.l===0||this.u===0&&this.d===0}},{key:"isRect",value:function(){return!1}},{key:"isCircle",value:function(){return!this.isPoint()}},{key:"isPerfectCircle",value:function(){return this.l===this.r&&this.l===this.u&&this.l===this.d}},{key:"edgePoint",value:function(r,i){if(this.isPoint())return this;if(this.isPerfectCircle()){var a,s=r-this.x,c=i-this.y;return a=Math.abs(s)<Be.machinePrecision&&Math.abs(c)<Be.machinePrecision?-Math.PI/2:Math.atan2(c,s),new O.Point(this.x+this.r*Math.cos(a),this.y+this.r*Math.sin(a))}var l=this.l,h=this.r,m=this.u,p=this.d,f=this.x,y=this.y,x=f+(h-l)/2,w=y+(m-p)/2,b=(l+h)/2,P=(m+p)/2,M=-(s=r-f),B=(c=i-y)*b,A=M*P,R=B*B+A*A,U=-(p=B*x+A*w+((s*y-c*f)*b+(b-P)*M*w))/R,T=R*b*b-p*p;if(T<0)return new O.Point(this.x,this.y-this.d);var L=Math.sqrt(T)/R,X=P/b,q=B*U+A*L+x,J=X*(A*U-B*L+w-w)+w,Y=B*U-A*L+x,ee=X*(A*U+B*L+w-w)+w,re=Or;return re(q-x)===re(r-x)&&re(J-w)===re(i-w)?new O.Point(q,J):new O.Point(Y,ee)}},{key:"proportionalEdgePoint",value:function(r,i){if(this.isPoint())return this;if(this.isPerfectCircle()){var a,s=r-this.x,c=i-this.y;return a=Math.abs(s)<Be.machinePrecision&&Math.abs(c)<Be.machinePrecision?-Math.PI/2:Math.atan2(c,s),new O.Point(this.x-this.r*Math.cos(a),this.y-this.r*Math.sin(a))}var l=this.l,h=this.r,m=this.u,p=this.d,f=this.x,y=this.y,x=f+(h-l)/2,w=y+(m-p)/2,b=(l+h)/2,P=(m+p)/2,M=-(s=r-f),B=(c=i-y)*b,A=M*P,R=B*B+A*A,U=-(p=B*x+A*w+((s*y-c*f)*b+(b-P)*M*w))/R,T=R*b*b-p*p;if(T<0)return new O.Point(this.x,this.y-this.d);var L=Math.sqrt(T)/R,X=P/b,q=B*U+A*L+x,J=X*(A*U-B*L+w-w)+w,Y=B*U-A*L+x,ee=X*(A*U+B*L+w-w)+w;return sign(q-x)===sign(r-x)&&sign(J-w)===sign(i-w)?new O.Point(Y,ee):new O.Point(q,J)}},{key:"grow",value:function(r,i){return new O.Ellipse(this.x,this.y,Math.max(0,this.l+r),Math.max(0,this.r+r),Math.max(0,this.u+i),Math.max(0,this.d+i))}},{key:"toSize",value:function(r,i){var a,s,c,l,h=this.l+this.r,m=this.u+this.d;return h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h),m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m),new O.Ellipse(this.x,this.y,l,c,a,s)}},{key:"growTo",value:function(r,i){var a=this.u,s=this.d,c=this.r,l=this.l,h=l+c,m=a+s;return r>h&&(h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h)),i>m&&(m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m)),new O.Ellipse(this.x,this.y,l,c,a,s)}},{key:"shrinkTo",value:function(r,i){var a=this.u,s=this.d,c=this.r,l=this.l,h=l+c,m=a+s;return r<h&&(h===0?(l=r/2,c=r/2):(l=r*this.l/h,c=r*this.r/h)),i<m&&(m===0?(a=i/2,s=i/2):(a=i*this.u/m,s=i*this.d/m)),new O.Ellipse(this.x,this.y,l,c,a,s)}},{key:"move",value:function(r,i){return new O.Ellipse(r,i,this.l,this.r,this.u,this.d)}},{key:"shiftFrame",value:function(r,i){return new O.Ellipse(this.x,this.y,Math.max(0,this.l-r),Math.max(0,this.r+r),Math.max(0,this.u+i),Math.max(0,this.d-i))}},{key:"rotate",value:function(r){return this}},{key:"contains",value:function(r){var i=r.x,a=r.y;if(this.isPoint())return!1;var s=this.l,c=this.r,l=this.u,h=this.d,m=(s+c)/2,p=i-(this.x+(c-s)/2),f=(a-(this.y+(l-h)/2))/((l+h)/2/m);return p*p+f*f<=m*m}},{key:"toString",value:function(){return"{x:"+this.x+", y:"+this.y+", l:"+this.l+", r:"+this.r+", u:"+this.u+", d:"+this.d+"}"}}]),n})(O);var d=(function(){function e(){V(this,e)}return I(e,[{key:"isNone",get:function(){return!1}}]),e})();function jr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}d.NoneShape=(function(e){z(n,e);var t=Q(n);function n(){return V(this,n),t.call(this)}return I(n,[{key:"draw",value:function(r){}},{key:"getBoundingBox",value:function(){}},{key:"toString",value:function(){return"NoneShape"}},{key:"isNone",get:function(){return!0}}]),n})(d),d.none=new d.NoneShape,d.InvisibleBoxShape=(function(e){z(n,e);var t=Q(n);function n(r){var i;return V(this,n),(i=t.call(this)).bbox=r,i}return I(n,[{key:"draw",value:function(r){}},{key:"getBoundingBox",value:function(){return this.bbox}},{key:"toString",value:function(){return"InvisibleBoxShape[bbox:"+this.bbox.toString()+"]"}}]),n})(d),d.TranslateShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a){var s;return V(this,n),(s=t.call(this)).dx=r,s.dy=i,s.shape=a,F(_(s),"getBoundingBox"),s}return I(n,[{key:"draw",value:function(r){var i=r.createGroup(r.transformBuilder().translate(this.dx,this.dy));this.shape.draw(i)}},{key:"getBoundingBox",value:function(){var r=this.shape.getBoundingBox();if(r!==void 0)return new O.Rect(r.x+this.dx,r.y+this.dy,r)}},{key:"toString",value:function(){return"TranslateShape[dx:"+this.dx+", dy:"+this.dy+", shape:"+this.shape.toString()+"]"}}]),n})(d),d.CompositeShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).foregroundShape=r,a.backgroundShape=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"draw",value:function(r){this.backgroundShape.draw(r),this.foregroundShape.draw(r)}},{key:"getBoundingBox",value:function(){return O.combineRect(this.foregroundShape.getBoundingBox(),this.backgroundShape.getBoundingBox())}},{key:"toString",value:function(){return"("+this.foregroundShape.toString()+", "+this.backgroundShape.toString()+")"}}]),n})(d),d.ChangeColorShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).color=r,a.shape=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"draw",value:function(r){var i=r.createChangeColorGroup(this.color);this.shape.draw(i)}},{key:"getBoundingBox",value:function(){return this.shape.getBoundingBox()}},{key:"toString",value:function(){return this.shape+", color:"+this.color}}]),n})(d),d.CircleSegmentShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c,l,h,m,p){var f;return V(this,n),(f=t.call(this)).x=r,f.y=i,f.sx=a,f.sy=s,f.r=c,f.large=l,f.flip=h,f.ex=m,f.ey=p,F(_(f),"getBoundingBox"),f}return I(n,[{key:"draw",value:function(r){r.createSVGElement("path",{d:"M"+o.measure.em2px(this.sx)+","+o.measure.em2px(-this.sy)+" A"+o.measure.em2px(this.r)+","+o.measure.em2px(this.r)+" 0 "+this.large+","+this.flip+" "+o.measure.em2px(this.ex)+","+o.measure.em2px(-this.ey)})}},{key:"getBoundingBox",value:function(){return new O.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)}},{key:"toString",value:function(){return"CircleSegmentShape[x:"+this.x+", y:"+this.y+", sx:"+this.sx+", sy:"+this.sy+", r:"+this.r+", large:"+this.large+", flip:"+this.flip+", ex:"+this.ex+", ey:"+this.ey+"]"}}]),n})(d),d.FullCircleShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a){var s;return V(this,n),(s=t.call(this)).x=r,s.y=i,s.r=a,F(_(s),"getBoundingBox"),s}return I(n,[{key:"draw",value:function(r){r.createSVGElement("circle",{cx:o.measure.em2px(this.x),cy:o.measure.em2px(-this.y),r:o.measure.em2px(this.r)})}},{key:"getBoundingBox",value:function(){return new O.Ellipse(this.x,this.y,this.r,this.r,this.r,this.r)}},{key:"toString",value:function(){return"FullCircleShape[x:"+this.x+", y:"+this.y+", r:"+this.r+"]"}}]),n})(d),d.RectangleShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c,l,h,m,p,f,y,x){var w;return V(this,n),(w=t.call(this)).x=r,w.y=i,w.left=a,w.right=s,w.up=c,w.down=l,w.r=h,w.isDoubled=m,w.color=p,w.dasharray=f,w.fillColor=y,w.hideLine=x||!1,F(_(w),"getBoundingBox"),w}return I(n,[{key:"draw",value:function(r){var i={x:o.measure.em2px(this.x-this.left),y:-o.measure.em2px(this.y+this.up),width:o.measure.em2px(this.left+this.right),height:o.measure.em2px(this.up+this.down),rx:o.measure.em2px(this.r)};this.dasharray!==void 0&&(i["stroke-dasharray"]=this.dasharray),this.hideLine?i.stroke="none":this.color!==void 0&&(i.stroke=this.color),this.fillColor!==void 0&&(i.fill=this.fillColor),r.createSVGElement("rect",i),this.isDoubled&&(i={x:o.measure.em2px(this.x-this.left+o.measure.thickness),y:-o.measure.em2px(this.y+this.up-o.measure.thickness),width:o.measure.em2px(this.left+this.right-2*o.measure.thickness),height:o.measure.em2px(this.up+this.down-2*o.measure.thickness),rx:o.measure.em2px(Math.max(this.r-o.measure.thickness,0))},this.dasharray!==void 0&&(i["stroke-dasharray"]=this.dasharray),this.hideLine?i.stroke="none":this.color!==void 0&&(i.stroke=this.color),this.fillColor!==void 0&&(i.fill=this.fillColor),r.createSVGElement("rect",i))}},{key:"getBoundingBox",value:function(){return new O.Rect(this.x,this.y,{l:this.left,r:this.right,u:this.up,d:this.down})}},{key:"toString",value:function(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", r:"+this.r+", isDouble:"+this.isDouble+", dasharray:"+this.dasharray+"]"}}]),n})(d),d.EllipseShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c,l,h,m,p){var f;return V(this,n),(f=t.call(this)).x=r,f.y=i,f.rx=a,f.ry=s,f.isDoubled=c,f.color=l,f.dasharray=h,f.fillColor=m,f.hideLine=p||!1,F(_(f),"getBoundingBox"),f}return I(n,[{key:"draw",value:function(r){var i={cx:o.measure.em2px(this.x),cy:-o.measure.em2px(this.y),rx:o.measure.em2px(this.rx),ry:o.measure.em2px(this.ry)};this.dasharray!==void 0&&(i["stroke-dasharray"]=this.dasharray),this.hideLine?i.stroke="none":this.color!==void 0&&(i.stroke=this.color),this.fillColor!==void 0&&(i.fill=this.fillColor),r.createSVGElement("ellipse",i),this.isDoubled&&(i={cx:o.measure.em2px(this.x),cy:-o.measure.em2px(this.y),rx:o.measure.em2px(Math.max(this.rx-o.measure.thickness)),ry:o.measure.em2px(Math.max(this.ry-o.measure.thickness))},this.dasharray!==void 0&&(i["stroke-dasharray"]=this.dasharray),this.hideLine?i.stroke="none":this.color!==void 0&&(i.stroke=this.color),this.fillColor!==void 0&&(i.fill=this.fillColor),r.createSVGElement("ellipse",i))}},{key:"getBoundingBox",value:function(){return new O.Rect(this.x,this.y,{l:this.rx,r:this.rx,u:this.ry,d:this.ry})}},{key:"toString",value:function(){return"EllipseShape[x:"+this.x+", y:"+this.y+", rx:"+this.rx+", ry:"+this.ry+", isDoubled:"+this.isDoubled+", dasharray:"+this.dasharray+"]"}}]),n})(d),d.BoxShadeShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c,l,h,m){var p;return V(this,n),(p=t.call(this)).x=r,p.y=i,p.left=a,p.right=s,p.up=c,p.down=l,p.depth=h,p.color=m||"currentColor",F(_(p),"getBoundingBox"),p}return I(n,[{key:"draw",value:function(r){var i=o.measure.em2px(this.x),a=o.measure.em2px(this.y),s=o.measure.em2px(this.left),c=o.measure.em2px(this.right),l=o.measure.em2px(this.up),h=o.measure.em2px(this.down),m=o.measure.em2px(this.depth);r.createSVGElement("path",{d:"M"+(i-s+m)+","+(-a+h)+"L"+(i+c)+","+(-a+h)+"L"+(i+c)+","+(-a-l+m)+"L"+(i+c+m)+","+(-a-l+m)+"L"+(i+c+m)+","+(-a+h+m)+"L"+(i-s+m)+","+(-a+h+m)+"Z",stroke:this.color,fill:this.color})}},{key:"getBoundingBox",value:function(){return new O.Rect(this.x,this.y,{l:this.left,r:this.right+this.depth,u:this.up,d:this.down+this.depth})}},{key:"toString",value:function(){return"RectangleShape[x:"+this.x+", y:"+this.y+", left:"+this.left+", right:"+this.right+", up:"+this.up+", down:"+this.down+", depth:"+this.depth+"]"}}]),n})(d),d.LeftBrace=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c,l){var h;return V(this,n),(h=t.call(this)).x=r,h.y=i,h.up=a,h.down=s,h.degree=c,h.color=l||"currentColor",F(_(h),"getBoundingBox"),h}return I(n,[{key:"draw",value:function(r){var i,a=o.measure.oneem,s=Math.max(1.41975,this.down/a*1.125)-.660375,c=.660375-Math.max(1.41975,this.up/a*1.125);i="M"+o.measure.em2px(-.0675)+" "+o.measure.em2px(s)+"T"+o.measure.em2px(-.068625)+" "+o.measure.em2px(.07875+s)+"Q"+o.measure.em2px(-.068625)+" "+o.measure.em2px(.190125+s)+" "+o.measure.em2px(-.0585)+" "+o.measure.em2px(.250875+s)+"T"+o.measure.em2px(-.01125)+" "+o.measure.em2px(.387+s)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(.55575+s)+" "+o.measure.em2px(.2475)+" "+o.measure.em2px(.6525+s)+"L"+o.measure.em2px(.262125)+" "+o.measure.em2px(.660375+s)+"L"+o.measure.em2px(.3015)+" "+o.measure.em2px(.660375+s)+"L"+o.measure.em2px(.30825)+" "+o.measure.em2px(.653625+s)+"V"+o.measure.em2px(.622125+s)+"Q"+o.measure.em2px(.30825)+" "+o.measure.em2px(.60975+s)+" "+o.measure.em2px(.2925)+" "+o.measure.em2px(.60075+s)+"Q"+o.measure.em2px(.205875)+" "+o.measure.em2px(.541125+s)+" "+o.measure.em2px(.149625)+" "+o.measure.em2px(.44775+s)+"T"+o.measure.em2px(.07425)+" "+o.measure.em2px(.239625+s)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(.2385+s)+" "+o.measure.em2px(.073125)+" "+o.measure.em2px(.235125+s)+"Q"+o.measure.em2px(.068625)+" "+o.measure.em2px(.203625+s)+" "+o.measure.em2px(.0675)+" "+o.measure.em2px(.041625+s)+"L"+o.measure.em2px(.0675)+" "+o.measure.em2px(.75825)+"Q"+o.measure.em2px(.0675)+" "+o.measure.em2px(.496125)+" "+o.measure.em2px(.066375)+" "+o.measure.em2px(.486)+"Q"+o.measure.em2px(.05625)+" "+o.measure.em2px(.336375)+" "+o.measure.em2px(-.021375)+" "+o.measure.em2px(.212625)+"T"+o.measure.em2px(-.226125)+" "+o.measure.em2px(.010125)+"L"+o.measure.em2px(-.241875)+" 0L"+o.measure.em2px(-.226125)+" "+o.measure.em2px(-.010125)+"Q"+o.measure.em2px(-.106875)+" "+o.measure.em2px(-.084375)+" "+o.measure.em2px(-.025875)+" "+o.measure.em2px(-.207)+"T"+o.measure.em2px(.066375)+" "+o.measure.em2px(-.486)+"Q"+o.measure.em2px(.0675)+" "+o.measure.em2px(-.496125)+" "+o.measure.em2px(.0675)+" "+o.measure.em2px(-.75825)+"L"+o.measure.em2px(.0675)+" "+o.measure.em2px(-.041625+c)+"Q"+o.measure.em2px(.068625)+" "+o.measure.em2px(-.203625+c)+" "+o.measure.em2px(.073125)+" "+o.measure.em2px(-.235125+c)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(-.2385+c)+" "+o.measure.em2px(.07425)+" "+o.measure.em2px(-.239625+c)+"Q"+o.measure.em2px(.093375)+" "+o.measure.em2px(-.354375+c)+" "+o.measure.em2px(.149625)+" "+o.measure.em2px(-.44775+c)+"T"+o.measure.em2px(.2925)+" "+o.measure.em2px(-.60075+c)+"Q"+o.measure.em2px(.30825)+" "+o.measure.em2px(-.60975+c)+" "+o.measure.em2px(.30825)+" "+o.measure.em2px(-.622125+c)+"L"+o.measure.em2px(.30825)+" "+o.measure.em2px(-.653625+c)+"L"+o.measure.em2px(.3015)+" "+o.measure.em2px(-.660375+c)+"L"+o.measure.em2px(.262125)+" "+o.measure.em2px(-.660375+c)+"L"+o.measure.em2px(.2475)+" "+o.measure.em2px(-.6525+c)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(-.55575+c)+" "+o.measure.em2px(-.01125)+" "+o.measure.em2px(-.387+c)+"Q"+o.measure.em2px(-.048375)+" "+o.measure.em2px(-.311625+c)+" "+o.measure.em2px(-.0585)+" "+o.measure.em2px(-.250875+c)+"T"+o.measure.em2px(-.068625)+" "+o.measure.em2px(-.07875+c)+"Q"+o.measure.em2px(-.0675)+" "+o.measure.em2px(c)+" "+o.measure.em2px(-.0675)+" "+o.measure.em2px(c)+"L"+o.measure.em2px(-.0675)+" "+o.measure.em2px(-.759375)+"V"+o.measure.em2px(-.5985)+"Q"+o.measure.em2px(-.0675)+" "+o.measure.em2px(-.47925)+" "+o.measure.em2px(-.075375)+" "+o.measure.em2px(-.41175)+"T"+o.measure.em2px(-.11475)+" "+o.measure.em2px(-.27)+"Q"+o.measure.em2px(-.133875)+" "+o.measure.em2px(-.2205)+" "+o.measure.em2px(-.160875)+" "+o.measure.em2px(-.17775)+"T"+o.measure.em2px(-.212625)+" "+o.measure.em2px(-.106875)+"T"+o.measure.em2px(-.25875)+" "+o.measure.em2px(-.06075)+"T"+o.measure.em2px(-.293625)+" "+o.measure.em2px(-.0315)+"T"+o.measure.em2px(-.307125)+" "+o.measure.em2px(-.02025)+"Q"+o.measure.em2px(-.30825)+" "+o.measure.em2px(-.019125)+" "+o.measure.em2px(-.30825)+" 0T"+o.measure.em2px(-.307125)+" "+o.measure.em2px(.02025)+"Q"+o.measure.em2px(-.307125)+" "+o.measure.em2px(.021375)+" "+o.measure.em2px(-.284625)+" "+o.measure.em2px(.03825)+"T"+o.measure.em2px(-.2295)+" "+o.measure.em2px(.091125)+"T"+o.measure.em2px(-.162)+" "+o.measure.em2px(.176625)+"T"+o.measure.em2px(-.10125)+" "+o.measure.em2px(.30825)+"T"+o.measure.em2px(-.068625)+" "+o.measure.em2px(.482625)+"Q"+o.measure.em2px(-.0675)+" "+o.measure.em2px(.496125)+" "+o.measure.em2px(-.0675)+" "+o.measure.em2px(.759375)+"Z",r.createSVGElement("path",{d:i,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+o.measure.em2px(this.x)+","+o.measure.em2px(-this.y)+") rotate("+-this.degree+") scale("+a/1.125+")"})}},{key:"getBoundingBox",value:function(){var r=o.measure.oneem;return new O.Rect(this.x,this.y,{l:.274*r,r:.274*r,u:Math.max(1.41975*r/1.125,this.up),d:Math.max(1.41975*r/1.125,this.down)}).rotate(this.degree*Math.PI/180)}},{key:"toString",value:function(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}}]),n})(d),d.LeftParenthesis=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c){var l;return V(this,n),(l=t.call(this)).x=r,l.y=i,l.height=a,l.degree=s,l.color=c||"currentColor",F(_(l),"getBoundingBox"),l}return I(n,[{key:"draw",value:function(r){var i,a=o.measure.oneem,s=Math.max(.660375,this.height/2/a*1.125)-.660375,c=-s;i="M"+o.measure.em2px(-.0675)+" "+o.measure.em2px(s)+"T"+o.measure.em2px(-.068625)+" "+o.measure.em2px(.07875+s)+"Q"+o.measure.em2px(-.068625)+" "+o.measure.em2px(.190125+s)+" "+o.measure.em2px(-.0585)+" "+o.measure.em2px(.250875+s)+"T"+o.measure.em2px(-.01125)+" "+o.measure.em2px(.387+s)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(.55575+s)+" "+o.measure.em2px(.2475)+" "+o.measure.em2px(.6525+s)+"L"+o.measure.em2px(.262125)+" "+o.measure.em2px(.660375+s)+"L"+o.measure.em2px(.3015)+" "+o.measure.em2px(.660375+s)+"L"+o.measure.em2px(.30825)+" "+o.measure.em2px(.653625+s)+"V"+o.measure.em2px(.622125+s)+"Q"+o.measure.em2px(.30825)+" "+o.measure.em2px(.60975+s)+" "+o.measure.em2px(.2925)+" "+o.measure.em2px(.60075+s)+"Q"+o.measure.em2px(.205875)+" "+o.measure.em2px(.541125+s)+" "+o.measure.em2px(.149625)+" "+o.measure.em2px(.44775+s)+"T"+o.measure.em2px(.07425)+" "+o.measure.em2px(.239625+s)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(.2385+s)+" "+o.measure.em2px(.073125)+" "+o.measure.em2px(.235125+s)+"Q"+o.measure.em2px(.068625)+" "+o.measure.em2px(.203625+s)+" "+o.measure.em2px(.0675)+" "+o.measure.em2px(.041625+s)+"L"+o.measure.em2px(.0675)+" "+o.measure.em2px(-.041625+c)+"Q"+o.measure.em2px(.068625)+" "+o.measure.em2px(-.203625+c)+" "+o.measure.em2px(.073125)+" "+o.measure.em2px(-.235125+c)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(-.2385+c)+" "+o.measure.em2px(.07425)+" "+o.measure.em2px(-.239625+c)+"Q"+o.measure.em2px(.093375)+" "+o.measure.em2px(-.354375+c)+" "+o.measure.em2px(.149625)+" "+o.measure.em2px(-.44775+c)+"T"+o.measure.em2px(.2925)+" "+o.measure.em2px(-.60075+c)+"Q"+o.measure.em2px(.30825)+" "+o.measure.em2px(-.60975+c)+" "+o.measure.em2px(.30825)+" "+o.measure.em2px(-.622125+c)+"L"+o.measure.em2px(.30825)+" "+o.measure.em2px(-.653625+c)+"L"+o.measure.em2px(.3015)+" "+o.measure.em2px(-.660375+c)+"L"+o.measure.em2px(.262125)+" "+o.measure.em2px(-.660375+c)+"L"+o.measure.em2px(.2475)+" "+o.measure.em2px(-.6525+c)+"Q"+o.measure.em2px(.07425)+" "+o.measure.em2px(-.55575+c)+" "+o.measure.em2px(-.01125)+" "+o.measure.em2px(-.387+c)+"Q"+o.measure.em2px(-.048375)+" "+o.measure.em2px(-.311625+c)+" "+o.measure.em2px(-.0585)+" "+o.measure.em2px(-.250875+c)+"T"+o.measure.em2px(-.068625)+" "+o.measure.em2px(-.07875+c)+"Q"+o.measure.em2px(-.0675)+" "+o.measure.em2px(c)+" "+o.measure.em2px(-.0675)+" "+o.measure.em2px(c)+"Z",r.createSVGElement("path",{d:i,fill:this.color,stroke:this.color,"stroke-width":"0pt",transform:"translate("+o.measure.em2px(this.x)+","+o.measure.em2px(-this.y)+") rotate("+-this.degree+") scale("+a/1.125+")"})}},{key:"getBoundingBox",value:function(){var r=o.measure.oneem;return new O.Rect(this.x,this.y,{l:.06*r,r:.274*r,u:Math.max(.660375*r/1.125,this.height/2),d:Math.max(.660375*r/1.125,this.height/2)}).rotate(this.degree*Math.PI/180)}},{key:"toString",value:function(){return"LeftBrace[x:"+this.x+", y:"+this.y+", up:"+this.up+", down:"+this.down+"]"}}]),n})(d),d.TextShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.math=i,a.originalBBox=void 0,F(_(a),"getBoundingBox"),F(_(a),"getOriginalReferencePoint"),a}return I(n,[{key:"draw",value:function(r){this._draw(r,!1)}},{key:"getBoundingBox",value:function(){return this._draw(o.svgForTestLayout,!0)}},{key:"_draw",value:function(r,i){return r.xypicWrapper.drawTextObject(this,r,i)}},{key:"getOriginalReferencePoint",value:function(){this.getBoundingBox();var r=this.originalBBox,i=this.c,a=r.H,s=r.D;return new O.Point(i.x,i.y-(a-s)/2)}},{key:"toString",value:function(){return"TextShape[c:"+this.c.toString()+", math:"+this.math.toString()+"]"}}]),n})(d),d.ImageShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.url=i,F(_(a),"getBoundingBox"),F(_(a),"getOriginalReferencePoint"),a}return I(n,[{key:"draw",value:function(r){var i=this.c;r.createSVGElement("image",{x:o.measure.em2px(i.x-i.l),y:o.measure.em2px(-i.y-i.u),width:o.measure.em2px(i.l+i.r),height:o.measure.em2px(i.u+i.d),preserveAspectRatio:"none","xlink:href":this.url})}},{key:"getBoundingBox",value:function(){return this.c}},{key:"getOriginalReferencePoint",value:function(){return this.c}},{key:"toString",value:function(){return"ImageShape[c:"+this.c.toString()+", height:"+this.height+", width:"+this.width+", url:"+this.url+"]"}}]),n})(d),d.ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(){return V(this,n),t.call(this)}return I(n,[{key:"draw",value:function(r){var i=r.createGroup(r.transformBuilder().translate(this.c.x,this.c.y).rotateRadian(this.angle));this.drawDelegate(i)}},{key:"getBoundingBox",value:function(){return this.c.toRect(this.getBox()).rotate(this.angle)}},{key:"toString",value:function(){return"ArrowheadShape[c:"+this.c.toString()+", angle:"+this.angle+"]"}}]),n})(d),d.GT2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.456*r,r:0,d:.229*r,u:.229*r}}},{key:"getRadius",value:function(){return .213*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=r.createGroup(r.transformBuilder().rotateDegree(-10)),s=r.createGroup(r.transformBuilder().rotateDegree(10));a.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.GT3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.507*r,r:0,d:.268*r,u:.268*r}}},{key:"getRadius",value:function(){return .325*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=r.createGroup(r.transformBuilder().rotateDegree(-15)),s=r.createGroup(r.transformBuilder().rotateDegree(15));a.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("line",{x1:0,y1:0,x2:o.measure.em2px(-.507*i),y2:0}),s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.UpperGTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r,r:0,d:0,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.LowerGTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r,r:0,d:.147*r,u:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.GTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r,r:0,d:.147*r,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.LT2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.456*r,d:.229*r,u:.229*r}}},{key:"getRadius",value:function(){return .213*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=r.createGroup(r.transformBuilder().rotateDegree(10)),s=r.createGroup(r.transformBuilder().rotateDegree(-10));a.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.LT3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.507*r,d:.268*r,u:.268*r}}},{key:"getRadius",value:function(){return .325*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=r.createGroup(r.transformBuilder().rotateDegree(15)),s=r.createGroup(r.transformBuilder().rotateDegree(-15));a.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("line",{x1:0,y1:0,x2:o.measure.em2px(.507*i),y2:0}),s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.UpperLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r,d:0,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.LowerLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r,d:.147*r,u:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.LTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r,d:.147*r,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem;r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.UpperColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-i})}}]),n})(d.ArrowheadShape),d.LowerColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:0,d:o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:i})}}]),n})(d.ArrowheadShape),d.Column2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:.5*(o.measure.lineElementLength+o.measure.thickness),d:.5*(o.measure.lineElementLength+o.measure.thickness)}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(.5*(o.measure.lineElementLength+o.measure.thickness));r.createSVGElement("line",{x1:0,y1:i,x2:0,y2:-i})}}]),n})(d.ArrowheadShape),d.Column3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:.5*o.measure.lineElementLength+o.measure.thickness,d:.5*o.measure.lineElementLength+o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(.5*o.measure.lineElementLength+o.measure.thickness);r.createSVGElement("line",{x1:0,y1:i,x2:0,y2:-i})}}]),n})(d.ArrowheadShape),d.ColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:i,x2:0,y2:-i})}}]),n})(d.ArrowheadShape),d.UpperLParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:0,u:o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,1 0,"+-2*i})}}]),n})(d.ArrowheadShape),d.LowerLParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:0,u:0,d:o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,0 0,"+2*i})}}]),n})(d.ArrowheadShape),d.LParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.5*o.measure.lineElementLength,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M"+i+","+-i+" A "+i+","+i+" 0 0,0 "+i+","+i})}}]),n})(d.ArrowheadShape),d.UpperRParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.5*o.measure.lineElementLength,u:o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,0 0,"+-2*i})}}]),n})(d.ArrowheadShape),d.LowerRParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.5*o.measure.lineElementLength,u:0,d:o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,1 0,"+2*i})}}]),n})(d.ArrowheadShape),d.RParenArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M"+-i+","+-i+" A "+i+","+i+" 0 0,1 "+-i+","+i})}}]),n})(d.ArrowheadShape),d.LowerBackquoteArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:0,u:0,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,0 "+-i+","+i})}}]),n})(d.ArrowheadShape),d.UpperBackquoteArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:0,u:.5*o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,1 "+-i+","+-i})}}]),n})(d.ArrowheadShape),d.LowerQuoteArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.5*o.measure.lineElementLength,u:0,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,1 "+i+","+i})}}]),n})(d.ArrowheadShape),d.UpperQuoteArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.5*o.measure.lineElementLength,u:.5*o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("path",{d:"M0,0 A "+i+","+i+" 0 0,0 "+i+","+-i})}}]),n})(d.ArrowheadShape),d.AsteriskArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=0,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:o.measure.thickness,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){r.createSVGElement("circle",{cx:0,cy:0,r:o.measure.em2px(o.measure.thickness),fill:"currentColor"})}}]),n})(d.ArrowheadShape),d.OArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=0,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:o.measure.thickness,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){r.createSVGElement("circle",{cx:0,cy:0,r:o.measure.em2px(o.measure.thickness)})}}]),n})(d.ArrowheadShape),d.PlusArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:.5*o.measure.lineElementLength,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.lineElementLength/2,a=o.measure.em2px(i);r.createSVGElement("line",{x1:-a,y1:0,x2:a,y2:0}),r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a})}}]),n})(d.ArrowheadShape),d.XArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i+Math.PI/4,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.5*o.measure.lineElementLength,r:.5*o.measure.lineElementLength,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.lineElementLength/2,a=o.measure.em2px(i);r.createSVGElement("line",{x1:-a,y1:0,x2:a,y2:0}),r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a})}}]),n})(d.ArrowheadShape),d.SlashArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i-Math.PI/10,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:o.measure.lineElementLength/2,d:o.measure.lineElementLength/2}}},{key:"drawDelegate",value:function(r){var i=o.measure.lineElementLength/2,a=o.measure.em2px(i);r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a})}}]),n})(d.ArrowheadShape),d.Line3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.lineElementLength),a=o.measure.em2px(o.measure.thickness);r.createSVGElement("line",{x1:0,y1:a,x2:i,y2:a}),r.createSVGElement("line",{x1:0,y1:0,x2:i,y2:0}),r.createSVGElement("line",{x1:0,y1:-a,x2:i,y2:-a})}}]),n})(d.ArrowheadShape),d.Line2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:.5*o.measure.thickness,d:.5*o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(.5*o.measure.thickness),a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:i,x2:a,y2:i}),r.createSVGElement("line",{x1:0,y1:-i,x2:a,y2:-i})}}]),n})(d.ArrowheadShape),d.LineArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:0,d:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:i,y2:0})}}]),n})(d.ArrowheadShape),d.Dot3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){o.measure.oneem;var i=o.measure.em2px(o.measure.thickness),a=o.measure.em2px(o.measure.thickness),s=o.measure.dottedDasharray;r.createSVGElement("line",{x1:0,y1:i,x2:a,y2:i,"stroke-dasharray":s}),r.createSVGElement("line",{x1:0,y1:0,x2:a,y2:0,"stroke-dasharray":s}),r.createSVGElement("line",{x1:0,y1:-i,x2:a,y2:-i,"stroke-dasharray":s})}}]),n})(d.ArrowheadShape),d.Dot2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:.5*o.measure.thickness,d:.5*o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(.5*o.measure.thickness),a=o.measure.em2px(o.measure.thickness),s=o.measure.dottedDasharray;r.createSVGElement("line",{x1:0,y1:i,x2:a,y2:i,"stroke-dasharray":s}),r.createSVGElement("line",{x1:0,y1:-i,x2:a,y2:-i,"stroke-dasharray":s})}}]),n})(d.ArrowheadShape),d.DotArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:0,u:0,d:0}}},{key:"drawDelegate",value:function(r){o.measure.oneem;var i=o.measure.em2px(o.measure.thickness),a=o.measure.dottedDasharray;r.createSVGElement("line",{x1:0,y1:0,x2:i,y2:0,"stroke-dasharray":a})}}]),n})(d.ArrowheadShape),d.Tilde3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:-2*o.measure.thickness,r:2*o.measure.thickness,u:2*o.measure.thickness,d:2*o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.thickness);r.createSVGElement("path",{d:"M"+-2*i+","+i+" Q"+-i+",0 0,"+i+" T"+2*i+","+i+"M"+-2*i+",0 Q"+-i+","+-i+" 0,0 T"+2*i+",0M"+-2*i+","+-i+" Q"+-i+","+-2*i+" 0,"+-i+" T"+2*i+","+-i})}}]),n})(d.ArrowheadShape),d.Tilde2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:-2*o.measure.thickness,r:2*o.measure.thickness,u:1.5*o.measure.thickness,d:1.5*o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.thickness);r.createSVGElement("path",{d:"M"+-2*i+","+.5*i+" Q"+-i+","+-.5*i+" 0,"+.5*i+" T"+2*i+","+.5*i+"M"+-2*i+","+-.5*i+" Q"+-i+","+-1.5*i+" 0,"+-.5*i+" T"+2*i+","+-.5*i})}}]),n})(d.ArrowheadShape),d.TildeArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:-2*o.measure.thickness,r:2*o.measure.thickness,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.thickness);r.createSVGElement("path",{d:"M"+-2*i+",0 Q"+-i+","+-i+" 0,0 T"+2*i+",0"})}}]),n})(d.ArrowheadShape),d.TildeArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:-2*o.measure.thickness,r:2*o.measure.thickness,u:o.measure.thickness,d:o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.thickness);r.createSVGElement("path",{d:"M"+-2*i+",0 Q"+-i+","+-i+" 0,0 T"+2*i+",0"})}}]),n})(d.ArrowheadShape),d.GTGTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r+2*o.measure.thickness,r:0,d:.147*r,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+-s+",0 Q"+(o.measure.em2px(-.222*i)-s)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(-.489*i)-s)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M"+-s+",0 Q"+(o.measure.em2px(-.222*i)-s)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(-.489*i)-s)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.UpperGTGTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r+2*o.measure.thickness,r:0,d:0,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+-s+",0 Q"+(o.measure.em2px(-.222*i)-s)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(-.489*i)-s)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.LowerGTGTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.489*r+2*o.measure.thickness,r:0,d:.147*r,u:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+-s+",0 Q"+(o.measure.em2px(-.222*i)-s)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(-.489*i)-s)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.GTGT2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.456*r+2*o.measure.thickness,r:0,d:.229*r,u:.229*r}}},{key:"getRadius",value:function(){return .213*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=r.createGroup(r.transformBuilder().rotateDegree(-10)),c=r.createGroup(r.transformBuilder().rotateDegree(10));s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),c.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)});var l=r.createGroup(r.transformBuilder().translate(-2*a,0).rotateDegree(-10)),h=r.createGroup(r.transformBuilder().translate(-2*a,0).rotateDegree(10));l.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),h.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.GTGT3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:.507*r+2*o.measure.thickness,r:0,d:.268*r,u:.268*r}}},{key:"getRadius",value:function(){return .325*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=r.createGroup(r.transformBuilder().rotateDegree(-15)),c=r.createGroup(r.transformBuilder().rotateDegree(15));s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),c.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)});var l=r.createGroup(r.transformBuilder().translate(-2*a,0).rotateDegree(-15)),h=r.createGroup(r.transformBuilder().translate(-2*a,0).rotateDegree(15));l.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),h.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("line",{x1:0,y1:0,x2:o.measure.em2px(-.507*i-2*a),y2:0})}}]),n})(d.ArrowheadShape),d.LTLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r+2*o.measure.thickness,d:.147*r,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+s+",0 Q"+(o.measure.em2px(.222*i)+s)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(.489*i)+s)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M"+s+",0 Q"+(o.measure.em2px(.222*i)+s)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(.489*i)+s)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.UpperLTLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r+2*o.measure.thickness,d:0,u:.147*r}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+s+",0 Q"+(o.measure.em2px(.222*i)+s)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(.489*i)+s)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.LowerLTLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.489*r+2*o.measure.thickness,d:.147*r,u:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+s+",0 Q"+(o.measure.em2px(.222*i)+s)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(.489*i)+s)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.LTLT2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.456+r+2*o.measure.thickness,d:.229*r,u:.229*r}}},{key:"getRadius",value:function(){return .213*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=r.createGroup(r.transformBuilder().translate(2*a,0).rotateDegree(10)),c=r.createGroup(r.transformBuilder().translate(2*a,0).rotateDegree(-10));s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),c.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)});var l=r.createGroup(r.transformBuilder().rotateDegree(10)),h=r.createGroup(r.transformBuilder().rotateDegree(-10));l.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),h.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.LTLT3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:0,r:.507*r+2*o.measure.thickness,d:.268*r,u:.268*r}}},{key:"getRadius",value:function(){return .325*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=r.createGroup(r.transformBuilder().translate(2*a,0).rotateDegree(15)),c=r.createGroup(r.transformBuilder().translate(2*a,0).rotateDegree(-15));s.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),c.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)});var l=r.createGroup(r.transformBuilder().rotateDegree(15)),h=r.createGroup(r.transformBuilder().rotateDegree(-15));l.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),h.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("line",{x1:0,y1:0,x2:o.measure.em2px(.507*i+2*a),y2:0})}}]),n})(d.ArrowheadShape),d.ColumnColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("line",{x1:-o.measure.em2px(i),y1:a,x2:-o.measure.em2px(i),y2:-a})}}]),n})(d.ArrowheadShape),d.UpperColumnColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-a}),r.createSVGElement("line",{x1:-o.measure.em2px(i),y1:0,x2:-o.measure.em2px(i),y2:-a})}}]),n})(d.ArrowheadShape),d.LowerColumnColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:0,d:o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:a}),r.createSVGElement("line",{x1:-o.measure.em2px(i),y1:0,x2:-o.measure.em2px(i),y2:a})}}]),n})(d.ArrowheadShape),d.ColumnColumn2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:.5*(o.measure.lineElementLength+o.measure.thickness),d:.5*(o.measure.lineElementLength+o.measure.thickness)}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(.5*(o.measure.lineElementLength+o.measure.thickness));r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("line",{x1:-o.measure.em2px(i),y1:a,x2:-o.measure.em2px(i),y2:-a})}}]),n})(d.ArrowheadShape),d.ColumnColumn3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:.5*o.measure.lineElementLength+o.measure.thickness,d:.5*o.measure.lineElementLength+o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=(i=o.measure.thickness,o.measure.em2px(.5*o.measure.lineElementLength+o.measure.thickness));r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("line",{x1:-o.measure.em2px(i),y1:a,x2:-o.measure.em2px(i),y2:-a})}}]),n})(d.ArrowheadShape),d.ColumnLineArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:i,x2:0,y2:-i});var a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:a,y2:0})}}]),n})(d.ArrowheadShape),d.UpperColumnLineArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:o.measure.lineElementLength,d:0}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:-i});var a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:a,y2:0})}}]),n})(d.ArrowheadShape),d.LowerColumnLineArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:0,d:o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){o.measure.thickness;var i=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:0,y2:i});var a=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:0,x2:a,y2:0})}}]),n})(d.ArrowheadShape),d.ColumnLine2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:.5*(o.measure.lineElementLength+o.measure.thickness),d:.5*(o.measure.lineElementLength+o.measure.thickness)}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(.5*(o.measure.lineElementLength+o.measure.thickness));r.createSVGElement("line",{x1:0,y1:-a,x2:0,y2:a});var s=o.measure.em2px(.5*i),c=o.measure.em2px(o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:s,x2:c,y2:s}),r.createSVGElement("line",{x1:0,y1:-s,x2:c,y2:-s})}}]),n})(d.ArrowheadShape),d.ColumnLine3ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:o.measure.lineElementLength,u:.5*o.measure.lineElementLength+o.measure.thickness,d:.5*o.measure.lineElementLength+o.measure.thickness}}},{key:"drawDelegate",value:function(r){var i=o.measure.thickness,a=o.measure.em2px(.5*o.measure.lineElementLength+o.measure.thickness);r.createSVGElement("line",{x1:0,y1:-a,x2:0,y2:a});var s=o.measure.em2px(o.measure.lineElementLength),c=o.measure.em2px(i);r.createSVGElement("line",{x1:0,y1:c,x2:s,y2:c}),r.createSVGElement("line",{x1:0,y1:0,x2:s,y2:0}),r.createSVGElement("line",{x1:0,y1:-c,x2:s,y2:-c})}}]),n})(d.ArrowheadShape),d.GTColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.489*o.measure.oneem,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.GTGTColumnArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:.489*o.measure.oneem+2*o.measure.thickness,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:s,x2:0,y2:-s});var c=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+-c+",0 Q"+(o.measure.em2px(-.222*i)-c)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(-.489*i)-c)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M"+-c+",0 Q"+(o.measure.em2px(-.222*i)-c)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(-.489*i)-c)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)})}}]),n})(d.ArrowheadShape),d.ColumnLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.489*o.measure.oneem,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=(o.measure.thickness,o.measure.em2px(.5*o.measure.lineElementLength));r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.ColumnLTLTArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:0,r:.489*o.measure.oneem+2*o.measure.thickness,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.thickness,s=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:s,x2:0,y2:-s});var c=o.measure.em2px(2*a);r.createSVGElement("path",{d:"M"+c+",0 Q"+(o.measure.em2px(.222*i)+c)+","+o.measure.em2px(-.02*i)+" "+(o.measure.em2px(.489*i)+c)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M"+c+",0 Q"+(o.measure.em2px(.222*i)+c)+","+o.measure.em2px(.02*i)+" "+(o.measure.em2px(.489*i)+c)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(-.147*i)}),r.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(.489*i)+","+o.measure.em2px(.147*i)})}}]),n})(d.ArrowheadShape),d.SlashSlashArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i-Math.PI/10,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return{l:o.measure.thickness,r:0,u:.5*o.measure.lineElementLength,d:.5*o.measure.lineElementLength}}},{key:"drawDelegate",value:function(r){var i=o.measure.em2px(o.measure.thickness),a=o.measure.em2px(.5*o.measure.lineElementLength);r.createSVGElement("line",{x1:0,y1:a,x2:0,y2:-a}),r.createSVGElement("line",{x1:-i,y1:a,x2:-i,y2:-a})}}]),n})(d.ArrowheadShape),d.LineGT2ArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){var r=o.measure.oneem;return{l:o.measure.lineElementLength,r:o.measure.lineElementLength,d:.229*r,u:.229*r}}},{key:"getRadius",value:function(){return .213*o.measure.oneem}},{key:"drawDelegate",value:function(r){var i=o.measure.oneem,a=o.measure.lineElementLength,s=o.measure.em2px(a),c=.5*o.measure.thickness,l=o.measure.em2px(c),h=this.getRadius(),m=o.measure.em2px(Math.sqrt(h*h-c*c)),p=r.createGroup(r.transformBuilder().translate(a,0).rotateDegree(-10)),f=r.createGroup(r.transformBuilder().translate(a,0).rotateDegree(10));p.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(-.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(-.147*i)}),f.createSVGElement("path",{d:"M0,0 Q"+o.measure.em2px(-.222*i)+","+o.measure.em2px(.02*i)+" "+o.measure.em2px(-.489*i)+","+o.measure.em2px(.147*i)}),r.createSVGElement("path",{d:"M"+-s+","+l+" L"+(s-m)+","+l+" M"+-s+","+-l+" L"+(s-m)+","+-l})}}]),n})(d.ArrowheadShape),d.TwocellEqualityArrowheadShape=(function(e){z(n,e);var t=Q(n);function n(r,i){var a;return V(this,n),(a=t.call(this)).c=r,a.angle=i,F(_(a),"getBoundingBox"),a}return I(n,[{key:"getBox",value:function(){return o.measure.oneem,{l:o.measure.lineElementLength,r:o.measure.lineElementLength,d:.5*o.measure.thickness,u:.5*o.measure.thickness}}},{key:"drawDelegate",value:function(r){o.measure.oneem;var i=o.measure.em2px(o.measure.lineElementLength),a=o.measure.em2px(.5*o.measure.thickness);r.createSVGElement("path",{d:"M"+-i+","+a+" L"+i+","+a+" M"+-i+","+-a+" L"+i+","+-a})}}]),n})(d.ArrowheadShape),d.LineShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s,c){var l;return V(this,n),(l=t.call(this)).line=r,l.object=i,l.main=a,l.variant=s,l.bbox=c,l.holeRanges=j.empty,l}return I(n,[{key:"sliceHole",value:function(r){this.holeRanges=this.holeRanges.prepend(r)}},{key:"draw",value:function(r){this.line.drawLine(r,this.object,this.main,this.variant,this.holeRanges)}},{key:"getBoundingBox",value:function(){return this.bbox}},{key:"toString",value:function(){return"LineShape[line:"+this.line+", object:"+this.object+", main:"+this.main+", variant:"+this.variant+"]"}}]),n})(d),d.CurveShape=(function(e){z(n,e);var t=Q(n);function n(r,i,a,s){var c;return V(this,n),(c=t.call(this)).curve=r,c.objectForDrop=i,c.objectForConnect=a,c.bbox=s,c.holeRanges=j.empty,c}return I(n,[{key:"sliceHole",value:function(r){this.holeRanges=this.holeRanges.prepend(r)}},{key:"draw",value:function(r){this.curve.drawCurve(r,this.objectForDrop,this.objectForConnect,this.holeRanges)}},{key:"getBoundingBox",value:function(){return this.bbox}},{key:"toString",value:function(){return"CurveShape[curve"+this.curve+", objectForDrop:"+(this.objectForDrop===void 0?"null":this.objectForDrop.toString())+", objectForConnect:"+(this.objectForConnect===void 0?"null":this.objectForConnect.toString())+"]"}}]),n})(d);var Ge=(function(){function e(r,i){(function(a,s){if(!(a instanceof s))throw TypeError("Cannot call a class as a function")})(this,e),r>i?(this.start=i,this.end=r):(this.start=r,this.end=i)}var t,n;return t=e,(n=[{key:"difference",value:function(r){var i=j.empty,a=this.start,s=this.end,c=r.start,l=r.end;return s<=c||l<=a?i=i.prepend(this):a<c?i=s<=l?i.prepend(new e(a,c)):(i=i.prepend(new e(a,c))).prepend(new e(l,s)):l<s&&(i=i.prepend(new e(l,s))),i}},{key:"differenceRanges",value:function(r){var i=j.empty.prepend(this);return r.foreach((function(a){i=i.flatMap((function(s){return s.difference(a)}))})),i}},{key:"toString",value:function(){return"["+this.start+", "+this.end+"]"}}])&&jr(t.prototype,n),e})();function Dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le=(function(){function e(r,i){(function(a,s){if(!(a instanceof s))throw TypeError("Cannot call a class as a function")})(this,e),this.shape=r,this.env=i}var t,n;return t=e,(n=[{key:"duplicateEnv",value:function(){var r=this.env.duplicate();return new e(this.shape,r)}},{key:"appendShapeToFront",value:function(r){r.isNone||(this.shape.isNone?this.shape=r:this.shape=new d.CompositeShape(r,this.shape))}},{key:"appendShapeToBack",value:function(r){r.isNone||(this.shape.isNone?this.shape=r:this.shape=new d.CompositeShape(this.shape,r))}}])&&Dr(t.prototype,n),e})();function cn(e){return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cn(e)}function Ve(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hn(e,t)}function hn(e,t){return hn=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},hn(e,t)}function Ie(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=Ct(e);if(t){var i=Ct(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tr(this,n)}}function Tr(e,t){if(t&&(cn(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function Ct(e){return Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(e)}function Pe(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return t&&Yn(e.prototype,t),n&&Yn(e,n),e}var be=(function(){function e(){Pe(this,e);var t=o.measure.length2em("1mm");this.origin={x:0,y:0},this.xBase={x:t,y:0},this.yBase={x:0,y:t},this.savedPosition={},this.stateStack=j.empty,this.stackFrames=j.empty,this.stack=j.empty,this.angle=0,this.lastCurve=ne.none,this.p=this.c=e.originPosition,this.shouldCapturePos=!1,this.capturedPositions=j.empty,this.objectmargin=o.measure.objectmargin,this.objectheight=o.measure.objectheight,this.objectwidth=o.measure.objectwidth,this.labelmargin=o.measure.labelmargin}return Ae(e,[{key:"duplicate",value:function(){var t=new e;return e.copyFields(this,t),t}},{key:"saveState",value:function(){var t=this.duplicate();this.stateStack=this.stateStack.prepend(t)}},{key:"restoreState",value:function(){if(!this.stateStack.isEmpty){var t=this.stateStack.head;this.stateStack=this.stateStack.tail,e.copyFields(t,this)}}},{key:"absVector",value:function(t,n){return{x:this.origin.x+t*this.xBase.x+n*this.yBase.x,y:this.origin.y+t*this.xBase.y+n*this.yBase.y}}},{key:"inverseAbsVector",value:function(t,n){var r=this.xBase.x,i=this.xBase.y,a=this.yBase.x,s=this.yBase.y,c=r*s-i*a,l=t-this.origin.x,h=n-this.origin.y;return{x:(s*l-a*h)/c,y:(-i*l+r*h)/c}}},{key:"setOrigin",value:function(t,n){this.origin={x:t,y:n}}},{key:"setXBase",value:function(t,n){this.xBase={x:t,y:n}}},{key:"setYBase",value:function(t,n){this.yBase={x:t,y:n}}},{key:"swapPAndC",value:function(){var t=this.p;this.p=this.c,this.c=t}},{key:"enterStackFrame",value:function(){this.stackFrames=this.stackFrames.prepend(this.stack),this.initStack()}},{key:"leaveStackFrame",value:function(){this.stackFrames.isEmpty?this.initStack():(this.stack=this.stackFrames.head,this.stackFrames=this.stackFrames.tail)}},{key:"savePos",value:function(t,n){this.savedPosition[t]=n}},{key:"startCapturePositions",value:function(){this.shouldCapturePos=!0,this.capturedPositions=j.empty}},{key:"endCapturePositions",value:function(){this.shouldCapturePos=!1;var t=this.capturedPositions;return this.capturedPositions=j.empty,t}},{key:"capturePosition",value:function(t){this.shouldCapturePos&&t!==void 0&&(this.capturedPositions=this.capturedPositions.prepend(t))}},{key:"pushPos",value:function(t){t!==void 0&&(this.stack=this.stack.prepend(t))}},{key:"popPos",value:function(){if(this.stack.isEmpty)throw ye("ExecutionError","cannot pop from the empty stack");var t=this.stack.head;return this.stack=this.stack.tail,t}},{key:"initStack",value:function(){this.stack=j.empty}},{key:"setStack",value:function(t){this.stack=t}},{key:"stackAt",value:function(t){return this.stack.at(t)}},{key:"lookupPos",value:function(t,n){var r=this.savedPosition[t];if(r===void 0)throw ye("ExecutionError",n===void 0?'<pos> "'+t+'" not defined.':n);return r}},{key:"toString",value:function(){var t="";for(var n in this.savedPosition)this.savedPosition.hasOwnProperty(n)&&(t.length>0&&(t+=", "),t+=n.toString()+":"+this.savedPosition[n]);return`Env
  p:`+this.p+`
  c:`+this.c+`
  angle:`+this.angle+`
  lastCurve:`+this.lastCurve+`
  savedPosition:{`+t+`}
  origin:{x:`+this.origin.x+", y:"+this.origin.y+`}
  xBase:{x:`+this.xBase.x+", y:"+this.xBase.y+`}
  yBase:{x:`+this.yBase.x+", y:"+this.yBase.y+`}
  stackFrames:`+this.stackFrames+`
  stack:`+this.stack+`
  shouldCapturePos:`+this.shouldCapturePos+`
  capturedPositions:`+this.capturedPositions}}],[{key:"copyFields",value:function(t,n){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);for(var i in n.savedPosition={},t.savedPosition)t.savedPosition.hasOwnProperty(i)&&(n.savedPosition[i]=t.savedPosition[i])}}]),e})();be.originPosition=new O.Point(0,0);var K=(function(){function e(){Pe(this,e)}return Ae(e,[{key:"velocity",value:function(t){var n=this.dpx(t),r=this.dpy(t);return Math.sqrt(n*n+r*r)}},{key:"length",value:function(t){if(t<0||t>1)throw ye("ExecutionError","illegal cubic Bezier parameter t:"+t);this.buildLengthArray();var n=t*Be.lengthResolution,r=Math.floor(n),i=Math.ceil(n);if(r===i)return this.lengthArray[r];var a=this.lengthArray[r];return a+(this.lengthArray[i]-a)/(i-r)*(n-r)}},{key:"tOfLength",value:function(t){this.buildLengthArray();var n,r,i,a=this.lengthArray;if(t<a[0])return 0;if(t>a[a.length-1])return 1;for(var s=0,c=a.length-2;s<=c&&(r=a[n=s+c>>1],i=a[n+1],!(t>=r&&t<=i));)t<r?c=n-1:s=n+1;var l=Be.lengthResolution;return r===i?n/l:(n+(t-r)/(i-r))/l}},{key:"tOfShavedStart",value:function(t){if(t.isPoint())return 0;var n=this.tOfIntersections(t);return n.length==0?void 0:Math.min.apply(Math,n)}},{key:"tOfShavedEnd",value:function(t){if(t.isPoint())return 1;var n=this.tOfIntersections(t);return n.length==0?void 0:Math.max.apply(Math,n)}},{key:"shaveStart",value:function(t){if(t.isPoint())return this;var n=this.tOfIntersections(t);if(n.length!=0){var r=Math.min.apply(Math,n);return this.divide(r)[1]}}},{key:"shaveEnd",value:function(t){if(t.isPoint())return this;var n=this.tOfIntersections(t);if(n.length!=0){var r=Math.max.apply(Math,n);return this.divide(r)[0]}}},{key:"buildLengthArray",value:function(){if(this.lengthArray===void 0){var t=Be.lengthResolution,n=Array(t+1),r=0,i=.5/t,a=0,s=i/3;n[0]=0,r=this.velocity(0)+4*this.velocity(i);var c=this.velocity(2*i);for(n[1]=s*(r+c),a=2;a<=t;a++)r+=2*c+4*this.velocity((2*a-1)*i),c=this.velocity(2*a*i),n[a]=s*(r+c);this.lengthArray=n}}},{key:"drawParallelCurve",value:function(t,n){var r,i,a,s,c,l,h,m,p=this.countOfSegments()*Be.interpolationResolution,f=Array(p+1),y=Array(p+1),x=Array(p+1),w=Array(p+1),b=Array(p+1),P=Math.PI/2,M=n;for(r=0;r<=p;r++)i=r/p,f[r]=i,a=this.angle(i),c=(s=this.position(i)).x,l=s.y,h=M*Math.cos(a+P),m=M*Math.sin(a+P),y[r]=c+h,x[r]=l+m,w[r]=c-h,b[r]=l-m;e.CubicBeziers.interpolation(f,y,x).drawPrimitive(t,"none"),e.CubicBeziers.interpolation(f,w,b).drawPrimitive(t,"none")}},{key:"drawParallelDottedCurve",value:function(t,n,r){var i=1/o.measure.em,a=i/2,s=i+n,c=this.length(1),l=Math.floor((c-i)/s),h=r;if(l>=0){var m,p=Math.PI/2,f=this.startPosition();for(this.endPosition(),m=0;m<=l;m++){f=a+m*s;var y=this.tOfLength(f),x=this.angle(y),w=this.position(y),b=w.x,P=w.y,M=h*Math.cos(x+p),B=h*Math.sin(x+p);t.createSVGElement("circle",{cx:o.measure.em2px(b+M),cy:-o.measure.em2px(P+B),r:.12,fill:"currentColor"}),t.createSVGElement("circle",{cx:o.measure.em2px(b-M),cy:-o.measure.em2px(P-B),r:.12,fill:"currentColor"})}}}},{key:"drawParallelDashedCurve",value:function(t,n,r){var i,a,s,c,l,h,m,p,f=this.length(1),y=Math.floor((f-n)/(2*n)),x=2*y+1,w=(f-n)/2-y*n,b=Array(y+1),P=Array(y+1),M=Array(y+1),B=Array(y+1),A=Array(y+1),R=Math.PI/2,U=r;for(i=0;i<=x;i++)a=this.tOfLength(w+i*n),b[i]=a,s=this.angle(a),l=(c=this.position(a)).x,h=c.y,m=U*Math.cos(s+R),p=U*Math.sin(s+R),P[i]=l+m,M[i]=h+p,B[i]=l-m,A[i]=h-p;e.CubicBeziers.interpolation(b,P,M).drawSkipped(t),e.CubicBeziers.interpolation(b,B,A).drawSkipped(t)}},{key:"drawSquigCurve",value:function(t,n){var r=o.measure.length2em("0.15em"),i=this.length(1),a=4*r,s=r;if(i>=a){var c,l,h,m,p,f,y,x,w,b=Math.floor(i/a),P=(i-b*a)/2,M=Math.PI/2;switch(n){case"3":c=P,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y="M"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x="M"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w="M"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f);for(var B=0;B<b;B++)c=P+a*B+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x+2*p)+","+o.measure.em2px(-h.y-2*f),x+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),w+=" Q"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),c=P+a*B+2*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),x+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),w+=" "+o.measure.em2px(h.x-2*p)+","+o.measure.em2px(-h.y+2*f),c=P+a*(B+1),l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f);t.createSVGElement("path",{d:y}),t.createSVGElement("path",{d:x}),t.createSVGElement("path",{d:w});break;case"2":for(c=P,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y="M"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x="M"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),B=0;B<b;B++)c=P+a*B+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" Q"+o.measure.em2px(h.x+3*p)+","+o.measure.em2px(-h.y-3*f),x+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),c=P+a*B+2*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),x+=" Q"+o.measure.em2px(h.x-3*p)+","+o.measure.em2px(-h.y+3*f),c=P+a*(B+1),l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f);t.createSVGElement("path",{d:y}),t.createSVGElement("path",{d:x});break;default:for(c=P,l=this.tOfLength(c),h=this.position(l),y="M"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),B=0;B<b;B++)c=P+a*B+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),c=P+a*B+2*r,l=this.tOfLength(c),h=this.position(l),y+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),c=P+a*B+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*(B+1),l=this.tOfLength(c),h=this.position(l),y+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y);t.createSVGElement("path",{d:y})}}}},{key:"drawDashSquigCurve",value:function(t,n){var r=o.measure.thickness,i=this.length(1),a=4*r,s=r;if(i>=a){var c,l,h,m,p,f,y,x,w,b=Math.floor((i-a)/2/a),P=(i-a)/2-b*a,M=Math.PI/2;switch(n){case"3":y=x=w="";for(var B=0;B<=b;B++)c=P+a*B*2,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" M"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" M"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w+=" M"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B*2+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x+2*p)+","+o.measure.em2px(-h.y-2*f),x+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),w+=" Q"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),c=P+a*B*2+2*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B*2+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),x+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),w+=" "+o.measure.em2px(h.x-2*p)+","+o.measure.em2px(-h.y+2*f),c=P+a*(2*B+1),l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),w+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f);t.createSVGElement("path",{d:y}),t.createSVGElement("path",{d:x}),t.createSVGElement("path",{d:w});break;case"2":for(y=x="",B=0;B<=b;B++)c=P+a*B*2,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" M"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" M"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B*2+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" Q"+o.measure.em2px(h.x+3*p)+","+o.measure.em2px(-h.y-3*f),x+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),c=P+a*B*2+2*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*B*2+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),x+=" Q"+o.measure.em2px(h.x-3*p)+","+o.measure.em2px(-h.y+3*f),c=P+a*(2*B+1),l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M)/2,f=s*Math.sin(m+M)/2,y+=" "+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),x+=" "+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f);t.createSVGElement("path",{d:y}),t.createSVGElement("path",{d:x});break;default:for(y="",B=0;B<=b;B++)c=P+a*B*2,l=this.tOfLength(c),h=this.position(l),y+=" M"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),c=P+a*B*2+r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x+p)+","+o.measure.em2px(-h.y-f),c=P+a*B*2+2*r,l=this.tOfLength(c),h=this.position(l),y+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y),c=P+a*B*2+3*r,l=this.tOfLength(c),h=this.position(l),m=this.angle(l),p=s*Math.cos(m+M),f=s*Math.sin(m+M),y+=" Q"+o.measure.em2px(h.x-p)+","+o.measure.em2px(-h.y+f),c=P+a*(2*B+1),l=this.tOfLength(c),h=this.position(l),y+=" "+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y);t.createSVGElement("path",{d:y})}}}},{key:"drawCurve",value:function(t,n,r,i){if(i.isEmpty)this._drawCurve(t,n,r);else{var a=new Ge(0,1).differenceRanges(i),s=this;a.foreach((function(c){s.slice(c.start,c.end)._drawCurve(t,n,r)}))}}},{key:"_drawCurve",value:function(t,n,r){var i,a=o.measure.length2em("0.15em");if(r!==void 0){var s=r.dirMain(),c=r.dirVariant();switch(s){case"=":s="-",c="2";break;case"==":s="--",c="2";break;case":":case"::":s=".",c="2"}switch(s){case"":break;case"-":switch(c){case"2":i=a/2,this.drawParallelCurve(t,i);break;case"3":i=a,this.drawParallelCurve(t,i),this.drawPrimitive(t,"none");break;default:i=0,this.drawPrimitive(t,"none")}break;case".":case"..":switch(c){case"2":i=a/2,this.drawParallelDottedCurve(t,a,i);break;case"3":i=a,this.drawParallelDottedCurve(t,a,i),this.drawPrimitive(t,o.measure.dottedDasharray);break;default:i=0,this.drawPrimitive(t,o.measure.dottedDasharray)}break;case"--":var l=3*a;if((B=this.length(1))>=l)switch(c){case"2":i=a/2,this.drawParallelDashedCurve(t,l,i);break;case"3":i=a,this.drawParallelDashedCurve(t,l,i);var h=(B-l)/2-Math.floor((B-l)/2/l)*l,m=this.tOfLength(h);this.divide(m)[1].drawPrimitive(t,o.measure.em2px(l)+" "+o.measure.em2px(l));break;default:i=0,h=(B-l)/2-Math.floor((B-l)/2/l)*l,m=this.tOfLength(h),this.divide(m)[1].drawPrimitive(t,o.measure.em2px(l)+" "+o.measure.em2px(l))}break;case"~":switch(this.drawSquigCurve(t,c),c){case"2":i=1.5*a;break;case"3":i=2*a;break;default:i=0}break;case"~~":switch(this.drawDashSquigCurve(t,c),c){case"2":i=1.5*a;break;case"3":i=2*a;break;default:i=0}break;default:(R=new be).c=be.originPosition;var p=new le(d.none,R),f=r.boundingBox(p);if(f==null)return;var y,x,w=f.l,b=w+f.r;if(n!==void 0){var P=n.boundingBox(p);P!==void 0&&(y=(x=P.l)+P.r)}else y=0;var M=b+y;M==0&&(M=o.measure.strokeWidth);var B=this.length(1);if((q=Math.floor(B/M))==0)return;h=(B-q*M)/2,p=new le(d.none,R);for(var A=0;A<q;A++)J=h+A*M,n!==void 0&&(Y=this.tOfLength(J+x),R.c=this.position(Y),R.angle=this.angle(Y),n.toDropShape(p).draw(t)),Y=this.tOfLength(J+y+w),R.c=this.position(Y),R.angle=this.angle(Y),r.toDropShape(p).draw(t)}}else{var R;(R=new be).c=be.originPosition,p=new le(d.none,R);var U=n,T=U.boundingBox(p);if(T===void 0)return;var L=T.l+T.r,X=L;X==0&&(X=o.measure.strokeWidth);var q;if(B=this.length(1),(q=Math.floor(B/X))==0)return;for(h=(B-q*X+X-L)/2+T.l,p=new le(d.none,R),A=0;A<q;A++){var J=h+A*X,Y=this.tOfLength(J);R.c=this.position(Y),R.angle=0,U.toDropShape(p).draw(t)}}}},{key:"toShape",value:function(t,n,r){var i,a=t.env,s=o.measure.length2em("0.15em"),c=d.none;if(r!==void 0){var l=r.dirMain(),h=r.dirVariant();switch(l){case"=":l="-",h="2";break;case"==":l="--",h="2";break;case":":case"::":l=".",h="2"}switch(l){case"":i=0;break;case"-":case".":case"..":switch(h){case"2":i=s/2;break;case"3":i=s;break;default:i=0}break;case"--":var m=3*s;if((b=this.length(1))>=m)switch(h){case"2":i=s/2;break;case"3":i=s;break;default:i=0}break;case"~":case"~~":switch(h){case"2":i=1.5*s;break;case"3":i=2*s;break;default:i=0}break;default:var p=r.boundingBox(t);if(p==null)return a.angle=0,a.lastCurve=ne.none,d.none;i=Math.max(p.u,p.d);var f,y=p.l+p.r;if(n!==void 0){var x=n.boundingBox(t);x!==void 0&&(f=x.l+x.r,i=Math.max(i,x.u,x.d))}else f=0;var w=y+f;w==0&&(w=o.measure.strokeWidth);var b=this.length(1);return Math.floor(b/w)==0?(a.angle=0,a.lastCurve=ne.none,d.none):(c=new d.CurveShape(this,n,r,this.boundingBox(i)),t.appendShapeToFront(c),c)}return i===void 0?d.none:(c=new d.CurveShape(this,n,r,this.boundingBox(i)),t.appendShapeToFront(c),c)}if(n!==void 0){var P=n.boundingBox(t);if(P==null)return a.angle=0,a.lastCurve=ne.none,d.none;var M=P.l+P.r;return M==0&&(M=o.measure.strokeWidth),b=this.length(1),Math.floor(b/M)==0?(a.angle=0,a.lastCurve=ne.none,d.none):(i=Math.max(P.u,P.d),c=new d.CurveShape(this,n,r,this.boundingBox(i)),t.appendShapeToFront(c),c)}return c}}],[{key:"sign",value:function(t){return t>0?1:t===0?0:-1}},{key:"solutionsOfCubicEq",value:function(t,n,r,i){if(t===0)return e.solutionsOfQuadEq(n,r,i);var a=n/3/t,s=r/t,c=a*a-s/3,l=-(i/t)/2+s*a/2-a*a*a,h=l*l-c*c*c;if(h===0){var m=2*(w=l**.3333333333333333)-a,p=-w-a;return e.filterByIn0to1([m,p])}if(h>0){var f=l+e.sign(l)*Math.sqrt(h),y=(x=e.sign(f)*Math.abs(f)**(1/3))+(w=c/x)-a;return e.filterByIn0to1([y])}var x=2*Math.sqrt(c),w=Math.acos(2*l/c/x),b=(m=x*Math.cos(w/3)-a,p=x*Math.cos((w+2*Math.PI)/3)-a,x*Math.cos((w+4*Math.PI)/3)-a);return e.filterByIn0to1([m,p,b])}},{key:"solutionsOfQuadEq",value:function(t,n,r){if(t===0)return e.solutionsOfLinearEq(n,r);var i=n*n-4*r*t;if(i>=0){var a=Math.sqrt(i),s=(-n+a)/2/t,c=(-n-a)/2/t;return e.filterByIn0to1([s,c])}return[]}},{key:"solutionsOfLinearEq",value:function(t,n){return t===0?n===0?0:[]:e.filterByIn0to1([-n/t])}},{key:"filterByIn0to1",value:function(t){for(var n=[],r=0;r<t.length;r++){var i=t[r];i>=0&&i<=1&&n.push(i)}return n}}]),e})();K.QuadBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a){var s;Pe(this,n),(s=t.call(this)).cp0=r,s.cp1=i,s.cp2=a;var c=r.x,l=2*(i.x-r.x),h=a.x-2*i.x+r.x;s.px=function(y){return c+y*l+y*y*h},s.dpx=function(y){return l+2*y*h};var m=r.y,p=2*(i.y-r.y),f=a.y-2*i.y+r.y;return s.py=function(y){return m+y*p+y*y*f},s.dpy=function(y){return p+2*y*f},s}return Ae(n,[{key:"startPosition",value:function(){return this.cp0}},{key:"endPosition",value:function(){return this.cp2}},{key:"position",value:function(r){return new O.Point(this.px(r),this.py(r))}},{key:"derivative",value:function(r){return new O.Point(this.dpx(r),this.dpy(r))}},{key:"angle",value:function(r){return Math.atan2(this.dpy(r),this.dpx(r))}},{key:"boundingBox",value:function(r){var i=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,r),a=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,r);if(r===0)return new O.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-i.min,r:i.max-this.cp0.x,u:a.max-this.cp0.y,d:this.cp0.y-a.min});var s=Math.PI/2,c=this.cp0.x,l=this.cp0.y,h=this.cp2.x,m=this.cp2.y,p=this.angle(0)+s,f=this.angle(1)+s,y=r*Math.cos(p),x=r*Math.sin(p),w=r*Math.cos(f),b=r*Math.sin(f),P=Math.min(i.min,c+y,c-y,h+w,h-w),M=Math.max(i.max,c+y,c-y,h+w,h-w),B=Math.min(a.min,l+x,l-x,m+b,m-b),A=Math.max(a.max,l+x,l-x,m+b,m-b);return new O.Rect(c,l,{l:c-P,r:M-c,u:A-l,d:l-B})}},{key:"maxMin",value:function(r,i,a,s){var c,l;r>a?(c=r,l=a):(c=a,l=r);var h,m,p=xt,f=p(r),y=p(i-r),x=p(a-2*i+r);return x!=0&&(m=-y/x)>0&&m<1&&(h=(function(w){return f+2*w*y+w*w*x})(m),c=Math.max(c,h+s,h-s),l=Math.min(l,h+s,h-s)),{min:l,max:c}}},{key:"divide",value:function(r){if(r<0||r>1)throw ye("ExecutionError","illegal quadratic Bezier parameter t:"+r);var i=this.cp0.x,a=this.cp1.x,s=this.cp2.x,c=this.cp0.y,l=this.cp1.y,h=this.cp2.y,m=this.px(r),p=this.py(r),f=this.cp0,y=new O.Point(i+r*(a-i),c+r*(l-c)),x=new O.Point(m,p),w=x,b=new O.Point(a+r*(s-a),l+r*(h-l)),P=this.cp2;return[new K.QuadBezier(f,y,x),new K.QuadBezier(w,b,P)]}},{key:"slice",value:function(r,i){if(!(r>=i)){if(r<0&&(r=0),i>1&&(i=1),r===0&&i===1)return this;this.cp0.x;var a=this.cp1.x,s=this.cp2.x,c=(this.cp0.y,this.cp1.y),l=this.cp2.y,h=this.px(r),m=this.py(r),p=a+r*(s-a),f=c+r*(l-c),y=new O.Point(h,m),x=new O.Point(h+i*(p-h),m+i*(f-m)),w=new O.Point(this.px(i),this.py(i));return new K.QuadBezier(y,x,w)}}},{key:"tOfIntersections",value:function(r){if(r.isPoint())return[];if(r.isRect()){var i,a=r.x+r.r,s=r.x-r.l,c=r.y+r.u,l=r.y-r.d,h=xt,m=this.cp0.x,p=this.cp1.x,f=this.cp2.x,y=h(m),x=h(2*(p-m)),w=h(f-2*p+m),b=function(Re){return y+Re*x+Re*Re*w},P=this.cp0.y,M=this.cp1.y,B=this.cp2.y,A=h(P),R=h(2*(M-P)),U=h(B-2*M+P),T=function(Re){return A+Re*R+Re*Re*U},L=[];i=(i=K.solutionsOfQuadEq(w,x,y-a)).concat(K.solutionsOfQuadEq(w,x,y-s));for(var X=0;X<i.length;X++)(Y=T(Ce=i[X]))>=l&&Y<=c&&L.push(Ce);for(i=(i=K.solutionsOfQuadEq(U,R,A-c)).concat(K.solutionsOfQuadEq(U,R,A-l)),X=0;X<i.length;X++)(J=b(Ce=i[X]))>=s&&J<=a&&L.push(Ce);return L}if(r.isCircle()){var q=Math.PI,J=r.x,Y=r.y,ee=r.l,re=r.r,$=r.u,ue=r.d,me=J+(re-ee)/2,ie=Y+($-ue)/2,he=(a=(ee+re)/2,($+ue)/2),ae=q/180,pe=new oe.Arc(me,ie,a,he,-q-ae,-q/2+ae),ve=new oe.Arc(me,ie,a,he,-q/2-ae,0+ae),xe=new oe.Arc(me,ie,a,he,0-ae,q/2+ae),ge=new oe.Arc(me,ie,a,he,q/2-ae,q+ae),Le=new oe.QuadBezier(this,0,1),we=[];for(we=(we=(we=(we=we.concat(oe.findIntersections(pe,Le))).concat(oe.findIntersections(ve,Le))).concat(oe.findIntersections(xe,Le))).concat(oe.findIntersections(ge,Le)),L=[],X=0;X<we.length;X++){var Ce=(we[X][1].min+we[X][1].max)/2;L.push(Ce)}return L}}},{key:"countOfSegments",value:function(){return 1}},{key:"drawPrimitive",value:function(r,i){var a=this.cp0,s=this.cp1,c=this.cp2;r.createSVGElement("path",{d:"M"+o.measure.em2px(a.x)+","+o.measure.em2px(-a.y)+" Q"+o.measure.em2px(s.x)+","+o.measure.em2px(-s.y)+" "+o.measure.em2px(c.x)+","+o.measure.em2px(-c.y),"stroke-dasharray":i})}},{key:"toString",value:function(){return"QuadBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")"}}]),n})(K),K.CubicBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s){var c;Pe(this,n),(c=t.call(this)).cp0=r,c.cp1=i,c.cp2=a,c.cp3=s;var l=r.x,h=3*(i.x-r.x),m=3*(a.x-2*i.x+r.x),p=s.x-3*a.x+3*i.x-r.x;c.px=function(b){return l+b*h+b*b*m+b*b*b*p},c.dpx=function(b){return h+2*b*m+3*b*b*p};var f=r.y,y=3*(i.y-r.y),x=3*(a.y-2*i.y+r.y),w=s.y-3*a.y+3*i.y-r.y;return c.py=function(b){return f+b*y+b*b*x+b*b*b*w},c.dpy=function(b){return y+2*b*x+3*b*b*w},c}return Ae(n,[{key:"startPosition",value:function(){return this.cp0}},{key:"endPosition",value:function(){return this.cp3}},{key:"position",value:function(r){return new O.Point(this.px(r),this.py(r))}},{key:"derivative",value:function(r){return new O.Point(this.dpx(r),this.dpy(r))}},{key:"angle",value:function(r){return Math.atan2(this.dpy(r),this.dpx(r))}},{key:"boundingBox",value:function(r){var i=this.maxMin(this.cp0.x,this.cp1.x,this.cp2.x,this.cp3.x,r),a=this.maxMin(this.cp0.y,this.cp1.y,this.cp2.y,this.cp3.y,r);if(r===0)return new O.Rect(this.cp0.x,this.cp0.y,{l:this.cp0.x-i.min,r:i.max-this.cp0.x,u:a.max-this.cp0.y,d:this.cp0.y-a.min});var s=Math.PI/2,c=this.cp0.x,l=this.cp0.y,h=this.cp3.x,m=this.cp3.y,p=this.angle(0)+s,f=this.angle(1)+s,y=r*Math.cos(p),x=r*Math.sin(p),w=r*Math.cos(f),b=r*Math.sin(f),P=Math.min(i.min,c+y,c-y,h+w,h-w),M=Math.max(i.max,c+y,c-y,h+w,h-w),B=Math.min(a.min,l+x,l-x,m+b,m-b),A=Math.max(a.max,l+x,l-x,m+b,m-b);return new O.Rect(c,l,{l:c-P,r:M-c,u:A-l,d:l-B})}},{key:"maxMin",value:function(r,i,a,s,c){var l,h;r>s?(l=r,h=s):(l=s,h=r);var m,p=xt,f=p(r),y=p(i-r),x=p(a-2*i+r),w=p(s-3*a+3*i-r),b=function(M){M>0&&M<1&&(m=(function(B){return f+3*B*y+3*B*B*x+B*B*B*w})(M),l=Math.max(l,m+c,m-c),h=Math.min(h,m+c,m-c))};if(w==0)x!=0&&b(-y/x/2);else{var P=x*x-y*w;P>0?(b((-x+Math.sqrt(P))/w),b((-x-Math.sqrt(P))/w)):P==0&&b(-x/w)}return{min:h,max:l}}},{key:"divide",value:function(r){if(r<0||r>1)throw ye("ExecutionError","illegal cubic Bezier parameter t:"+r);var i=this.cp0.x,a=this.cp1.x,s=this.cp2.x,c=this.cp3.x,l=this.cp0.y,h=this.cp1.y,m=this.cp2.y,p=this.cp3.y,f=this.px(r),y=this.py(r),x=this.cp0,w=new O.Point(i+r*(a-i),l+r*(h-l)),b=new O.Point(i+2*r*(a-i)+r*r*(s-2*a+i),l+2*r*(h-l)+r*r*(m-2*h+l)),P=new O.Point(f,y),M=P,B=new O.Point(a+2*r*(s-a)+r*r*(c-2*s+a),h+2*r*(m-h)+r*r*(p-2*m+h)),A=new O.Point(s+r*(c-s),m+r*(p-m)),R=this.cp3;return[new K.CubicBezier(x,w,b,P),new K.CubicBezier(M,B,A,R)]}},{key:"slice",value:function(r,i){if(!(r>=i)){if(r<0&&(r=0),i>1&&(i=1),r===0&&i===1)return this;this.cp0.x;var a=this.cp1.x,s=this.cp2.x,c=this.cp3.x,l=(this.cp0.y,this.cp1.y),h=this.cp2.y,m=this.cp3.y,p=this.px(r),f=this.py(r),y=a+2*r*(s-a)+r*r*(c-2*s+a),x=l+2*r*(h-l)+r*r*(m-2*h+l),w=s+r*(c-s),b=h+r*(m-h),P=new O.Point(p,f),M=new O.Point(p+i*(y-p),f+i*(x-f)),B=new O.Point(p+2*i*(y-p)+i*i*(w-2*y+p),f+2*i*(x-f)+i*i*(b-2*x+f)),A=new O.Point(this.px(i),this.py(i));return new K.CubicBezier(P,M,B,A)}}},{key:"tOfIntersections",value:function(r){if(r.isPoint())return[];if(r.isRect()){var i,a=r.x+r.r,s=r.x-r.l,c=r.y+r.u,l=r.y-r.d,h=xt,m=this.cp0.x,p=this.cp1.x,f=this.cp2.x,y=this.cp3.x,x=this.cp0.y,w=this.cp1.y,b=this.cp2.y,P=this.cp3.y,M=h(m),B=h(3*(p-m)),A=h(3*(f-2*p+m)),R=h(y-3*f+3*p-m),U=function(je){return M+je*B+je*je*A+je*je*je*R},T=h(x),L=h(3*(w-x)),X=h(3*(b-2*w+x)),q=h(P-3*b+3*w-x),J=function(je){return T+je*L+je*je*X+je*je*je*q},Y=[];i=(i=K.solutionsOfCubicEq(R,A,B,M-a)).concat(K.solutionsOfCubicEq(R,A,B,M-s));for(var ee=0;ee<i.length;ee++)(ue=J(Je=i[ee]))>=l&&ue<=c&&Y.push(Je);for(i=(i=K.solutionsOfCubicEq(q,X,L,T-c)).concat(K.solutionsOfCubicEq(q,X,L,T-l)),ee=0;ee<i.length;ee++)($=U(Je=i[ee]))>=s&&$<=a&&Y.push(Je);return Y}if(r.isCircle()){var re=Math.PI,$=r.x,ue=r.y,me=r.l,ie=r.r,he=r.u,ae=r.d,pe=$+(ie-me)/2,ve=ue+(he-ae)/2,xe=(a=(me+ie)/2,(he+ae)/2),ge=re/180,Le=new oe.Arc(pe,ve,a,xe,-re-ge,-re/2+ge),we=new oe.Arc(pe,ve,a,xe,-re/2-ge,0+ge),Ce=new oe.Arc(pe,ve,a,xe,0-ge,re/2+ge),Re=new oe.Arc(pe,ve,a,xe,re/2-ge,re+ge),$e=new oe.CubicBezier(this,0,1),ze=[];for(ze=(ze=(ze=(ze=ze.concat(oe.findIntersections(Le,$e))).concat(oe.findIntersections(we,$e))).concat(oe.findIntersections(Ce,$e))).concat(oe.findIntersections(Re,$e)),Y=[],ee=0;ee<ze.length;ee++){var Je=(ze[ee][1].min+ze[ee][1].max)/2;Y.push(Je)}return Y}}},{key:"countOfSegments",value:function(){return 1}},{key:"drawPrimitive",value:function(r,i){var a=this.cp0,s=this.cp1,c=this.cp2,l=this.cp3;r.createSVGElement("path",{d:"M"+o.measure.em2px(a.x)+","+o.measure.em2px(-a.y)+" C"+o.measure.em2px(s.x)+","+o.measure.em2px(-s.y)+" "+o.measure.em2px(c.x)+","+o.measure.em2px(-c.y)+" "+o.measure.em2px(l.x)+","+o.measure.em2px(-l.y),"stroke-dasharray":i})}},{key:"toString",value:function(){return"CubicBezier("+this.cp0.x+", "+this.cp0.y+")-("+this.cp1.x+", "+this.cp1.y+")-("+this.cp2.x+", "+this.cp2.y+")-("+this.cp3.x+", "+this.cp3.y+")"}}]),n})(K),K.CubicBeziers=(function(e){Ve(n,e);var t=Ie(n);function n(r){var i;Pe(this,n),(i=t.call(this)).cbs=r;var a=i.cbs.length;return i.delegate=a==0?function(s,c,l){return l}:function(s,c,l){var h=s*a,m=Math.floor(h);m<0&&(m=0),m>=a&&(m=a-1);var p=h-m;return c(r[m],p)},i}return Ae(n,[{key:"startPosition",value:function(){return this.cbs[0].cp0}},{key:"endPosition",value:function(){return this.cbs[this.cbs.length-1].cp3}},{key:"position",value:function(r){return this.delegate(r,(function(i,a){return i.position(a)}),void 0)}},{key:"derivative",value:function(r){return this.delegate(r,(function(i,a){return i.derivative(a)}),void 0)}},{key:"angle",value:function(r){return this.delegate(r,(function(i,a){return i.angle(a)}),0)}},{key:"velocity",value:function(r){var i=this.cbs.length;return this.delegate(r,(function(a,s){return i*a.velocity(s)}),0)}},{key:"boundingBox",value:function(r){if(this.cbs.length!=0){var i,a=this.cbs[0].boundingBox(r),s=this.cbs.length;for(i=1;i<s;i++)a=a.combineRect(this.cbs[i].boundingBox(r));return a}}},{key:"tOfIntersections",value:function(r){var i=[],a=0,s=this.cbs.length;for(a=0;a<s;a++)for(var c=this.cbs[a].tOfIntersections(r),l=0;l<c.length;l++)i.push((c[l]+a)/s);return i}},{key:"divide",value:function(r){if(r<0||r>1)throw ye("ExecutionError","illegal cubic Bezier parameter t:"+r);if(r===0)return[new K.CubicBeziers([]),this];if(r===1)return[this,new K.CubicBeziers([])];var i=this.cbs.length,a=r*i,s=Math.floor(a);s===i&&(s=i-1);var c=a-s,l=this.cbs.slice(0,s),h=this.cbs.slice(s+1),m=this.cbs[s].divide(c);return l.push(m[0]),h.unshift(m[1]),[new K.CubicBeziers(l),new K.CubicBeziers(h)]}},{key:"slice",value:function(r,i){if(!(r>=i)){if(r<0&&(r=0),i>1&&(i=1),r===0&&i===1)return this;var a=this.cbs.length,s=r*a,c=i*a,l=Math.floor(s),h=Math.floor(c);l===a&&(l=a-1),h===a&&(h=a-1);var m,p=s-l,f=c-h;return l===h?m=[this.cbs[l].slice(p,f)]:((m=this.cbs.slice(l+1,h)).push(this.cbs[h].slice(0,f)),m.unshift(this.cbs[l].slice(p,1))),new K.CubicBeziers(m)}}},{key:"countOfSegments",value:function(){return this.cbs.length}},{key:"drawPrimitive",value:function(r,i){for(var a=this.cbs.length,s=this.cbs,c=s[0],l=c.cp0,h=c.cp1,m=c.cp2,p=c.cp3,f="M"+o.measure.em2px(l.x)+","+o.measure.em2px(-l.y)+" C"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y)+" "+o.measure.em2px(m.x)+","+o.measure.em2px(-m.y)+" "+o.measure.em2px(p.x)+","+o.measure.em2px(-p.y),y=1;y<a;y++)m=(c=s[y]).cp2,p=c.cp3,f+=" S"+o.measure.em2px(m.x)+","+o.measure.em2px(-m.y)+" "+o.measure.em2px(p.x)+","+o.measure.em2px(-p.y);r.createSVGElement("path",{d:f,"stroke-dasharray":i})}},{key:"drawSkipped",value:function(r){for(var i=this.cbs.length,a=this.cbs,s="",c=0;c<i;c+=2){var l=a[c],h=l.cp0,m=l.cp1,p=l.cp2,f=l.cp3;s+="M"+o.measure.em2px(h.x)+","+o.measure.em2px(-h.y)+" C"+o.measure.em2px(m.x)+","+o.measure.em2px(-m.y)+" "+o.measure.em2px(p.x)+","+o.measure.em2px(-p.y)+" "+o.measure.em2px(f.x)+","+o.measure.em2px(-f.y)}r.createSVGElement("path",{d:s})}}],[{key:"interpolation",value:function(r,i,a){var s,c=K.CubicBeziers.cubicSplineInterpolation(r,i),l=c[0],h=c[1],m=K.CubicBeziers.cubicSplineInterpolation(r,a),p=m[0],f=m[1],y=r.length,x=Array(y-1);for(s=0;s<y-1;s++)x[s]=new K.CubicBezier(new O.Point(i[s],a[s]),new O.Point(l[s],p[s]),new O.Point(h[s],f[s]),new O.Point(i[s+1],a[s+1]));return new K.CubicBeziers(x)}},{key:"cubicSplineInterpolation",value:function(r,i){var a,s=r.length-1,c=Array(s);for(a=0;a<s;a++)c[a]=r[a+1]-r[a];var l=Array(s);for(a=1;a<s;a++)l[a]=3*(i[a+1]-i[a])/c[a]-3*(i[a]-i[a-1])/c[a-1];var h=Array(s+1),m=Array(s+1),p=Array(s+1);for(h[0]=1,m[0]=0,p[0]=0,a=1;a<s;a++)h[a]=2*(r[a+1]-r[a-1])-c[a-1]*m[a-1],m[a]=c[a]/h[a],p[a]=(l[a]-c[a-1]*p[a-1])/h[a];h[s]=1,p[s]=0;var f=Array(s),y=Array(s+1);for(y[s]=0,a=s-1;a>=0;a--){var x=c[a],w=y[a+1],b=x*x*p[a]-m[a]*w;y[a]=b,f[a]=i[a+1]-i[a]-(w+2*b)/3}var P=Array(s),M=Array(s);for(a=0;a<s;a++){var B=i[a],A=f[a],R=y[a];P[a]=B+A/3,M[a]=B+(2*A+R)/3}return[P,M]}}]),n})(K),K.CubicBSpline=(function(){function e(t,n,r){if(Pe(this,e),n.length<1)throw ye("ExecutionError","the number of internal control points of cubic B-spline must be greater than or equal to 1");var i=[];i.push(t);for(var a=0,s=n.length;a<s;a++)i.push(n[a]);i.push(r),this.cps=i;var c=this.cps.length-1,l=function(p){return p<0?i[0]:p>c?i[c]:i[p]},h=function(p){var f=Math.abs(p);return f<=1?(3*f*f*f-6*f*f+4)/6:f<=2?-(f-2)*(f-2)*(f-2)/6:0};this.px=function(p){for(var f=(c+2)*p-1,y=Math.ceil(f-2),x=Math.floor(f+2),w=0,b=y;b<=x;b++)w+=h(f-b)*l(b).x;return w},this.py=function(p){for(var f=(c+2)*p-1,y=Math.ceil(f-2),x=Math.floor(f+2),w=0,b=y;b<=x;b++)w+=h(f-b)*l(b).y;return w};var m=function(p){var f=p>0?1:p<0?-1:0,y=Math.abs(p);return y<=1?f*(3*y*y-4*y)/2:y<=2?-f*(y-2)*(y-2)/2:0};this.dpx=function(p){for(var f=(c+2)*p-1,y=Math.ceil(f-2),x=Math.floor(f+2),w=0,b=y;b<=x;b++)w+=m(f-b)*l(b).x;return w},this.dpy=function(p){for(var f=(c+2)*p-1,y=Math.ceil(f-2),x=Math.floor(f+2),w=0,b=y;b<=x;b++)w+=m(f-b)*l(b).y;return w}}return Ae(e,[{key:"position",value:function(t){return new O.Point(this.px(t),this.py(t))}},{key:"angle",value:function(t){return Math.atan2(this.dpy(t),this.dpx(t))}},{key:"toCubicBeziers",value:function(){var t=[],n=this.cps,r=n[0],i=n[1],a=n[2],s=r.x,c=r.y,l=s+(i.x-s)/3,h=c+(i.y-c)/3,m=s+2*(i.x-s)/3,p=c+2*(i.y-c)/3,f=i.x+(a.x-i.x)/3,y=i.y+(a.y-i.y)/3,x=(m+f)/2,w=(p+y)/2,b=r,P=new O.Point(l,h),M=new O.Point(m,p),B=new O.Point(x,w),A=new K.CubicBezier(b,P,M,B);t.push(A);for(var R=this.cps.length-1,U=2;U<R;U++)r=i,i=a,a=n[U+1],s=x,c=w,l=2*x-m,h=2*w-p,m=r.x+2*(i.x-r.x)/3,p=r.y+2*(i.y-r.y)/3,x=(m+(f=i.x+(a.x-i.x)/3))/2,w=(p+(y=i.y+(a.y-i.y)/3))/2,b=B,P=new O.Point(l,h),M=new O.Point(m,p),B=new O.Point(x,w),A=new K.CubicBezier(b,P,M,B),t.push(A);return r=i,i=a,s=x,c=w,l=2*x-m,h=2*w-p,m=r.x+2*(i.x-r.x)/3,p=r.y+2*(i.y-r.y)/3,x=i.x,w=i.y,b=B,P=new O.Point(l,h),M=new O.Point(m,p),B=new O.Point(x,w),A=new K.CubicBezier(b,P,M,B),t.push(A),t}},{key:"countOfSegments",value:function(){return this.cps.length-1}}]),e})(),K.Line=(function(){function e(t,n){Pe(this,e),this.s=t,this.e=n}return Ae(e,[{key:"position",value:function(t){return new O.Point(this.s.x+t*(this.e.x-this.s.x),this.s.y+t*(this.e.y-this.s.y))}},{key:"slice",value:function(t,n){if(!(t>=n)){if(t<0&&(t=0),n>1&&(n=1),t===0&&n===1)return this;var r=this.s,i=this.e,a=i.x-r.x,s=i.y-r.y,c=new O.Point(r.x+t*a,r.y+t*s),l=new O.Point(r.x+n*a,r.y+n*s);return new K.Line(c,l)}}},{key:"tOfIntersections",value:function(t){if(t.isPoint())return[];var n=this.s,r=this.e;if(t.isRect()){var i,a=t.x+t.r,s=t.x-t.l,c=t.y+t.u,l=t.y-t.d,h=n.x,m=n.y,p=r.x-h,f=r.y-m,y=function(Ce){return h+Ce*p},x=function(Ce){return m+Ce*f},w=[];i=(i=K.solutionsOfLinearEq(p,h-a)).concat(K.solutionsOfLinearEq(p,h-s));for(var b=0;b<i.length;b++){var P=x(M=i[b]);P>=l&&P<=c&&w.push(M)}for(i=(i=K.solutionsOfLinearEq(f,m-c)).concat(K.solutionsOfLinearEq(f,m-l)),b=0;b<i.length;b++){var M,B=y(M=i[b]);B>=s&&B<=a&&w.push(M)}return w}if(t.isCircle()){var A=t.l,R=t.r,U=t.u,T=t.d,L=t.x+(R-A)/2,X=t.y+(U-T)/2,q=(a=(A+R)/2,(U+T)/2),J=n.x,Y=n.y,ee=r.x-J,re=-ee,$=(l=r.y-Y)*a,ue=re*q,me=$*$+ue*ue,ie=(r=-(T=$*L+ue*X+((ee*Y-l*J)*a+(a-q)*re*X))/me,me*a*a-T*T);if(ie<0)return[];var he,ae,pe=Math.sqrt(ie)/me,ve=q/a,xe=$*r+ue*pe+L,ge=ve*(ue*r-$*pe+X-X)+X,Le=$*r-ue*pe+L,we=ve*(ue*r+$*pe+X-X)+X;return Math.abs(ee)>Math.abs(l)?(he=(xe-J)/ee,ae=(Le-J)/ee):(he=(ge-Y)/l,ae=(we-Y)/l),w=[],he>=0&&he<=1&&w.push(he),ae>=0&&ae<=1&&w.push(ae),w}}},{key:"toShape",value:function(t,n,r,i){var a=t.env,s=o.measure.thickness,c=this.s,l=this.e;if(c.x!==l.x||c.y!==l.y){var h,m=l.x-c.x,p=l.y-c.y,f=Math.atan2(p,m),y=d.none;switch(r){case"=":r="-",i="2";break;case"==":r="--",i="2";break;case":":case"::":r=".",i="2"}switch(r){case"":return a.angle=f,a.lastCurve=new ne.Line(c,l,a.p,a.c,void 0),y;case"-":case".":case"..":switch(i){case"2":h=s/2;break;case"3":h=s;break;default:h=0}break;case"--":var x=3*s;if((P=Math.sqrt(m*m+p*p))>=x)switch(i){case"2":h=s/2;break;case"3":h=s;break;default:h=0}break;case"~":case"~~":switch(i){case"2":h=1.5*s;break;case"3":h=2*s;break;default:h=0}break;default:var w=n.boundingBox(t);if(w==null)return a.angle=0,a.lastCurve=ne.none,d.none;var b=w.l+w.r;b==0&&(b=o.measure.strokeWidth);var P=Math.sqrt(m*m+p*p);if(Math.floor(P/b)==0)return a.angle=0,a.lastCurve=ne.none,d.none;h=Math.max(w.u,w.d)}if(h!==void 0){var M=this.boundingBox(h);return y=new d.LineShape(this,n,r,i,M),t.appendShapeToFront(y),a.angle=f,a.lastCurve=new ne.Line(c,l,a.p,a.c,y),y}}return a.angle=0,a.lastCurve=ne.none,d.none}},{key:"boundingBox",value:function(t){var n=this.s,r=this.e,i=r.x-n.x,a=r.y-n.y,s=Math.atan2(a,i),c=t*Math.cos(s+Math.PI/2),l=t*Math.sin(s+Math.PI/2);return new O.Rect(n.x,n.y,{l:n.x-Math.min(n.x+c,n.x-c,r.x+c,r.x-c),r:Math.max(n.x+c,n.x-c,r.x+c,r.x-c)-n.x,u:Math.max(n.y+l,n.y-l,r.y+l,r.y-l)-n.y,d:n.y-Math.min(n.y+l,n.y-l,r.y+l,r.y-l)})}},{key:"drawLine",value:function(t,n,r,i,a){if(a.isEmpty)this._drawLine(t,n,r,i);else{var s=new Ge(0,1).differenceRanges(a),c=this;s.foreach((function(l){c.slice(l.start,l.end)._drawLine(t,n,r,i)}))}}},{key:"_drawLine",value:function(t,n,r,i){var a=o.measure.thickness,s=this.s,c=this.e;if(s.x!==c.x||s.y!==c.y){var l=c.x-s.x,h=c.y-s.y,m=Math.atan2(h,l),p={x:0,y:0};switch(r){case"":break;case"-":this.drawStraightLine(t,s,c,p,m,a,i,"");break;case"=":this.drawStraightLine(t,s,c,p,m,a,"2","");break;case".":case"..":this.drawStraightLine(t,s,c,p,m,a,i,o.measure.dottedDasharray);break;case":":case"::":this.drawStraightLine(t,s,c,p,m,a,"2",o.measure.dottedDasharray);break;case"--":case"==":var f=3*a;(J=Math.sqrt(l*l+h*h))>=f&&(p={x:(Y=(J-f)/2-Math.floor((J-f)/2/f)*f)*Math.cos(m),y:Y*Math.sin(m)},this.drawStraightLine(t,s,c,p,m,a,r==="=="?"2":i,o.measure.em2px(f)+" "+o.measure.em2px(f)));break;case"~":if((J=Math.sqrt(l*l+h*h))>=(R=4*a)){p={x:(Y=(J-(q=Math.floor(J/R))*R)/2)*Math.cos(m),y:Y*Math.sin(m)};for(var y=a*Math.cos(m+Math.PI/2),x=a*Math.sin(m+Math.PI/2),w=a*Math.cos(m),b=a*Math.sin(m),P=s.x+p.x,M=-s.y-p.y,B="M"+o.measure.em2px(P)+","+o.measure.em2px(M)+" Q"+o.measure.em2px(P+w+y)+","+o.measure.em2px(M-b-x)+" "+o.measure.em2px(P+2*w)+","+o.measure.em2px(M-2*b)+" T"+o.measure.em2px(P+4*w)+","+o.measure.em2px(M-4*b),A=1;A<q;A++)B+=" T"+o.measure.em2px(P+(4*A+2)*w)+","+o.measure.em2px(M-(4*A+2)*b)+" T"+o.measure.em2px(P+(4*A+4)*w)+","+o.measure.em2px(M-(4*A+4)*b);this.drawSquigglyLineShape(t,B,s,c,y,x,i)}break;case"~~":var R;if((J=Math.sqrt(l*l+h*h))>=(R=4*a)){for(p={x:(Y=(J-R)/2-(q=Math.floor((J-R)/2/R))*R)*Math.cos(m),y:Y*Math.sin(m)},y=a*Math.cos(m+Math.PI/2),x=a*Math.sin(m+Math.PI/2),w=a*Math.cos(m),b=a*Math.sin(m),P=s.x+p.x,M=-s.y-p.y,B="",A=0;A<=q;A++)B+=" M"+o.measure.em2px(P+8*A*w)+","+o.measure.em2px(M-8*A*b)+" Q"+o.measure.em2px(P+(8*A+1)*w+y)+","+o.measure.em2px(M-(8*A+1)*b-x)+" "+o.measure.em2px(P+(8*A+2)*w)+","+o.measure.em2px(M-(8*A+2)*b)+" T"+o.measure.em2px(P+(8*A+4)*w)+","+o.measure.em2px(M-(8*A+4)*b);this.drawSquigglyLineShape(t,B,s,c,y,x,i)}break;default:var U=new be;U.c=be.originPosition;var T=new le(d.none,U),L=n.boundingBox(T);if(L==null)return;var X=L.l+L.r;X==0&&(X=o.measure.strokeWidth);var q,J=Math.sqrt(l*l+h*h);if((q=Math.floor(J/X))==0)return;var Y=(J-q*X)/2,ee=Math.cos(m),re=Math.sin(m),$=X*ee,ue=X*re,me=s.x+(Y+L.l)*ee,ie=s.y+(Y+L.l)*re;for(T=new le(d.none,U),A=0;A<q;A++)U.c=new O.Point(me+A*$,ie+A*ue),U.angle=m,n.toDropShape(T).draw(t)}}}},{key:"drawStraightLine",value:function(t,n,r,i,a,s,c,l){if(c==="3"){var h=s*Math.cos(a+Math.PI/2),m=s*Math.sin(a+Math.PI/2);t.createSVGElement("line",{x1:o.measure.em2px(n.x+i.x),y1:-o.measure.em2px(n.y+i.y),x2:o.measure.em2px(r.x),y2:-o.measure.em2px(r.y),"stroke-dasharray":l}),t.createSVGElement("line",{x1:o.measure.em2px(n.x+h+i.x),y1:-o.measure.em2px(n.y+m+i.y),x2:o.measure.em2px(r.x+h),y2:-o.measure.em2px(r.y+m),"stroke-dasharray":l}),t.createSVGElement("line",{x1:o.measure.em2px(n.x-h+i.x),y1:-o.measure.em2px(n.y-m+i.y),x2:o.measure.em2px(r.x-h),y2:-o.measure.em2px(r.y-m),"stroke-dasharray":l})}else c==="2"?(h=s*Math.cos(a+Math.PI/2)/2,m=s*Math.sin(a+Math.PI/2)/2,t.createSVGElement("line",{x1:o.measure.em2px(n.x+h+i.x),y1:-o.measure.em2px(n.y+m+i.y),x2:o.measure.em2px(r.x+h),y2:-o.measure.em2px(r.y+m),"stroke-dasharray":l}),t.createSVGElement("line",{x1:o.measure.em2px(n.x-h+i.x),y1:-o.measure.em2px(n.y-m+i.y),x2:o.measure.em2px(r.x-h),y2:-o.measure.em2px(r.y-m),"stroke-dasharray":l})):t.createSVGElement("line",{x1:o.measure.em2px(n.x+i.x),y1:-o.measure.em2px(n.y+i.y),x2:o.measure.em2px(r.x),y2:-o.measure.em2px(r.y),"stroke-dasharray":l})}},{key:"drawSquigglyLineShape",value:function(t,n,r,i,a,s,c){c==="3"?(t.createSVGElement("path",{d:n}),t.createGroup(t.transformBuilder().translate(a,s)).createSVGElement("path",{d:n}),t.createGroup(t.transformBuilder().translate(-a,-s)).createSVGElement("path",{d:n})):c==="2"?(t.createGroup(t.transformBuilder().translate(a/2,s/2)).createSVGElement("path",{d:n}),t.createGroup(t.transformBuilder().translate(-a/2,-s/2)).createSVGElement("path",{d:n})):t.createSVGElement("path",{d:n})}}]),e})();var oe=(function(){function e(){Pe(this,e)}return Ae(e,[{key:"bezierFatLine",value:function(t){var n,r,i,a,s=this.cps[0],c=this.cps[t];if(s.x!==c.x||s.y!==c.y)n=s.y-c.y,r=c.x-s.x,n/=a=Math.sqrt(n*n+r*r),r/=a,i=(s.x*c.y-s.y*c.x)/a;else{var l=this.bezier.angle(this.tmin);n=-Math.sin(l),r=Math.cos(l),i=-n*this.cp0.x-r*this.cp0.y}for(var h=i,m=i,p=1;p<t;p++){var f=-n*this.cps[p].x-r*this.cps[p].y;f>m?m=f:f<h&&(h=f)}return{min:[n,r,h],max:[n,r,m]}}},{key:"clippedLineRange",value:function(t,n,r){for(var i,a,s,c,l,h=t.length-1,m=Array(h+1),p=Br,f=0;f<=h;f++)m[f]=[f/h,-n[0]*t[f].x-n[1]*t[f].y-n[2],1];if(m[0][1]<0){var y=!0;for(f=1;f<=h;f++)(i=-(w=p(m[0],m[f]))[2]/w[0])>0&&i<1&&(a===void 0||i<a)&&(a=i),m[f][1]>=0&&(y=!1);if(y)return}else a=0;if(m[h][1]<0)for(f=0;f<h;f++)(i=-(b=p(m[h],m[f]))[2]/b[0])>0&&i<1&&(s===void 0||i>s)&&(s=i);else s=1;for(f=0;f<=h;f++)m[f]=[f/h,r[0]*t[f].x+r[1]*t[f].y+r[2],1];if(m[0][1]<0){var x=!0;for(f=1;f<=h;f++){var w;(i=-(w=p(m[0],m[f]))[2]/w[0])>0&&i<1&&(c===void 0||i<c)&&(c=i),m[f][1]>=0&&(x=!1)}if(x)return}else c=0;if(m[h][1]<0)for(f=0;f<h;f++){var b;(i=-(b=p(m[h],m[f]))[2]/b[0])>0&&i<1&&(l===void 0||i>l)&&(l=i)}else l=1;var P=Math.max(a,c),M=Math.min(s,l);return{min:this.tmin+P*(this.tmax-this.tmin),max:this.tmin+M*(this.tmax-this.tmin)}}}],[{key:"findIntersections",value:function(t,n){for(var r=e.maxIterations,i=e.goalAccuracy,a=[[t,n,!1]],s=0,c=[];s<r&&a.length>0;){s++;var l=a.shift(),h=(t=l[0],n=l[1],l[2]),m=t.fatLine(),p=n.clippedRange(m.min,m.max);if(p!=null){var f=p.min,y=p.max,x=y-f;if(x<i&&t.paramLength()<i)h?c.push([n.clip(f,y).paramRange(),t.paramRange()]):c.push([t.paramRange(),n.clip(f,y).paramRange()]);else if(x<=.8*n.paramLength())a.push([n.clip(f,y),t,!h]);else if(x>t.paramLength()){var w=(y+f)/2;a.push([n.clip(f,w),t,!h]),a.push([n.clip(w,y),t,!h])}else{var b=n.clip(f,y),P=t.paramRange(),M=(P.min+P.max)/2;a.push([b,t.clip(P.min,M),!h]),a.push([b,t.clip(M,P.max),!h])}}}return c}},{key:"maxIterations",get:function(){return 30}},{key:"goalAccuracy",get:function(){return 1e-4}}]),e})();oe.Line=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s){var c;return Pe(this,n),(c=t.call(this)).p0=r,c.p1=i,c.tmin=a,c.tmax=s,c}return Ae(n,[{key:"paramRange",value:function(){return{min:this.tmin,max:this.tmax}}},{key:"paramLength",value:function(){return this.tmax-this.tmin}},{key:"containsParam",value:function(r){return r>=this.tmin&&r<=this.tmax}},{key:"position",value:function(r){return{x:this.p0.x+r*(this.p1.x-this.p0.x),y:this.p0.y+r*(this.p1.y-this.p0.y)}}},{key:"fatLine",value:function(){var r=this.p1.y-this.p0.y,i=this.p0.x-this.p1.x,a=this.p1.x*this.p0.y-this.p0.x*this.p1.y,s=Math.sqrt(r*r+i*i);return s===0?(r=1,i=0):(r/=s,i/=s,a/=s),{min:[r,i,a],max:[r,i,a]}}},{key:"clip",value:function(r,i){return new oe.Line(this.p0,this.p1,r,i)}},{key:"clippedRange",value:function(r,i){var a=[,,];return a[0]=this.position(this.tmin),a[1]=this.position(this.tmax),this.clippedLineRange(a,r,i)}},{key:"drawFatLine",value:function(){this.fatLine().min;var r=function(s,c){return-(s*c[0]+c[2])/c[1]},i=this.p0.x,a=this.p1.x;o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(i),y1:-o.measure.em2px(r(i,lmax)),x2:o.measure.em2px(a),y2:-o.measure.em2px(r(a,lmax)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"red"})}}]),n})(oe),oe.QuadBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a){var s;return Pe(this,n),(s=t.call(this)).bezier=r,s.tmin=i,s.tmax=a,s.cp0=r.position(i),s.cp1=new O.Point((1-a)*(1-i)*r.cp0.x+(i+a-2*i*a)*r.cp1.x+i*a*r.cp2.x,(1-a)*(1-i)*r.cp0.y+(i+a-2*i*a)*r.cp1.y+i*a*r.cp2.y),s.cp2=r.position(a),s.cps=[s.cp0,s.cp1,s.cp2],s}return Ae(n,[{key:"paramRange",value:function(){return{min:this.tmin,max:this.tmax}}},{key:"paramLength",value:function(){return this.tmax-this.tmin}},{key:"fatLine",value:function(){return this.bezierFatLine(2)}},{key:"clip",value:function(r,i){return new oe.QuadBezier(this.bezier,r,i)}},{key:"clippedRange",value:function(r,i){return this.clippedLineRange(this.cps,r,i)}},{key:"drawFatLine",value:function(){var r=this.fatLine(),i=r.min,a=r.max,s=function(h,m){return-(h*m[0]+m[2])/m[1]},c=this.cp0.x,l=this.cp2.x;o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,i)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,i)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"blue"}),o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,a)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,a)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"red"})}}]),n})(oe),oe.CubicBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a){var s;return Pe(this,n),(s=t.call(this)).bezier=r,s.tmin=i,s.tmax=a,s.cp0=r.position(i),s.cp1=new O.Point((1-a)*(1-i)*(1-i)*r.cp0.x+(1-i)*(2*i+a-3*i*a)*r.cp1.x+i*(2*a+i-3*i*a)*r.cp2.x+i*i*a*r.cp3.x,(1-a)*(1-i)*(1-i)*r.cp0.y+(1-i)*(2*i+a-3*i*a)*r.cp1.y+i*(2*a+i-3*i*a)*r.cp2.y+i*i*a*r.cp3.y),s.cp2=new O.Point((1-i)*(1-a)*(1-a)*r.cp0.x+(1-a)*(2*a+i-3*i*a)*r.cp1.x+a*(2*i+a-3*i*a)*r.cp2.x+i*a*a*r.cp3.x,(1-i)*(1-a)*(1-a)*r.cp0.y+(1-a)*(2*a+i-3*i*a)*r.cp1.y+a*(2*i+a-3*i*a)*r.cp2.y+i*a*a*r.cp3.y),s.cp3=r.position(a),s.cps=[s.cp0,s.cp1,s.cp2,s.cp3],s}return Ae(n,[{key:"paramRange",value:function(){return{min:this.tmin,max:this.tmax}}},{key:"paramLength",value:function(){return this.tmax-this.tmin}},{key:"fatLine",value:function(){return this.bezierFatLine(3)}},{key:"clip",value:function(r,i){return new oe.CubicBezier(this.bezier,r,i)}},{key:"clippedRange",value:function(r,i){return this.clippedLineRange(this.cps,r,i)}},{key:"drawFatLine",value:function(){var r=this.fatLine(),i=r.min,a=r.max,s=function(h,m){return-(h*m[0]+m[2])/m[1]},c=this.cp0.x,l=this.cp3.x;o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,i)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,i)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"blue"}),o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,a)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,a)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"red"})}}]),n})(oe),oe.Arc=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s,c,l){var h;return Pe(this,n),(h=t.call(this)).x=r,h.y=i,h.rx=a,h.ry=s,h.angleMin=c,h.angleMax=l,h}return Ae(n,[{key:"paramRange",value:function(){return{min:this.angleMin,max:this.angleMax}}},{key:"paramLength",value:function(){return this.angleMax-this.angleMin}},{key:"normalizeAngle",value:function(r){return(r=r%2*Math.PI)>Math.PI?r-2*Math.PI:r<-Math.PI?r+2*Math.PI:r}},{key:"containsParam",value:function(r){return r>=this.angleMin&&r<=this.angleMax}},{key:"fatLine",value:function(){var r=this.rx,i=this.ry,a=(this.angleMax+this.angleMin)/2,s=(this.angleMax-this.angleMin)/2,c=Math.cos(a),l=Math.sin(a),h=Math.sqrt(r*r*l*l+i*i*c*c);if(h<Be.machinePrecision)var m=[1,0,this.x*i*c+this.y*r*l+r*i*Math.cos(s)],p=[1,0,this.x*i*c+this.y*r*l+r*i];else{var f=r/h,y=i/h;m=[-y*c,-f*l,this.x*y*c+this.y*f*l+r*i/h*Math.cos(s)],p=[-y*c,-f*l,this.x*y*c+this.y*f*l+r*i/h]}return{min:m,max:p}}},{key:"clip",value:function(r,i){return new oe.Arc(this.x,this.y,this.rx,this.ry,r,i)}},{key:"toCircleLine",value:function(r,i,a,s,c){var l=r[0],h=r[1],m=l*s,p=h*c,f=r[2]*s+(s-c)*h*a,y=Math.sqrt(m*m+p*p);return y<Be.machinePrecision?(m=1,p=0):(m/=y,p/=y,f/=y),[m,p,f]}},{key:"clippedRange",value:function(r,i){var a=this.x,s=this.y,c=this.rx,l=this.ry,h=this.toCircleLine(r,a,s,c,l),m=this.toCircleLine(i,a,s,c,l),p=c,f=this.angleMin,y=this.angleMax,x=-(h[0]*a+h[1]*s+h[2]),w=[];if(p*p-x*x>=0){var b=h[0]*x-h[1]*Math.sqrt(p*p-x*x),P=h[1]*x+h[0]*Math.sqrt(p*p-x*x),M=h[0]*x+h[1]*Math.sqrt(p*p-x*x),B=h[1]*x-h[0]*Math.sqrt(p*p-x*x),A=Math.atan2(P,b),R=Math.atan2(B,M);this.containsParam(A)&&w.push(A),this.containsParam(R)&&w.push(R)}var U,T,L=-(h[0]*(a+p*Math.cos(f))+h[1]*(s+p*Math.sin(f))+h[2]),X=-(h[0]*(a+p*Math.cos(y))+h[1]*(s+p*Math.sin(y))+h[2]);if(L<0){if(w.length==0)return;U=Math.min.apply(Math,w)}else U=this.angleMin;if(X<0){if(w.length==0)return;T=Math.max.apply(Math,w)}else T=this.angleMax;w=[],p*p-(x=m[0]*a+m[1]*s+m[2])*x>=0&&(b=-h[0]*x+h[1]*Math.sqrt(p*p-x*x),P=-h[1]*x-h[0]*Math.sqrt(p*p-x*x),M=-h[0]*x-h[1]*Math.sqrt(p*p-x*x),B=-h[1]*x+h[0]*Math.sqrt(p*p-x*x),A=Math.atan2(P,b),R=Math.atan2(B,M),this.containsParam(A)&&w.push(A),this.containsParam(R)&&w.push(R));var q,J;if(L=m[0]*(a+p*Math.cos(f))+m[1]*(s+p*Math.sin(f))+m[2],X=m[0]*(a+p*Math.cos(y))+m[1]*(s+p*Math.sin(y))+m[2],L<0){if(w.length==0)return;q=Math.min.apply(Math,w)}else q=this.angleMin;if(X<0){if(w.length==0)return;J=Math.max.apply(Math,w)}else J=this.angleMax;return{min:Math.max(U,q),max:Math.min(T,J)}}},{key:"drawFatLine",value:function(){var r=this.fatLine(),i=r.min,a=r.max,s=function(h,m){return-(h*m[0]+m[2])/m[1]},c=this.x+this.r*Math.cos(this.angleMin),l=this.x+this.r*Math.cos(this.angleMax);o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,i)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,i)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"blue"}),o.svgForDebug.createSVGElement("line",{x1:o.measure.em2px(c),y1:-o.measure.em2px(s(c,a)),x2:o.measure.em2px(l),y2:-o.measure.em2px(s(l,a)),"stroke-width":o.measure.em2px(.02*o.measure.oneem),stroke:"red"})}}]),n})(oe);var ne=function e(){Pe(this,e)};function Rr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kt(e,t,n){return t&&Rr(e.prototype,t),e}function ut(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}ne.None=(function(e){Ve(n,e);var t=Ie(n);function n(){return Pe(this,n),t.call(this)}return Ae(n,[{key:"isDefined",get:function(){return!1}},{key:"segments",value:function(){return[]}},{key:"angle",value:function(){return 0}}]),n})(ne),ne.none=new ne.None,ne.Line=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s,c){var l;return Pe(this,n),(l=t.call(this)).start=r,l.end=i,l.p=a,l.c=s,l.lineShape=c,l}return Ae(n,[{key:"isDefined",get:function(){return!0}},{key:"position",value:function(r){return new O.Point(this.p.x+r*(this.c.x-this.p.x),this.p.y+r*(this.c.y-this.p.y))}},{key:"derivative",value:function(r){return new O.Point(this.c.x-this.p.x,this.c.y-this.p.y)}},{key:"angle",value:function(r){var i=this.c.x-this.p.x,a=this.c.y-this.p.y;return i===0&&a===0?0:Math.atan2(a,i)}},{key:"tOfPlace",value:function(r,i,a,s){var c=r?this.start:this.p,l=i?this.end:this.c;if(c.x===l.x&&c.y===l.y)return 0;var h,m,p=l.x-c.x,f=l.y-c.y,y=Math.sqrt(p*p+f*f);a>.5?(h=l.x-(1-a)*p+s*p/y,m=l.y-(1-a)*f+s*f/y):(h=c.x+a*p+s*p/y,m=c.y+a*f+s*f/y);var x=this.c.x-this.p.x,w=this.c.y-this.p.y;return x===0&&w===0?0:Math.abs(x)>Math.abs(w)?(h-this.p.x)/x:(m-this.p.y)/w}},{key:"sliceHole",value:function(r,i){if(this.lineShape!==void 0&&!r.isPoint()){var a=this.lineShape,s=a.line,c=s.tOfIntersections(r);c.push(0),c.push(1),c.sort();for(var l=c[0],h=1;h<c.length;h++){var m=c[h],p=s.position((m+l)/2);if(r.contains(p)){var f=new Ge(l,m);a.sliceHole(f)}l=m}}}},{key:"segments",value:function(){return[new oe.Line(this.p,this.c,0,1)]}}]),n})(ne),ne.QuadBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s){var c;return Pe(this,n),(c=t.call(this)).origBezier=r,c.tOfShavedStart=i,c.tOfShavedEnd=a,s.isNone||(c.curveShape=s,i>0&&s.sliceHole(new Ge(0,i)),a<1&&s.sliceHole(new Ge(a,1))),c}return Ae(n,[{key:"isDefined",get:function(){return!0}},{key:"position",value:function(r){return this.origBezier.position(r)}},{key:"derivative",value:function(r){return this.origBezier.derivative(r)}},{key:"angle",value:function(r){return this.origBezier.angle(r)}},{key:"tOfPlace",value:function(r,i,a,s){var c,l;r?(c=this.tOfShavedStart,l=i?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(c=0,l=i?this.tOfShavedEnd:1);var h=this.origBezier,m=c+l*a;if(s!==0){var p=h.length(m);m=h.tOfLength(p+s)}return m}},{key:"sliceHole",value:function(r,i){var a=this.curveShape;if(a!==void 0&&!r.isPoint()){var s=a.curve,c=s.tOfIntersections(r);c.push(0),c.push(1),c.sort();for(var l=c[0],h=1;h<c.length;h++){var m=c[h];if(l<=i&&i<=m){var p=s.position((m+l)/2);if(r.contains(p)){var f=new Ge(l,m);a.sliceHole(f)}}l=m}}}},{key:"segments",value:function(){return[new oe.QuadBezier(this.origBezier,0,1)]}}]),n})(ne),ne.CubicBezier=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s){var c;return Pe(this,n),(c=t.call(this)).origBezier=r,c.tOfShavedStart=i,c.tOfShavedEnd=a,s.isNone||(c.curveShape=s,i>0&&s.sliceHole(new Ge(0,i)),a<1&&s.sliceHole(new Ge(a,1))),c}return Ae(n,[{key:"originalLine",value:function(){return this.originalLine}},{key:"isDefined",get:function(){return!0}},{key:"position",value:function(r){return this.origBezier.position(r)}},{key:"derivative",value:function(r){return this.origBezier.derivative(r)}},{key:"angle",value:function(r){return this.origBezier.angle(r)}},{key:"tOfPlace",value:function(r,i,a,s){var c,l;r?(c=this.tOfShavedStart,l=i?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(c=0,l=i?this.tOfShavedEnd:1);var h=this.origBezier,m=c+l*a;if(s!==0){var p=h.length(m);m=h.tOfLength(p+s)}return m}},{key:"sliceHole",value:function(r,i){var a=this.curveShape;if(a!==void 0&&!r.isPoint()){var s=a.curve,c=s.tOfIntersections(r);c.push(0),c.push(1),c.sort();for(var l=c[0],h=1;h<c.length;h++){var m=c[h];if(l<=i&&i<=m){var p=s.position((m+l)/2);if(r.contains(p)){var f=new Ge(l,m);a.sliceHole(f)}}l=m}}}},{key:"segments",value:function(){return[new oe.CubicBezier(this.origBezier,0,1)]}}]),n})(ne),ne.CubicBSpline=(function(e){Ve(n,e);var t=Ie(n);function n(r,i,a,s,c,l){var h;return Pe(this,n),(h=t.call(this)).s=r,h.e=i,h.origBeziers=a,h.tOfShavedStart=s,h.tOfShavedEnd=c,l.isNone||(h.curveShape=l,s>0&&l.sliceHole(new Ge(0,s)),c<1&&l.sliceHole(new Ge(c,1))),h}return Ae(n,[{key:"isDefined",get:function(){return!0}},{key:"position",value:function(r){return this.origBeziers.position(r)}},{key:"derivative",value:function(r){return this.origBeziers.derivative(r)}},{key:"angle",value:function(r){return this.origBeziers.angle(r)}},{key:"tOfPlace",value:function(r,i,a,s){var c,l;r?(c=this.tOfShavedStart,l=i?this.tOfShavedEnd-this.tOfShavedStart:1-this.tOfShavedStart):(c=0,l=i?this.tOfShavedEnd:1);var h=this.origBeziers,m=c+l*a;if(s!==0){var p=h.length(m);m=h.tOfLength(p+s)}return m}},{key:"sliceHole",value:function(r,i){var a=this.curveShape;if(a!==void 0&&!r.isPoint()){var s=a.curve,c=s.tOfIntersections(r);c.push(0),c.push(1),c.sort();for(var l=c[0],h=1;h<c.length;h++){var m=c[h];if(l<=i&&i<=m){var p=s.position((m+l)/2);if(r.contains(p)){var f=new Ge(l,m);a.sliceHole(f)}}l=m}}}},{key:"segments",value:function(){for(var r=Array(this.origBeziers.length),i=r.length,a=0;a<i;a++)r[a]=new oe.CubicBezier(this.origBezier,a/i,(a+1)/i);return r}}]),n})(ne);var Ue=function e(){ut(this,e)};function Mt(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Fr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pt(e,t,n){return t&&Fr(e.prototype,t),e}function C(e,t){for(var n in t)e.prototype.hasOwnProperty(n)?console.log("WARN","method "+n+" is already exists in class "+e.name):e.prototype[n]=t[n]}Ue.Position=(function(){function e(t){ut(this,e),this.pos=t}return kt(e,[{key:"position",value:function(t){return this.pos}},{key:"toString",value:function(){return this.pos.toString()}}]),e})(),Ue.Macro=(function(){function e(t){ut(this,e),this.macro=t}return kt(e,[{key:"position",value:function(t){return env.c=this.macro.position(t),env.c}},{key:"toString",value:function(){return this.macro.toString()}}]),e})(),Ue.Base=(function(){function e(t,n,r){ut(this,e),this.origin=t,this.xBase=n,this.yBase=r}return kt(e,[{key:"position",value:function(t){var n=t.env;return n.origin=this.origin,n.xBase=this.xBase,n.yBase=this.yBase,n.c}},{key:"toString",value:function(){return"origin:"+this.origin+", xBase:"+this.xBase+", yBase:"+this.yBase}}]),e})(),Ue.Stack=(function(){function e(t){ut(this,e),this.stack=t}return kt(e,[{key:"position",value:function(t){var n=t.env;return this.stack.isEmpty||(this.stack.tail.reverse().foreach((function(r){n.capturePosition(r)})),n.c=this.stack.head),n.c}},{key:"toString",value:function(){return this.stack.toString()}}]),e})(),C(u.PosDecor,{toShape:function(e){this.pos.toShape(e),this.decor.toShape(e)}}),C(u.Pos.Coord,{toShape:function(e){e.env.c=this.coord.position(e),this.pos2s.foreach((function(t){t.toShape(e)}))}}),C(u.Pos.Plus,{toShape:function(e){var t=e.env,n=this.coord.position(e);t.c=n.move(t.c.x+n.x,t.c.y+n.y)}}),C(u.Pos.Minus,{toShape:function(e){var t=e.env,n=this.coord.position(e);t.c=n.move(t.c.x-n.x,t.c.y-n.y)}}),C(u.Pos.Skew,{toShape:function(e){var t=e.env,n=this.coord.position(e);t.c=new O.Point(n.x+t.c.x,n.y+t.c.y).combineRect(t.c)}}),C(u.Pos.Cover,{toShape:function(e){var t=e.env,n=this.coord.position(e);t.c=t.c.combineRect(n)}}),C(u.Pos.Then,{toShape:function(e){var t=e.env;t.capturePosition(t.c),t.c=this.coord.position(e)}}),C(u.Pos.SwapPAndC,{toShape:function(e){var t=e.env;t.swapPAndC(),t.c=this.coord.position(e)}}),C(u.Pos.SetBase,{toShape:function(e){var t=e.env,n=t.p,r=t.c.x-n.x,i=t.c.y-n.y;t.setOrigin(n.x,n.y),t.setXBase(r,i),t.setYBase(-i,r),t.c=this.coord.position(e)}}),C(u.Pos.SetYBase,{toShape:function(e){var t=e.env;t.setYBase(t.c.x-t.origin.x,t.c.y-t.origin.y),t.c=this.coord.position(e)}}),C(u.Pos.ConnectObject,{toShape:function(e){this.object.toConnectShape(e)}}),C(u.Pos.DropObject,{toShape:function(e){this.object.toDropShape(e)}}),C(u.Pos.Place,{toShape:function(e){var t=e.env;if(t.lastCurve.isDefined){var n,r=this.place,i=r.shaveP>0,a=r.shaveC>0,s=i?r.shaveP-1:0,c=a?r.shaveC-1:0;if(i&&(n=0),a&&(n=1),i==a&&(n=.5),r.factor!==void 0)if(r.factor.isIntercept){if(a=i=!1,(n=r.factor.value(e))===void 0)return}else n=r.factor.value(e);var l=o.measure.length2em(r.slide.dimen.getOrElse("0"))+(s-c)*o.measure.jot,h=t.lastCurve.tOfPlace(i,a,n,l),m=t.lastCurve.position(h),p=t.lastCurve.angle(h);return t.c=m,t.angle=p,h}}}),C(u.Pos.PushCoord,{toShape:function(e){var t=e.env,n=this.coord.position(e);t.pushPos(n)}}),C(u.Pos.EvalCoordThenPop,{toShape:function(e){var t=e.env;t.c=this.coord.position(e),t.popPos()}}),C(u.Pos.LoadStack,{toShape:function(e){var t=e.env;t.startCapturePositions(),this.coord.position(e);var n=t.endCapturePositions();t.setStack(n),t.pushPos(t.c)}}),C(u.Pos.DoCoord,{toShape:function(e){var t=e.env,n=this.coord;t.stack.reverse().foreach((function(r){t.c=r,n.position(e)}))}}),C(u.Pos.InitStack,{toShape:function(e){e.env.initStack()}}),C(u.Pos.EnterFrame,{toShape:function(e){e.env.enterStackFrame()}}),C(u.Pos.LeaveFrame,{toShape:function(e){e.env.leaveStackFrame()}}),C(u.Place.Factor,{value:function(e){return this.factor}}),C(u.Place.Intercept,{value:function(e){var t=e.env;if(t.lastCurve.isDefined){var n=t.duplicate();n.angle=0,n.lastCurve=ne.none,n.p=n.c=be.originPosition;var r=new le(d.none,n);this.pos.toShape(r),e.appendShapeToFront(r.shape),n.lastCurve.isDefined||(n.lastCurve=new ne.Line(n.p,n.c,n.p,n.c,void 0));for(var i=[],a=t.lastCurve.segments(),s=n.lastCurve.segments(),c=0;c<a.length;c++)for(var l=0;l<s.length;l++)i=i.concat(oe.findIntersections(a[c],s[l]));if(i.length===0){console.log("perhaps no curve intersection.");for(var h=t.lastCurve,m=n.lastCurve,p=1e-5,f=0,y=2,x=0,w=0,b=function(Bn){return 1/(1+Math.exp(-Bn))},P=function(Bn){var On=Math.exp(-Bn);return On/(1+On)/(1+On)},M=b(x),B=b(w),A=P(x),R=P(w),U=h.derivative(M),T=m.derivative(B),L=U.x*A,X=-T.x*R,q=U.y*A,J=-T.y*R,Y=L*L+q*q,ee=L*X+q*J,re=X*L+J*q,$=X*X+J*J,ue=h.position(M),me=m.position(B),ie=ue.x-me.x,he=ue.y-me.y,ae=L*ie+q*he,pe=X*ie+J*he,ve=Math.sqrt(ae*ae+pe*pe)<p,xe=.001*Math.max(Y,$);!ve&&f<100;){f++;do{var ge=$+xe,Le=(Y+xe)*ge-ee*re,we=(ge*ae-ee*pe)/Le,Ce=(-re*ae+Y*pe)/Le;if(we*we+Ce*Ce<10000000000000002e-26*(x*x+w*w))ve=!0;else{var Re=x-we,$e=w-Ce,ze=b(Re),Je=b($e),je=h.position(ze),sr=m.position(Je),Cn=je.x-sr.x,kn=je.y-sr.y,zt=(ie*ie+he*he-(Cn*Cn+kn*kn))/(we*(xe*we+ae)+Ce*(xe*Ce+pe));if(zt>0){w=$e,M=ze,B=Je,A=P(x=Re),R=P(w),U=h.derivative(M),T=m.derivative(B),L=U.x*A,X=-T.x*R,Y=L*L+(q=U.y*A)*q,ee=L*X+q*(J=-T.y*R),re=X*L+J*q,$=X*X+J*J,ae=L*(ie=Cn)+q*(he=kn),pe=X*ie+J*he,ve=Math.sqrt(ae*ae+pe*pe)<p;var Mn=2*zt-1;xe+=Math.max(1/3,1-Mn*Mn*Mn),y=2}else xe*=y,y*=2}}while(!(ve||zt!==void 0&&zt>0))}return b(x)}var Pn=(i[0][0].min+i[0][0].max)/2;for(c=1;c<i.length;c++){var cr=(i[c][0].min+i[c][0].max)/2;Pn>cr&&(Pn=cr)}return Pn}}}),C(u.Pos.SavePos,{toShape:function(e){var t=e.env;t.savePos(this.id,new Ue.Position(t.c))}}),C(u.Pos.SaveMacro,{toShape:function(e){e.env.savePos(this.id,new Ue.Macro(this.macro))}}),C(u.Pos.SaveBase,{toShape:function(e){var t=e.env;t.savePos(this.id,new Ue.Base(t.origin,t.xBase,t.yBase))}}),C(u.Pos.SaveStack,{toShape:function(e){var t=e.env;t.savePos(this.id,new Ue.Stack(t.stack))}}),C(u.Object,{toDropShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=this.modifiers;if(n.isEmpty)return this.object.toDropShape(e);var r=t.duplicate(),i=new le(d.none,r),a=j.empty;n.foreach((function(h){h.preprocess(i,a),a=a.prepend(h)}));var s=this.object.toDropShape(i),c=r.c;if(c===void 0)return d.none;var l=r.originalReferencePoint;return(r=t.duplicate()).c=c,r.originalReferencePoint=l,i=new le(d.none,r),s=n.head.modifyShape(i,s,n.tail),e.appendShapeToFront(s),t.c=r.c.move(t.c.x,t.c.y),s},toConnectShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=this.modifiers;if(n.isEmpty)return this.object.toConnectShape(e);var r=t.duplicate(),i=new le(d.none,r),a=j.empty;n.foreach((function(h){h.preprocess(i,a),a=a.prepend(h)}));var s=this.object.toConnectShape(i);t.angle=r.angle,t.lastCurve=r.lastCurve;var c=r.c;if(c===void 0)return d.none;var l=r.originalReferencePoint;return(r=t.duplicate()).c=c,r.originalReferencePoint=l,i=new le(d.none,r),s=n.head.modifyShape(i,s,n.tail),e.appendShapeToFront(s),t.c=r.c.move(t.c.x,t.c.y),s},boundingBox:function(e){var t=e.duplicateEnv(),n=t.env;return n.angle=0,n.p=n.c=be.originPosition,t.shape=d.none,this.toDropShape(t).getBoundingBox()}}),C(u.ObjectBox,{toConnectShape:function(e){var t=(n=e.env).c,n=e.env,r=(o.measure.thickness,n.p.edgePoint(n.c.x,n.c.y)),i=n.c.edgePoint(n.p.x,n.p.y);if(r.x!==i.x||r.y!==i.y){var a=new K.Line(r,i).toShape(e,this,"196883","");return n.originalReferencePoint=t,a}return n.angle=0,n.lastCurve=ne.none,n.originalReferencePoint=t,d.none},boundingBox:function(e){var t=e.duplicateEnv(),n=t.env;return n.angle=0,n.p=n.c=be.originPosition,t.shape=d.none,this.toDropShape(t).getBoundingBox()}}),C(u.ObjectBox.WrapUpObject,{toDropShape:function(e){var t=e.env,n=this.object.toDropShape(e);return t.originalReferencePoint=t.c,n},toConnectShape:function(e){var t=e.env,n=this.object.toConnectShape(e);return t.originalReferencePoint=t.c,n}}),C(u.ObjectBox.CompositeObject,{toDropShape:function(e){var t=e.env,n=t.c;if(n===void 0)return d.none;var r=n,i=t.duplicate(),a=new le(d.none,i);this.objects.foreach((function(c){i.c=n;var l=c.toDropShape(a);r=O.combineRect(r,i.c),r=O.combineRect(r,l.getBoundingBox().toPoint())})),t.c=r;var s=a.shape;return e.appendShapeToFront(s),t.originalReferencePoint=n,s}}),C(u.ObjectBox.Xybox,{toDropShape:function(e){var t=e.env,n=t.c;if(n===void 0)return d.none;var r=new be,i=new le(d.none,r);this.posDecor.toShape(i);var a=i.shape,s=a.getBoundingBox();if(s===void 0)return d.none;var c=Math.max(0,s.l-s.x),l=Math.max(0,s.r+s.x),h=Math.max(0,s.u+s.y),m=Math.max(0,s.d-s.y);t.c=new O.Rect(n.x,n.y,{l:c,r:l,u:h,d:m}),t.originalReferencePoint=n;var p=new d.TranslateShape(n.x,n.y,a);return e.appendShapeToFront(p),p}}),C(u.ObjectBox.Xymatrix,{toDropShape:function(e){var t=e.env,n=t.c,r=this.xymatrix.toShape(e);return t.originalReferencePoint=n,r}}),C(u.ObjectBox.Text,{toDropShape:function(e){var t=e.env,n=new d.TextShape(t.c,this.math);return e.appendShapeToFront(n),t.c=n.getBoundingBox(),t.originalReferencePoint=n.getOriginalReferencePoint(),n}}),C(u.ObjectBox.Empty,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,t.c=new O.Point(t.c.x,t.c.y),d.none}}),C(u.ObjectBox.Txt,{toDropShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=this.textObject.toDropShape(e);return t.originalReferencePoint=t.c,n}}),C(u.ObjectBox.Txt.Width.Vector,{width:function(e){return this.vector.xy().x}}),C(u.ObjectBox.Txt.Width.Default,{width:function(e){var t=e.env.c;return t.r+t.l}}),C(u.ObjectBox.Cir,{toDropShape:function(e){var t=e.env;if(t.c===void 0)return d.none;t.originalReferencePoint=t.c;var n=this.radius.radius(e),r=t.c.x,i=t.c.y,a=this.cir.toDropShape(e,r,i,n);return t.c=new O.Ellipse(r,i,n,n,n,n),a},toConnectShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,d.none}}),C(u.ObjectBox.Cir.Radius.Vector,{radius:function(e){return this.vector.xy(e).x}}),C(u.ObjectBox.Cir.Radius.Default,{radius:function(e){return e.env.c.r}}),C(u.ObjectBox.Cir.Cir.Segment,{toDropShape:function(e,t,n,r){e.env;var i,a,s=this.startPointDegree(e),c=this.endPointDegree(e,s),l=c-s;if((l=l<0?l+360:l)===0)return d.none;this.orient==="^"?(i=l>180?"1":"0",a="0"):(i=l>180?"0":"1",a="1");var h=Math.PI/180,m=t+r*Math.cos(s*h),p=n+r*Math.sin(s*h),f=t+r*Math.cos(c*h),y=n+r*Math.sin(c*h),x=new d.CircleSegmentShape(t,n,m,p,r,i,a,f,y);return e.appendShapeToFront(x),x},startPointDegree:function(e){var t=this.startDiag.toString();return this.orient==="^"?this.diagToAngleACW(t):this.diagToAngleCW(t)},endPointDegree:function(e,t){var n=this.endDiag.toString();return this.orient==="^"?this.diagToAngleACW(n,t):this.diagToAngleCW(n,t)},diagToAngleACW:function(e,t){switch(e){case"l":return 90;case"r":return-90;case"d":return 180;case"u":return 0;case"dl":case"ld":return 135;case"dr":case"rd":return-135;case"ul":case"lu":return 45;case"ur":case"ru":return-45;default:return t===void 0?0:t+180}},diagToAngleCW:function(e,t){switch(e){case"l":return-90;case"r":return 90;case"d":return 0;case"u":return 180;case"dl":case"ld":return-45;case"dr":case"rd":return 45;case"ul":case"lu":return-135;case"ur":case"ru":return 135;default:return t===void 0?0:t+180}}}),C(u.ObjectBox.Cir.Cir.Full,{toDropShape:function(e,t,n,r){var i=new d.FullCircleShape(t,n,r);return e.appendShapeToFront(i),i}}),C(u.ObjectBox.Frame,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,this.toDropFilledShape(e,"currentColor",!1)},toDropFilledShape:function(e,t,n){var r=e.env.c;if(r===void 0)return d.none;var i=o.measure.thickness,a=r.x,s=r.y,c=r.l,l=r.r,h=r.u,m=r.d,p=d.none;switch(this.main){case"--":var f=3*i;if(n){var y=this.radius.xy(e);p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,o.measure.em2px(f)+" "+o.measure.em2px(f))}else{var x=this.radius.radius(e);p=new d.RectangleShape(a,s,c,l,h,m,x,!1,t,o.measure.em2px(f)+" "+o.measure.em2px(f))}break;case"==":f=3*i,n?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!0,t,o.measure.em2px(f)+" "+o.measure.em2px(f))):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!0,t,o.measure.em2px(f)+" "+o.measure.em2px(f)));break;case"o-":f=3*i,x=o.measure.lineElementLength,p=new d.RectangleShape(a,s,c,l,h,m,x,!1,t,o.measure.em2px(f)+" "+o.measure.em2px(f));break;case"oo":var w=(y=this.radius.xy(e)).x;p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,w,w,!0,t,void 0);break;case"ee":y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!0,t,void 0);break;case"-,":var b=this.radius.depth(e);x=this.radius.radius(e),p=new d.CompositeShape(new d.RectangleShape(a,s,c,l,h,m,x,!1,t,void 0),new d.BoxShadeShape(a,s,c,l,h,m,b));break;case".o":w=(y=this.radius.xy(e)).x,p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,w,w,!1,t,o.measure.dottedDasharray);break;case"-o":f=3*i,w=(y=this.radius.xy(e)).x,p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,w,w,!1,t,o.measure.em2px(f)+" "+o.measure.em2px(f));break;case".e":y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,o.measure.dottedDasharray);break;case"-e":f=3*i,y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,o.measure.em2px(f)+" "+o.measure.em2px(f));break;case"-":n?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,void 0)):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!1,t,void 0));break;case"=":n?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!0,t,void 0)):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!0,t,void 0));break;case".":n?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,o.measure.dottedDasharray)):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!1,t,o.measure.dottedDasharray));break;case",":b=this.radius.depth(e),p=new d.BoxShadeShape(a,s,c,l,h,m,b,t);break;case"o":w=(y=this.radius.xy(e)).x,p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,w,w,!1,t,void 0);break;case"e":y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,t,void 0);break;case"\\{":p=new d.LeftBrace(a-c,s,h,m,0,t);break;case"\\}":p=new d.LeftBrace(a+l,s,m,h,180,t);break;case"^\\}":case"^\\{":p=new d.LeftBrace(a,s+h,l,c,270,t);break;case"_\\{":case"_\\}":p=new d.LeftBrace(a,s-m,c,l,90,t);break;case"(":p=new d.LeftParenthesis(a-c,s+(h-m)/2,h+m,0,t);break;case")":p=new d.LeftParenthesis(a+l,s+(h-m)/2,h+m,180,t);break;case"^(":case"^)":p=new d.LeftParenthesis(a+(l-c)/2,s+h,c+l,270,t);break;case"_(":case"_)":p=new d.LeftParenthesis(a+(l-c)/2,s-m,c+l,90,t);break;case"*":r.isCircle()?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,"currentColor",void 0,t,!0)):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!1,"currentColor",void 0,t,!0));break;case"**":r.isCircle()?(y=this.radius.xy(e),p=new d.EllipseShape(a+(l-c)/2,s+(h-m)/2,y.x,y.y,!1,"currentColor",void 0,t,!1)):(x=this.radius.radius(e),p=new d.RectangleShape(a,s,c,l,h,m,x,!1,"currentColor",void 0,t,!1));break;default:return d.none}return e.appendShapeToFront(p),p},toConnectShape:function(e){var t=e.env,n=t.c,r=t.p;n!==void 0&&r!==void 0||d.none,t.originalReferencePoint=n;var i=t.duplicate();i.c=r.combineRect(n);var a=new le(d.none,i),s=this.toDropShape(a);return e.appendShapeToFront(s),s}}),C(u.ObjectBox.Frame.Radius.Vector,{radius:function(e){return this.vector.xy(e).x},depth:function(e){return this.vector.xy(e).x},xy:function(e){return this.vector.xy(e)}}),C(u.ObjectBox.Frame.Radius.Default,{radius:function(e){return 0},depth:function(e){return o.measure.thickness/2},xy:function(e){var t=e.env.c;return{x:(t.l+t.r)/2,y:(t.u+t.d)/2}}}),C(u.ObjectBox.Dir,{toDropShape:function(e){var t=e.env,n=t.c;t.originalReferencePoint=n;var r=t.angle;if(n===void 0)return d.none;t.c=new O.Point(n.x,n.y),o.measure.thickness;var i=d.none;switch(this.main){case"":return d.none;case">":switch(this.variant){case"2":var a=(i=new d.GT2ArrowheadShape(n,r)).getRadius();t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;case"3":a=(i=new d.GT3ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;default:i=this.variant==="^"?new d.UpperGTArrowheadShape(n,r):this.variant==="_"?new d.LowerGTArrowheadShape(n,r):new d.GTArrowheadShape(n,r)}break;case"<":switch(this.variant){case"2":a=(i=new d.LT2ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;case"3":a=(i=new d.LT3ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;default:i=this.variant==="^"?new d.UpperLTArrowheadShape(n,r):this.variant==="_"?new d.LowerLTArrowheadShape(n,r):new d.LTArrowheadShape(n,r)}break;case"|":switch(this.variant){case"^":i=new d.UpperColumnArrowheadShape(n,r);break;case"_":i=new d.LowerColumnArrowheadShape(n,r);break;case"2":i=new d.Column2ArrowheadShape(n,r);break;case"3":i=new d.Column3ArrowheadShape(n,r);break;default:i=new d.ColumnArrowheadShape(n,r)}break;case"(":switch(this.variant){case"^":i=new d.UpperLParenArrowheadShape(n,r);break;case"_":i=new d.LowerLParenArrowheadShape(n,r);break;default:i=new d.LParenArrowheadShape(n,r)}break;case")":switch(this.variant){case"^":i=new d.UpperRParenArrowheadShape(n,r);break;case"_":i=new d.LowerRParenArrowheadShape(n,r);break;default:i=new d.RParenArrowheadShape(n,r)}break;case"`":i=this.variant==="_"?new d.LowerBackquoteArrowheadShape(n,r):new d.UpperBackquoteArrowheadShape(n,r);break;case"'":i=this.variant==="_"?new d.LowerQuoteArrowheadShape(n,r):new d.UpperQuoteArrowheadShape(n,r);break;case"*":i=new d.AsteriskArrowheadShape(n,0);break;case"o":i=new d.OArrowheadShape(n,0);break;case"+":i=new d.PlusArrowheadShape(n,r);break;case"x":i=new d.XArrowheadShape(n,r);break;case"/":i=new d.SlashArrowheadShape(n,r);break;case"-":case"--":o.measure.lineElementLength,i=this.variant==="3"?new d.Line3ArrowheadShape(n,r):this.variant==="2"?new d.Line2ArrowheadShape(n,r):new d.LineArrowheadShape(n,r);break;case"=":case"==":i=new d.Line2ArrowheadShape(n,r);break;case".":case"..":i=this.variant==="3"?new d.Dot3ArrowheadShape(n,r):this.variant==="2"?new d.Dot2ArrowheadShape(n,r):new d.DotArrowheadShape(n,r);break;case":":case"::":i=new d.Dot2ArrowheadShape(n,r);break;case"~":case"~~":i=this.variant==="3"?new d.Tilde3ArrowheadShape(n,r):this.variant==="2"?new d.Tilde2ArrowheadShape(n,r):new d.TildeArrowheadShape(n,r);break;case">>":switch(this.variant){case"^":i=new d.UpperGTGTArrowheadShape(n,r);break;case"_":i=new d.LowerGTGTArrowheadShape(n,r);break;case"2":a=(i=new d.GTGT2ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;case"3":a=(i=new d.GTGT3ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;default:i=new d.GTGTArrowheadShape(n,r)}break;case"<<":switch(this.variant){case"^":i=new d.UpperLTLTArrowheadShape(n,r);break;case"_":i=new d.LowerLTLTArrowheadShape(n,r);break;case"2":a=(i=new d.LTLT2ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;case"3":a=(i=new d.LTLT3ArrowheadShape(n,r)).getRadius(),t.c=new O.Ellipse(n.x,n.y,a,a,a,a);break;default:i=new d.LTLTArrowheadShape(n,r)}break;case"||":switch(this.variant){case"^":i=new d.UpperColumnColumnArrowheadShape(n,r);break;case"_":i=new d.LowerColumnColumnArrowheadShape(n,r);break;case"2":i=new d.ColumnColumn2ArrowheadShape(n,r);break;case"3":i=new d.ColumnColumn3ArrowheadShape(n,r);break;default:i=new d.ColumnColumnArrowheadShape(n,r)}break;case"|-":switch(this.variant){case"^":i=new d.UpperColumnLineArrowheadShape(n,r);break;case"_":i=new d.LowerColumnLineArrowheadShape(n,r);break;case"2":i=new d.ColumnLine2ArrowheadShape(n,r);break;case"3":i=new d.ColumnLine3ArrowheadShape(n,r);break;default:i=new d.ColumnLineArrowheadShape(n,r)}break;case">|":i=new d.GTColumnArrowheadShape(n,r);break;case">>|":i=new d.GTGTColumnArrowheadShape(n,r);break;case"|<":i=new d.ColumnLTArrowheadShape(n,r);break;case"|<<":i=new d.ColumnLTLTArrowheadShape(n,r);break;case"//":i=new d.SlashSlashArrowheadShape(n,r);break;case"=>":i=new d.LineGT2ArrowheadShape(n,r);break;default:var s=o.repositories.dirRepository.get(this.main);if(s===void 0)throw ye("ExecutionError","\\dir "+this.variant+"{"+this.main+"} not defined.");i=s.toDropShape(e)}return e.appendShapeToFront(i),i},toConnectShape:function(e){var t=e.env;t.originalReferencePoint=t.c,o.measure.thickness;var n=t.p.edgePoint(t.c.x,t.c.y),r=t.c.edgePoint(t.p.x,t.p.y);return n.x!==r.x||n.y!==r.y?new K.Line(n,r).toShape(e,this,this.main,this.variant):(t.angle=0,t.lastCurve=ne.none,d.none)}}),C(u.ObjectBox.Curve,{toDropShape:function(e){var t=e.env;return t.originalReferencePoint=t.c,d.none},toConnectShape:function(e){var t=e.env;t.originalReferencePoint=t.c;var n=void 0,r=void 0;this.objects.foreach((function(w){n=w.objectForDrop(n),r=w.objectForConnect(r)})),n===void 0&&r===void 0&&(r=new u.Object(j.empty,new u.ObjectBox.Dir("","-"))),o.measure.thickness;var i=t.c,a=t.p,s=[];this.poslist.foreach((function(w){w.addPositions(s,e)})),t.c=i,t.p=a;var c=d.none,l=a,h=i;switch(s.length){case 0:return l.x===h.x&&l.y===h.y?(t.lastCurve=ne.none,t.angle=0,d.none):r===void 0?n.toConnectShape(e):r.toConnectShape(e);case 1:var m=(f=new K.QuadBezier(l,s[0],h)).tOfShavedStart(l),p=f.tOfShavedEnd(h);if(m===void 0||p===void 0||m>=p)return t.angle=0,t.lastCurve=ne.none,d.none;c=f.toShape(e,n,r),t.lastCurve=new ne.QuadBezier(f,m,p,c),t.angle=Math.atan2(h.y-l.y,h.x-l.x);break;case 2:var f;if(m=(f=new K.CubicBezier(l,s[0],s[1],h)).tOfShavedStart(l),p=f.tOfShavedEnd(h),m===void 0||p===void 0||m>=p)return t.angle=0,t.lastCurve=ne.none,d.none;c=f.toShape(e,n,r),t.lastCurve=new ne.CubicBezier(f,m,p,c),t.angle=Math.atan2(h.y-l.y,h.x-l.x);break;default:var y=new K.CubicBSpline(l,s,h),x=new K.CubicBeziers(y.toCubicBeziers());if(m=x.tOfShavedStart(l),p=x.tOfShavedEnd(h),m===void 0||p===void 0||m>=p)return t.angle=0,t.lastCurve=ne.none,d.none;c=x.toShape(e,n,r),t.lastCurve=new ne.CubicBSpline(l,h,x,m,p,c),t.angle=Math.atan2(h.y-l.y,h.x-l.x)}return c}}),C(u.ObjectBox.Curve.Object.Drop,{objectForDrop:function(e){return this.object},objectForConnect:function(e){return e}}),C(u.ObjectBox.Curve.Object.Connect,{objectForDrop:function(e){return e},objectForConnect:function(e){return this.object}}),C(u.ObjectBox.Curve.PosList.CurPos,{addPositions:function(e,t){var n=t.env;e.push(n.c)}}),C(u.ObjectBox.Curve.PosList.Pos,{addPositions:function(e,t){var n=t.env;this.pos.toShape(t),e.push(n.c)}}),C(u.ObjectBox.Curve.PosList.AddStack,{addPositions:function(e,t){t.env.stack.reverse().foreach((function(n){e.push(n)}))}}),C(u.Coord.C,{position:function(e){return e.env.c}}),C(u.Coord.P,{position:function(e){return e.env.p}}),C(u.Coord.X,{position:function(e){var t=e.env,n=t.p,r=t.c,i=t.origin,a=t.xBase,s=r.y-n.y,c=n.x-r.x,l=r.x*n.y-r.y*n.x,h=a.y,m=-a.x,p=a.x*i.y-a.y*i.x,f=s*m-h*c;if(Math.abs(f)<Be.machinePrecision)return console.log("there is no intersection point."),be.originPosition;var y=-(m*l-c*p)/f,x=(h*l-s*p)/f;return new O.Point(y,x)}}),C(u.Coord.Y,{position:function(e){var t=e.env,n=t.p,r=t.c,i=t.origin,a=t.yBase,s=r.y-n.y,c=n.x-r.x,l=r.x*n.y-r.y*n.x,h=a.y,m=-a.x,p=a.x*i.y-a.y*i.x,f=s*m-h*c;if(Math.abs(f)<Be.machinePrecision)return console.log("there is no intersection point."),be.originPosition;var y=-(m*l-c*p)/f,x=(h*l-s*p)/f;return new O.Point(y,x)}}),C(u.Coord.Vector,{position:function(e){var t=this.vector.xy(e);return new O.Point(t.x,t.y)}}),C(u.Coord.Id,{position:function(e){return e.env.lookupPos(this.id).position(e)}}),C(u.Coord.Group,{position:function(e){var t=e.env,n=t.origin,r=t.xBase,i=t.yBase,a=t.p;return this.posDecor.toShape(e),t.p=a,t.origin=n,t.xBase=r,t.yBase=i,t.c}}),C(u.Coord.StackPosition,{position:function(e){return e.env.stackAt(this.number)}}),C(u.Coord.DeltaRowColumn,{position:function(e){var t=e.env,n=t.xymatrixRow,r=t.xymatrixCol;if(n===void 0||r===void 0)throw ye("ExecutionError","xymatrix rows and columns not found for "+this.toSring());var i=this.prefix+(n+this.dr)+","+(r+this.dc);return e.env.lookupPos(i,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+i+") from here.").position(e)}}),C(u.Coord.Hops,{position:function(e){var t=e.env,n=t.xymatrixRow,r=t.xymatrixCol;if(n===void 0||r===void 0)throw ye("ExecutionError","xymatrix rows and columns not found for "+this.toSring());this.hops.foreach((function(a){switch(a){case"u":--n;break;case"d":n+=1;break;case"l":--r;break;case"r":r+=1}}));var i=this.prefix+n+","+r;return e.env.lookupPos(i,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+i+") from here.").position(e)}}),C(u.Coord.HopsWithPlace,{position:function(e){var t=e.env,n=t.xymatrixRow,r=t.xymatrixCol;if(n===void 0||r===void 0)throw ye("ExecutionError","xymatrix rows and columns not found for "+this.toSring());this.hops.foreach((function(x){switch(x){case"u":--n;break;case"d":n+=1;break;case"l":--r;break;case"r":r+=1}}));var i=this.prefix+n+","+r,a=e.env.lookupPos(i,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+i+") from here.").position(e),s=(t.c,t.duplicate());s.p=t.c,s.c=a;var c,l=s.c.x-s.p.x,h=s.c.y-s.p.y;c=l===0&&h===0?0:Math.atan2(h,l),s.angle=c;var m=s.p.edgePoint(s.c.x,s.c.y),p=s.c.edgePoint(s.p.x,s.p.y);s.lastCurve=new ne.Line(m,p,s.p,s.c,void 0);var f=new le(d.none,s),y=this.place.toShape(f);return s.lastCurve.position(y)}}),C(u.Vector.InCurBase,{xy:function(e){return e.env.absVector(this.x,this.y)},angle:function(e){var t=e.env.absVector(this.x,this.y);return Math.atan2(t.y,t.x)}}),C(u.Vector.Abs,{xy:function(e){return{x:o.measure.length2em(this.x),y:o.measure.length2em(this.y)}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Vector.Angle,{xy:function(e){var t=Math.PI/180*this.degree;return e.env.absVector(Math.cos(t),Math.sin(t))},angle:function(e){return Math.PI/180*this.degree}}),C(u.Vector.Dir,{xy:function(e){var t=o.measure.length2em(this.dimen),n=this.dir.angle(e);return{x:t*Math.cos(n),y:t*Math.sin(n)}},angle:function(e){return this.dir.angle(e)}}),C(u.Vector.Corner,{xy:function(e){var t=this.corner.xy(e);return{x:t.x*this.factor,y:t.y*this.factor}},angle:function(e){return this.corner.angle(e)}}),C(u.Corner.L,{xy:function(e){return{x:-e.env.c.l,y:0}},angle:function(e){return Math.PI}}),C(u.Corner.R,{xy:function(e){return{x:e.env.c.r,y:0}},angle:function(e){return 0}}),C(u.Corner.D,{xy:function(e){return{x:0,y:-e.env.c.d}},angle:function(e){return-Math.PI/2}}),C(u.Corner.U,{xy:function(e){return{x:0,y:e.env.c.u}},angle:function(e){return Math.PI/2}}),C(u.Corner.CL,{xy:function(e){var t=e.env.c;return{x:-t.l,y:(t.u-t.d)/2}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.CR,{xy:function(e){var t=e.env.c;return{x:t.r,y:(t.u-t.d)/2}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.CD,{xy:function(e){var t=e.env.c;return{x:(t.r-t.l)/2,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.CU,{xy:function(e){var t=e.env.c;return{x:(t.r-t.l)/2,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.LU,{xy:function(e){var t=e.env.c;return{x:-t.l,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.LD,{xy:function(e){var t=e.env.c;return{x:-t.l,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.RU,{xy:function(e){var t=e.env.c;return{x:t.r,y:t.u}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.RD,{xy:function(e){var t=e.env.c;return{x:t.r,y:-t.d}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.NearestEdgePoint,{xy:function(e){var t=e.env,n=t.c,r=n.edgePoint(t.p.x,t.p.y);return{x:r.x-n.x,y:r.y-n.y}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.PropEdgePoint,{xy:function(e){var t=e.env,n=t.c,r=n.proportionalEdgePoint(t.p.x,t.p.y);return{x:r.x-n.x,y:r.y-n.y}},angle:function(e){var t=this.xy(e);return Math.atan2(t.y,t.x)}}),C(u.Corner.Axis,{xy:function(e){return{x:0,y:o.measure.axisHeightLength}},angle:function(e){return Math.PI/2}}),C(u.Modifier,{proceedModifyShape:function(e,t,n){return n.isEmpty?t:n.head.modifyShape(e,t,n.tail)}}),C(u.Modifier.Vector,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=this.vector.xy(e),i=e.env;return i.c=i.c.shiftFrame(-r.x,-r.y),t=new d.TranslateShape(-r.x,-r.y,t),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.RestoreOriginalRefPoint,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env,i=r.originalReferencePoint;if(i!==void 0){var a=r.c.x-i.x,s=r.c.y-i.y;r.c=r.c.shiftFrame(a,s),t=new d.TranslateShape(a,s,t)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.Point,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env.c;return e.env.c=new O.Point(r.x,r.y),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.Rect,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env.c;return e.env.c=new O.Rect(r.x,r.y,{l:r.l,r:r.r,u:r.u,d:r.d}),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.Circle,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env.c;return e.env.c=new O.Ellipse(r.x,r.y,r.l,r.r,r.u,r.d),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.L,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env,i=r.c;if(i!==void 0){var a,s,c=i.r+i.l,l=i.u+i.d;c<l?(a=(i.l-i.r)/2,s=(i.d-i.u)/2):(a=-i.r+l/2,s=(i.d-i.u)/2),r.c=r.c.shiftFrame(a,s),t=new d.TranslateShape(a,s,t)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.R,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env,i=r.c;if(i!==void 0){var a,s,c=i.r+i.l,l=i.u+i.d;c<l?(a=(i.l-i.r)/2,s=(i.d-i.u)/2):(a=i.l-l/2,s=(i.d-i.u)/2),r.c=r.c.shiftFrame(a,s),t=new d.TranslateShape(a,s,t)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.U,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env,i=r.c;if(i!==void 0){var a,s,c=i.r+i.l;c>i.u+i.d?(a=(i.l-i.r)/2,s=(i.d-i.u)/2):(a=(i.l-i.r)/2,s=i.d-c/2),r.c=r.c.shiftFrame(a,s),t=new d.TranslateShape(a,s,t)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.D,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env,i=r.c;if(i!==void 0){var a,s,c=i.r+i.l;c>i.u+i.d?(a=(i.l-i.r)/2,s=(i.d-i.u)/2):(a=(i.l-i.r)/2,s=-i.u+c/2),r.c=r.c.shiftFrame(a,s),t=new d.TranslateShape(a,s,t)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.C,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r,i,a=e.env,s=a.c;return s!==void 0&&(r=(s.l-s.r)/2,i=(s.d-s.u)/2,a.c=a.c.shiftFrame(r,i),t=new d.TranslateShape(r,i,t)),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.ChangeColor,{preprocess:function(e,t){},modifyShape:function(e,t,n){return t=this.proceedModifyShape(e,t,n),new d.ChangeColorShape(this.colorName,t)}}),C(u.Modifier.Shape.Alphabets,{preprocess:function(e,t){var n=o.repositories.modifierRepository.get(this.alphabets);if(n!==void 0)return n.preprocess(e,t)},modifyShape:function(e,t,n){var r=o.repositories.modifierRepository.get(this.alphabets);if(r!==void 0)return r.modifyShape(e,t,n)}}),C(u.Modifier.Shape.DefineShape,{preprocess:function(e,t){var n=t.reverse();o.repositories.modifierRepository.put(this.shape,new u.Modifier.Shape.CompositeModifiers(n))},modifyShape:function(e,t,n){return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.CompositeModifiers,{preprocess:function(e,t){this.modifiers.foreach((function(n){n.preprocess(e,t),t=t.prepend(n)}))},modifyShape:function(e,t,n){return t=this.proceedModifyShape(e,t,this.modifiers),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Invisible,{preprocess:function(e,t){},modifyShape:function(e,t,n){return t=this.proceedModifyShape(e,t,n),d.none}}),C(u.Modifier.Hidden,{preprocess:function(e,t){},modifyShape:function(e,t,n){return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Direction,{preprocess:function(e,t){e.env.angle=this.direction.angle(e)},modifyShape:function(e,t,n){return e.env.angle=this.direction.angle(e),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.AddOp,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env.c;return e.env.c=this.op.apply(this.size,r,e),e.appendShapeToFront(new d.InvisibleBoxShape(e.env.c)),this.proceedModifyShape(e,t,n)}}),C(u.Modifier.AddOp.Grow,{apply:function(e,t,n){var r=n.env,i=e.isDefault?{x:2*r.objectmargin,y:2*r.objectmargin}:e.vector.xy(n),a=Math.abs(i.x/2),s=Math.abs(i.y/2);return t.grow(a,s)},applyToDimen:function(e,t){return e+t}}),C(u.Modifier.AddOp.Shrink,{apply:function(e,t,n){var r=n.env,i=e.isDefault?{x:2*r.objectmargin,y:2*r.objectmargin}:e.vector.xy(n),a=-Math.abs(i.x/2),s=-Math.abs(i.y/2);return t.grow(a,s)},applyToDimen:function(e,t){return e-t}}),C(u.Modifier.AddOp.Set,{apply:function(e,t,n){var r=n.env,i=e.isDefault?{x:r.objectwidth,y:r.objectheight}:e.vector.xy(n),a=Math.abs(i.x),s=Math.abs(i.y);return t.toSize(a,s)},applyToDimen:function(e,t){return t}}),C(u.Modifier.AddOp.GrowTo,{apply:function(e,t,n){var r=Math.max(t.l+t.r,t.u+t.d),i=e.isDefault?{x:r,y:r}:e.vector.xy(n),a=Math.abs(i.x),s=Math.abs(i.y);return t.growTo(a,s)},applyToDimen:function(e,t){return Math.max(Math.max(e,t),0)}}),C(u.Modifier.AddOp.ShrinkTo,{apply:function(e,t,n){var r=Math.min(t.l+t.r,t.u+t.d),i=e.isDefault?{x:r,y:r}:e.vector.xy(n),a=Math.abs(i.x),s=Math.abs(i.y);return t.shrinkTo(a,s)},applyToDimen:function(e,t){return Math.max(Math.min(e,t),0)}}),C(u.Modifier.Shape.Frame,{preprocess:function(e,t){},modifyShape:function(e,t,n){var r=e.env;if(r.c!==void 0){this.main;var i=new u.ObjectBox.Frame.Radius.Default,a="currentColor";this.options.foreach((function(h){i=h.getRadius(i)})),this.options.foreach((function(h){a=h.getColorName(a)}));var s=r.duplicate(),c=new le(d.none,s),l=new u.ObjectBox.Frame(i,this.main).toDropFilledShape(c,a,r.c.isCircle());t=new d.CompositeShape(t,l)}return this.proceedModifyShape(e,t,n)}}),C(u.Modifier.Shape.Frame.Radius,{getRadius:function(e){return new u.ObjectBox.Frame.Radius.Vector(this.vector)},getColorName:function(e){return e}}),C(u.Modifier.Shape.Frame.Color,{getRadius:function(e){return e},getColorName:function(e){return this.colorName}}),C(u.Direction.Compound,{angle:function(e){var t=this.dir.angle(e);return this.rots.foreach((function(n){t=n.rotate(t,e)})),t}}),C(u.Direction.Diag,{angle:function(e){return this.diag.angle(e)}}),C(u.Direction.Vector,{angle:function(e){return this.vector.angle(e)}}),C(u.Direction.ConstructVector,{angle:function(e){var t=e.env,n=t.origin,r=t.xBase,i=t.yBase,a=t.p,s=t.c;this.posDecor.toShape(e);var c=Math.atan2(t.c.y-t.p.y,t.c.x-t.p.x);return t.c=s,t.p=a,t.origin=n,t.xBase=r,t.yBase=i,c}}),C(u.Direction.RotVector,{rotate:function(e,t){return e+this.vector.angle(t)}}),C(u.Direction.RotCW,{rotate:function(e,t){return e+Math.PI/2}}),C(u.Direction.RotAntiCW,{rotate:function(e,t){return e-Math.PI/2}}),C(u.Diag.Default,{isEmpty:!0,angle:function(e){return e.env.angle}}),C(u.Diag.Angle,{isEmpty:!1,angle:function(e){return this.ang}}),C(u.Decor,{toShape:function(e){this.commands.foreach((function(t){t.toShape(e)}))}}),C(u.Command.Save,{toShape:function(e){e.env.saveState(),this.pos.toShape(e)}}),C(u.Command.Restore,{toShape:function(e){e.env.restoreState()}}),C(u.Command.Pos,{toShape:function(e){this.pos.toShape(e)}}),C(u.Command.AfterPos,{toShape:function(e){this.pos.toShape(e),this.decor.toShape(e)}}),C(u.Command.Drop,{toShape:function(e){this.object.toDropShape(e)}}),C(u.Command.Connect,{toShape:function(e){this.object.toConnectShape(e)}}),C(u.Command.Relax,{toShape:function(e){}}),C(u.Command.Ignore,{toShape:function(e){}}),C(u.Command.ShowAST,{toShape:function(e){console.log(this.pos.toString()+" "+this.decor)}}),C(u.Command.Ar,{toShape:function(e){var t=e.env,n=t.origin,r=t.xBase,i=t.yBase,a=t.p,s=t.c;t.pathActionForBeforeSegment=G.empty,t.pathActionForAfterSegment=G.empty,t.labelsForNextSegmentOnly=G.empty,t.labelsForLastSegmentOnly=G.empty,t.labelsForEverySegment=G.empty,t.segmentSlideEm=G.empty,t.lastTurnDiag=G.empty,t.arrowVariant="",t.tailTip=new u.Command.Ar.Form.Tip.Tipchars(""),t.headTip=new u.Command.Ar.Form.Tip.Tipchars(">"),t.stemConn=new u.Command.Ar.Form.Conn.Connchars("-"),t.reverseAboveAndBelow=!1,t.arrowObjectModifiers=j.empty,this.forms.foreach((function(c){c.toShape(e)})),t.pathActionForBeforeSegment.isDefined||(t.pathActionForBeforeSegment=new G.Some(new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.ConnectObject(new u.Object(t.arrowObjectModifiers,t.stemConn.getObject(e))))),new u.Decor(j.empty)))),t.labelsForNextSegmentOnly=new G.Some(new u.Command.Path.Labels(j.empty.append(new u.Command.Path.Label.At(new u.Pos.Place(new u.Place(1,1,new u.Place.Factor(0),new u.Slide(G.empty))),t.tailTip.getObject(e),G.empty)))),t.labelsForLastSegmentOnly=new G.Some(new u.Command.Path.Labels(j.empty.append(new u.Command.Path.Label.At(new u.Pos.Place(new u.Place(1,1,new u.Place.Factor(1),new u.Slide(G.empty))),t.headTip.getObject(e),G.empty)))),this.path.toShape(e),t.c=s,t.p=a,t.origin=n,t.xBase=r,t.yBase=i}}),C(u.Command.Ar.Form.BuildArrow,{toShape:function(e){var t=e.env;t.arrowVariant=this.variant,t.tailTip=this.tailTip,t.stemConn=this.stemConn,t.headTip=this.headTip}}),C(u.Command.Ar.Form.ChangeVariant,{toShape:function(e){e.env.arrowVariant=this.variant}}),C(u.Command.Ar.Form.ChangeStem,{toShape:function(e){e.env.stemConn=new u.Command.Ar.Form.Conn.Connchars(this.connchar)}}),C(u.Command.Ar.Form.DashArrowStem,{toShape:function(e){}}),C(u.Command.Ar.Form.CurveArrow,{toShape:function(e){var t=e.env,n=o.measure.em2length(2*o.measure.length2em(this.dist));t.pathActionForBeforeSegment=new G.Some(new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.ConnectObject(new u.Object(t.arrowObjectModifiers,new u.ObjectBox.Curve(j.empty,j.empty.append(new u.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),j.empty.append(new u.ObjectBox.Curve.PosList.Pos(new u.Pos.Coord(new u.Coord.Group(new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.ConnectObject(new u.Object(j.empty,new u.ObjectBox.Dir("","")))).append(new u.Pos.Place(new u.Place(0,0,void 0,new u.Slide(G.empty)))).append(new u.Pos.Plus(new u.Coord.Vector(new u.Vector.Dir(this.direction,n))))),new u.Decor(j.empty))),j.empty)))))))),new u.Decor(j.empty)))}}),C(u.Command.Ar.Form.CurveFitToDirection,{toShape:function(e){var t=e.env;t.pathActionForBeforeSegment=new G.Some(new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.ConnectObject(new u.Object(t.arrowObjectModifiers,new u.ObjectBox.Curve(j.empty,j.empty.append(new u.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),j.empty.append(new u.ObjectBox.Curve.PosList.Pos(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.SwapPAndC(new u.Coord.C)).append(new u.Pos.Plus(new u.Coord.Vector(new u.Vector.Dir(this.outDirection,"3pc"))))))).append(new u.ObjectBox.Curve.PosList.Pos(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.SwapPAndC(new u.Coord.C)).append(new u.Pos.Plus(new u.Coord.Vector(new u.Vector.Dir(this.inDirection,"3pc")))))))))))),new u.Decor(j.empty)))}}),C(u.Command.Ar.Form.CurveWithControlPoints,{toShape:function(e){var t=e.env,n=t.duplicate();n.startCapturePositions();var r=new le(d.none,n);this.coord.position(r);var i=n.endCapturePositions();i=i.append(n.c);var a=j.empty;i.reverse().foreach((function(s){var c=t.inverseAbsVector(s.x,s.y);a=a.prepend(new u.ObjectBox.Curve.PosList.Pos(new u.Pos.Coord(new u.Coord.Vector(new u.Vector.InCurBase(c.x,c.y)),j.empty)))})),t.pathActionForBeforeSegment=new G.Some(new u.PosDecor(new u.Pos.Coord(new u.Coord.C,j.empty.append(new u.Pos.ConnectObject(new u.Object(t.arrowObjectModifiers,new u.ObjectBox.Curve(j.empty,j.empty.append(new u.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))),a))))),new u.Decor(j.empty)))}}),C(u.Command.Ar.Form.AddShape,{toShape:function(e){e.env.arrowObjectModifiers=j.empty.append(this.shape)}}),C(u.Command.Ar.Form.AddModifiers,{toShape:function(e){e.env.arrowObjectModifiers=this.modifiers}}),C(u.Command.Ar.Form.Slide,{toShape:function(e){e.env.segmentSlideEm=new G.Some(o.measure.length2em(this.slideDimen))}}),C(u.Command.Ar.Form.LabelAt,{toShape:function(e){e.env.labelsForEverySegment=new G.Some(new u.Command.Path.Labels(j.empty.append(new u.Command.Path.Label.At(new u.Pos.Place(this.anchor),this.it,G.empty))))}}),C(u.Command.Ar.Form.LabelAbove,{toShape:function(e){var t,n=e.env;t=n.reverseAboveAndBelow?new u.Command.Path.Label.Below(new u.Pos.Place(this.anchor),this.it,G.empty):new u.Command.Path.Label.Above(new u.Pos.Place(this.anchor),this.it,G.empty),n.labelsForEverySegment=new G.Some(new u.Command.Path.Labels(j.empty.append(t)))}}),C(u.Command.Ar.Form.LabelBelow,{toShape:function(e){var t,n=e.env;t=n.reverseAboveAndBelow?new u.Command.Path.Label.Above(new u.Pos.Place(this.anchor),this.it,G.empty):new u.Command.Path.Label.Below(new u.Pos.Place(this.anchor),this.it,G.empty),n.labelsForEverySegment=new G.Some(new u.Command.Path.Labels(j.empty.append(t)))}}),C(u.Command.Ar.Form.ReverseAboveAndBelow,{toShape:function(e){e.env.reverseAboveAndBelow=!0}}),C(u.Command.Ar.Form.Conn.Connchars,{getObject:function(e){var t=e.env,n=new u.ObjectBox.Dir(t.arrowVariant,this.connchars);return new u.Object(t.arrowObjectModifiers,n)}}),C(u.Command.Ar.Form.Conn.Object,{getObject:function(e){var t=e.env.arrowObjectModifiers.concat(this.object.modifiers);return new u.Object(t,this.object.object)}}),C(u.Command.Ar.Form.Conn.Dir,{getObject:function(e){var t=e.env,n=this.dir,r=n;return n.variant===""&&t.arrowVariant!==""&&(r=new u.ObjectBox.Dir(t.arrowVariant,n.main)),new u.Object(t.arrowObjectModifiers,r)}}),C(u.Command.Ar.Form.Tip.Tipchars,{getObject:function(e){var t=e.env,n=new u.ObjectBox.Dir(t.arrowVariant,this.tipchars);return new u.Object(t.arrowObjectModifiers,n)}}),C(u.Command.Ar.Form.Tip.Object,{getObject:function(e){var t=e.env.arrowObjectModifiers.concat(this.object.modifiers);return new u.Object(t,this.object.object)}}),C(u.Command.Ar.Form.Tip.Dir,{getObject:function(e){var t=e.env,n=this.dir,r=n;return n.variant===""&&t.arrowVariant!==""&&(r=new u.ObjectBox.Dir(t.arrowVariant,n.main)),new u.Object(t.arrowObjectModifiers,r)}}),C(u.Command.Path,{toShape:function(e){var t=e.env,n=t.origin,r=t.xBase,i=t.yBase,a=t.p,s=t.c;t.pathActionForBeforeSegment=G.empty,t.pathActionForAfterSegment=G.empty,t.labelsForNextSegmentOnly=G.empty,t.labelsForLastSegmentOnly=G.empty,t.labelsForEverySegment=G.empty,t.segmentSlideEm=G.empty,t.lastTurnDiag=G.empty,this.path.toShape(e),t.c=s,t.p=a,t.origin=n,t.xBase=r,t.yBase=i}}),C(u.Command.AfterPath,{toShape:function(e){this.path.toShape(e),this.decor.toShape(e)}}),C(u.Command.Path.Path,{toShape:function(e){this.pathElements.foreach((function(t){t.toShape(e)}))}}),C(u.Command.Path.SetBeforeAction,{toShape:function(e){e.env.pathActionForBeforeSegment=new G.Some(this.posDecor)}}),C(u.Command.Path.SetAfterAction,{toShape:function(e){e.env.pathActionForAfterSegment=new G.Some(this.posDecor)}}),C(u.Command.Path.AddLabelNextSegmentOnly,{toShape:function(e){e.env.labelsForNextSegmentOnly=new G.Some(this.labels)}}),C(u.Command.Path.AddLabelLastSegmentOnly,{toShape:function(e){e.env.labelsForLastSegmentOnly=new G.Some(this.labels)}}),C(u.Command.Path.AddLabelEverySegment,{toShape:function(e){e.env.labelsForEverySegment=new G.Some(this.labels)}}),C(u.Command.Path.StraightSegment,{toShape:function(e){var t=e.env;this.segment.setupPositions(e);var n=t.c;t.pathActionForBeforeSegment.foreach((function(r){r.toShape(e)})),t.labelsForNextSegmentOnly.foreach((function(r){r.toShape(e),t.labelsForNextSegmentOnly=G.empty})),t.labelsForEverySegment.foreach((function(r){r.toShape(e)})),t.c=n,t.pathActionForAfterSegment.foreach((function(r){r.toShape(e)})),this.segment.toLabelsShape(e)}}),C(u.Command.Path.LastSegment,{toShape:function(e){var t=e.env;this.segment.setupPositions(e);var n=t.c;t.pathActionForBeforeSegment.foreach((function(r){r.toShape(e)})),t.labelsForNextSegmentOnly.foreach((function(r){r.toShape(e),t.labelsForNextSegmentOnly=G.empty})),t.labelsForLastSegmentOnly.foreach((function(r){r.toShape(e),t.labelsForNextSegmentOnly=G.empty})),t.labelsForEverySegment.foreach((function(r){r.toShape(e)})),t.c=n,t.pathActionForAfterSegment.foreach((function(r){r.toShape(e)})),this.segment.toLabelsShape(e)}}),C(u.Command.Path.TurningSegment,{toShape:function(e){var t=e.env,n=t.c;this.segment.pos.toShape(e),t.p=n;var r=this.turn.explicitizedCircle(e),i=this.turn.radius.radius(e);t.lastTurnDiag=new G.Some(r.endDiag);var a=r.startVector(e),s=r.endVector(e),c=t.segmentSlideEm.getOrElse(0);this.segment.slide.dimen.foreach((function(A){c=o.measure.length2em(A),t.segmentSlideEm=new G.Some(c)})),c!==0&&(t.p=t.p.move(t.p.x-c*a.y,t.p.y+c*a.x),t.c=t.c.move(t.c.x-c*s.y,t.c.y+c*s.x),i=r.orient==="^"?Math.max(0,i-c):Math.max(0,i+c));var l,h=t.p.edgePoint(t.p.x+a.x,t.p.y+a.y),m=t.c,p=r.relativeStartPoint(e,i),f=r.relativeEndPoint(e,i),y=r.relativeEndPoint(e,i+(r.orient==="^"?c:-c)),x=a.x*s.y-a.y*s.x;if(Math.abs(x)<Be.machinePrecision)l=0;else{var w=m.x-h.x+p.x-f.x,b=m.y-h.y+p.y-f.y;(l=(s.y*w-s.x*b)/x)<0&&(l=0)}var P=h.x-p.x+l*a.x,M=h.y-p.y+l*a.y,B=(r.toDropShape(e,P,M,i),new O.Point(P+y.x,M+y.y));t.c=new O.Point(P+p.x,M+p.y),t.pathActionForBeforeSegment.foreach((function(A){A.toShape(e)})),t.labelsForNextSegmentOnly.foreach((function(A){A.toShape(e),t.labelsForNextSegmentOnly=G.empty})),t.labelsForEverySegment.foreach((function(A){A.toShape(e)})),t.c=B,t.pathActionForAfterSegment.foreach((function(A){A.toShape(e)})),this.segment.toLabelsShape(e)}}),C(u.Command.Path.Turn.Cir,{explicitizedCircle:function(e){var t,n,r,i=e.env;return t=this.cir.startDiag.isEmpty?i.lastTurnDiag.getOrElse(new u.Diag.R):this.cir.startDiag,n=this.cir.orient,r=this.cir.endDiag.isEmpty?t.turn(n):this.cir.endDiag,new u.ObjectBox.Cir.Cir.Segment(t,n,r)}}),C(u.ObjectBox.Cir.Cir.Segment,{startVector:function(e){var t=this.startDiag.angle(e);return{x:Math.cos(t),y:Math.sin(t)}},endVector:function(e){var t=this.endDiag.angle(e);return{x:Math.cos(t),y:Math.sin(t)}},relativeStartPointAngle:function(e){return this.startPointDegree(e)/180*Math.PI},relativeStartPoint:function(e,t){var n=this.startPointDegree(e)/180*Math.PI;return{x:t*Math.cos(n),y:t*Math.sin(n)}},relativeEndPoint:function(e,t){var n;return n=this.endPointDegree(e,this.relativeStartPointAngle(e))/180*Math.PI,{x:t*Math.cos(n),y:t*Math.sin(n)}}}),C(u.Command.Path.Turn.Diag,{explicitizedCircle:function(e){var t,n,r,i=e.env,a=(t=this.diag.isEmpty?i.lastTurnDiag.getOrElse(new u.Diag.R):this.diag).angle(e);return n=(i.c.x-i.p.x)*Math.sin(a)-(i.c.y-i.p.y)*Math.cos(a)<0?"^":"_",r=t.turn(n),new u.ObjectBox.Cir.Cir.Segment(t,n,r)}}),C(u.Command.Path.TurnRadius.Default,{radius:function(e){return o.measure.turnradius}}),C(u.Command.Path.TurnRadius.Dimen,{radius:function(e){return o.measure.length2em(this.dimen)}}),C(u.Command.Path.Segment,{setupPositions:function(e){var t=e.env;t.p=t.c,this.pos.toShape(e);var n=t.p,r=t.c,i=r.x-n.x,a=r.y-n.y,s=Math.atan2(a,i)+Math.PI/2,c=t.segmentSlideEm.getOrElse(0);this.slide.dimen.foreach((function(l){c=o.measure.length2em(l),t.segmentSlideEm=new G.Some(c)})),c!==0&&(n=n.move(n.x+c*Math.cos(s),n.y+c*Math.sin(s)),r=r.move(r.x+c*Math.cos(s),r.y+c*Math.sin(s))),t.p=n,t.c=r},toLabelsShape:function(e){var t=e.env,n=t.c,r=t.p;this.labels.toShape(e),t.c=n,t.p=r}}),C(u.Command.Path.Labels,{toShape:function(e){this.labels.foreach((function(t){t.toShape(e)}))}}),C(u.Command.Path.Label,{toShape:function(e){var t=e.env,n=t.p,r=t.c,i=this.anchor.toShape(e),a=this.getLabelMargin(e);if(a!==0){var s=(A=t.lastCurve).isNone?Math.atan2(r.y-n.y,r.x-n.x)+Math.PI/2:A.angle(i)+Math.PI/2+(a>0?0:Math.PI);r=t.c;var c=new le(d.none,t);this.it.toDropShape(c);var l=c.shape,h=l.getBoundingBox();if(h!==void 0){var m=h.x-r.x,p=h.y-r.y,f=h.l,y=h.r,x=h.u,w=h.d,b=Math.cos(s),P=Math.sin(s),M=Math.min((m-f)*b+(p-w)*P,(m-f)*b+(p+x)*P,(m+y)*b+(p-w)*P,(m+y)*b+(p+x)*P),B=Math.abs(a)-M;t.c=t.c.move(r.x+B*b,r.y+B*P),e.appendShapeToFront(new d.TranslateShape(B*b,B*P,l))}}else this.it.toDropShape(e);var A=t.lastCurve;this.shouldSliceHole&&A.isDefined&&i!==void 0&&A.sliceHole(t.c,i),this.aliasOption.foreach((function(R){t.savePos(R,new Ue.Position(t.c))}))}}),C(u.Command.Path.Label.Above,{getLabelMargin:function(e){return e.env.labelmargin},shouldSliceHole:!1}),C(u.Command.Path.Label.Below,{getLabelMargin:function(e){return-e.env.labelmargin},shouldSliceHole:!1}),C(u.Command.Path.Label.At,{getLabelMargin:function(e){return 0},shouldSliceHole:!0}),C(u.Command.Xymatrix,{toShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=t.duplicate(),r=new le(d.none,n);n.xymatrixPrefix="",n.xymatrixRowSepEm=o.measure.length2em("2pc"),n.xymatrixColSepEm=o.measure.length2em("2pc"),n.xymatrixPretendEntryHeight=G.empty,n.xymatrixPretendEntryWidth=G.empty,n.xymatrixFixedRow=!1,n.xymatrixFixedCol=!1,n.xymatrixOrientationAngle=0,n.xymatrixEntryModifiers=j.empty,this.setup.foreach((function($){$.toShape(r)}));var i,a,s=n.xymatrixOrientationAngle,c=0,l=0,h=new Ke(this.rows.map((function($){l+=1,a=0;var ue=new Ke.Row($.entries.map((function(me){a+=1;var ie=n.duplicate();ie.origin={x:0,y:0},ie.p=ie.c=be.originPosition,ie.angle=0,ie.lastCurve=ne.none,ie.xymatrixRow=l,ie.xymatrixCol=a;var he,ae,pe,ve,xe=new le(d.none,ie),ge=me.toShape(xe),Le=ie.c;if(n.xymatrixPretendEntryHeight.isDefined){var we=n.xymatrixPretendEntryHeight.get;pe=we/2,ve=we/2}else pe=Le.u,ve=Le.d;if(n.xymatrixPretendEntryWidth.isDefined){var Ce=n.xymatrixPretendEntryWidth.get;he=Ce/2,ae=Ce/2}else he=Le.l,ae=Le.r;var Re=new O.Rect(0,0,{l:he,r:ae,u:pe,d:ve});return new Ke.Entry(ie.c,ge,me.decor,Re)})),s);return c=Math.max(c,a),ue})),s);if((i=l)===0)return d.none;h.rows.foreach((function($){a=0,$.entries.foreach((function(ue){a+=1,h.getColumn(a).addEntry(ue)}))}));var m,p,f=n.xymatrixColSepEm,y=[],x=t.c.x;if(y.push(x),n.xymatrixFixedCol){var w=0,b=0;h.columns.foreach((function($){w=Math.max(w,$.getL()),b=Math.max(b,$.getR())})),h.columns.tail.foreach((function($){x=x+b+f+w,y.push(x)})),m=w,p=y[y.length-1]+b}else{var P=h.columns.head;h.columns.tail.foreach((function($){x=x+P.getR()+f+$.getL(),y.push(x),P=$})),m=h.columns.head.getL(),p=x+h.columns.at(c-1).getR()-y[0]}var M,B,A=n.xymatrixRowSepEm,R=[],U=t.c.y;if(R.push(U),n.xymatrixFixedRow){var T=0,L=0;h.rows.foreach((function($){T=Math.max(T,$.getU()),L=Math.max(L,$.getD())})),h.rows.tail.foreach((function($){U-=L+A+T,R.push(U)})),M=T,B=R[0]-R[R.length-1]+L}else{var X=h.rows.head;h.rows.tail.foreach((function($){U-=X.getD()+A+$.getU(),R.push(U),X=$})),M=h.rows.head.getU(),B=R[0]-U+h.rows.at(i-1).getD()}t.c=new O.Rect(t.c.x,t.c.y,{l:m,r:p,u:M,d:B});var q=n.xymatrixPrefix,J=Math.cos(s),Y=Math.sin(s),ee=0;h.rows.foreach((function($){var ue=0;$.entries.foreach((function(me){var ie=y[ue],he=R[ee],ae=ie*J-he*Y,pe=ie*Y+he*J,ve=ue+1,xe=ee+1,ge=new Ue.Position(me.c.move(ae,pe));n.savePos(xe+","+ve,ge),n.savePos(q+xe+","+ve,ge),ue+=1})),ee+=1})),r=new le(d.none,n),ee=0,h.rows.foreach((function($){var ue=0;$.entries.foreach((function(me){var ie=y[ue],he=R[ee],ae=ie*J-he*Y,pe=ie*Y+he*J,ve=ue+1,xe=ee+1,ge=new d.TranslateShape(ae,pe,me.objectShape);r.appendShapeToFront(ge),n.c=me.c.move(ae,pe),n.xymatrixRow=xe,n.xymatrixCol=ve,me.decor.toShape(r),ue+=1})),ee+=1}));var re=r.shape;return e.appendShapeToFront(re),t.savedPosition=n.savedPosition,re}});var Ke=(function(){function e(t,n){Mt(this,e),this.rows=t,this.columns=j.empty,this.orientation=n}return Pt(e,[{key:"getColumn",value:function(t){if(this.columns.length()>=t)return this.columns.at(t-1);var n=new e.Column(this.orientation);return this.columns=this.columns.append(n),n}},{key:"toString",value:function(){return`Xymatrix{
`+this.rows.mkString(`\\\\
`)+`
}`}}]),e})();function st(e,t,n){var r=[],i=[],a={lastNoSuccess:void 0,whiteSpaceRegex:Be.whiteSpaceRegex,createTextNode:function(p){var f=new dr.Z(p,e.stack.env,e.configuration).mml(),y=o.textObjectIdCounter;return o.textObjectIdCounter++,r.push(f),i.push(y),f}},s=new dt(e.string,e.i,a),c=se.parse(t,s);if(e.i=c.next.offset,c.successful){var l=""+o.xypicCommandIdCounter;o.xypicCommandIdCounter++,o.xypicCommandMap[l]=c.get();var h=JSON.stringify(i);return e.create(n,{"data-cmd-id":l,"data-text-mml-ids":h},r)}var m=a.lastNoSuccess.next.pos().lineContents();throw ye("SyntaxError",a.lastNoSuccess.msg+'. Parse error at or near "'+m+'".')}Ke.Row=(function(){function e(t,n){Mt(this,e),this.entries=t,this.orientation=n,F(this,"getU"),F(this,"getD")}return Pt(e,[{key:"getU",value:function(){var t=this.orientation,n=0;return this.entries.foreach((function(r){n=Math.max(n,r.getU(t))})),n}},{key:"getD",value:function(){var t=this.orientation,n=0;return this.entries.foreach((function(r){n=Math.max(n,r.getD(t))})),n}},{key:"toString",value:function(){return this.entries.mkString(" & ")}}]),e})(),Ke.Column=(function(){function e(t){Mt(this,e),this.entries=j.empty,this.orientation=t,F(this,"getL"),F(this,"getR")}return Pt(e,[{key:"addEntry",value:function(t){this.entries=this.entries.append(t),this.getL.reset,this.getR.reset}},{key:"getL",value:function(){var t=this.orientation,n=0;return this.entries.foreach((function(r){n=Math.max(n,r.getL(t))})),n}},{key:"getR",value:function(){var t=this.orientation,n=0;return this.entries.foreach((function(r){n=Math.max(n,r.getR(t))})),n}},{key:"toString",value:function(){return this.entries.mkString(" \\\\ ")}}]),e})(),Ke.Entry=(function(){function e(t,n,r,i){Mt(this,e),this.c=t,this.objectShape=n,this.decor=r,this.frame=i}return Pt(e,[{key:"getDistanceToEdgePoint",value:function(t,n){var r=t.edgePoint(t.x+Math.cos(n),t.y+Math.sin(n)),i=r.x-t.x,a=r.y-t.y;return Math.sqrt(i*i+a*a)}},{key:"getU",value:function(t){return t===0?this.frame.u:this.getDistanceToEdgePoint(this.frame,t+Math.PI/2)}},{key:"getD",value:function(t){return t===0?this.frame.d:this.getDistanceToEdgePoint(this.frame,t-Math.PI/2)}},{key:"getL",value:function(t){return t===0?this.frame.l:this.getDistanceToEdgePoint(this.frame,t+Math.PI)}},{key:"getR",value:function(t){return t===0?this.frame.r:this.getDistanceToEdgePoint(this.frame,t)}},{key:"toString",value:function(){return this.objectShape.toString()+" "+this.decor}}]),e})(),C(u.Command.Xymatrix.Setup.Prefix,{toShape:function(e){e.env.xymatrixPrefix=this.prefix}}),C(u.Command.Xymatrix.Setup.ChangeSpacing.Row,{toShape:function(e){var t=e.env;t.xymatrixRowSepEm=this.addop.applyToDimen(t.xymatrixRowSepEm,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.ChangeSpacing.Column,{toShape:function(e){var t=e.env;t.xymatrixColSepEm=this.addop.applyToDimen(t.xymatrixColSepEm,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn,{toShape:function(e){var t=e.env,n=this.addop.applyToDimen(t.xymatrixRowSepEm,o.measure.length2em(this.dimen));t.xymatrixRowSepEm=n,t.xymatrixColSepEm=n}}),C(u.Command.Xymatrix.Setup.PretendEntrySize.Height,{toShape:function(e){e.env.xymatrixPretendEntryHeight=new G.Some(o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.PretendEntrySize.Width,{toShape:function(e){e.env.xymatrixPretendEntryWidth=new G.Some(o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth,{toShape:function(e){var t=new G.Some(o.measure.length2em(this.dimen));e.env.xymatrixPretendEntryHeight=t,e.env.xymatrixPretendEntryWidth=t}}),C(u.Command.Xymatrix.Setup.FixGrid.Row,{toShape:function(e){e.env.xymatrixFixedRow=!0}}),C(u.Command.Xymatrix.Setup.FixGrid.Column,{toShape:function(e){e.env.xymatrixFixedCol=!0}}),C(u.Command.Xymatrix.Setup.FixGrid.RowAndColumn,{toShape:function(e){e.env.xymatrixFixedRow=!0,e.env.xymatrixFixedCol=!0}}),C(u.Command.Xymatrix.Setup.AdjustEntrySize.Margin,{toShape:function(e){var t=e.env;t.objectmargin=this.addop.applyToDimen(t.objectmargin,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.AdjustEntrySize.Width,{toShape:function(e){var t=e.env;t.objectwidth=this.addop.applyToDimen(t.objectwidth,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.AdjustEntrySize.Height,{toShape:function(e){var t=e.env;t.objectheight=this.addop.applyToDimen(t.objectheight,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.AdjustLabelSep,{toShape:function(e){var t=e.env;t.labelmargin=this.addop.applyToDimen(t.labelmargin,o.measure.length2em(this.dimen))}}),C(u.Command.Xymatrix.Setup.SetOrientation,{toShape:function(e){e.env.xymatrixOrientationAngle=this.direction.angle(e)}}),C(u.Command.Xymatrix.Setup.AddModifier,{toShape:function(e){var t=e.env;t.xymatrixEntryModifiers=t.xymatrixEntryModifiers.prepend(this.modifier)}}),C(u.Command.Xymatrix.Entry.SimpleEntry,{toShape:function(e){var t=e.env,n=o.measure.em2length(t.objectmargin+t.objectwidth),r=o.measure.em2length(t.objectmargin+t.objectheight),i=new u.Modifier.AddOp(new u.Modifier.AddOp.GrowTo,new u.Modifier.AddOp.VactorSize(new u.Vector.Abs(n,r))),a=o.measure.em2length(t.objectmargin),s=new u.Modifier.AddOp(new u.Modifier.AddOp.Grow,new u.Modifier.AddOp.VactorSize(new u.Vector.Abs(a,a))),c=this.modifiers.concat(t.xymatrixEntryModifiers).prepend(i).prepend(s);return new u.Object(c,this.objectbox).toDropShape(e)}}),C(u.Command.Xymatrix.Entry.EmptyEntry,{toShape:function(e){var t=e.env,n=o.measure.em2length(t.objectmargin+t.objectwidth),r=o.measure.em2length(t.objectmargin+t.objectheight),i=new u.Modifier.AddOp(new u.Modifier.AddOp.GrowTo,new u.Modifier.AddOp.VactorSize(new u.Vector.Abs(n,r))),a=o.measure.em2length(t.objectmargin),s=new u.Modifier.AddOp(new u.Modifier.AddOp.Grow,new u.Modifier.AddOp.VactorSize(new u.Vector.Abs(a,a))),c=t.xymatrixEntryModifiers.prepend(i).prepend(s);return new u.Object(c,new u.ObjectBox.Empty).toDropShape(e)}}),C(u.Command.Xymatrix.Entry.ObjectEntry,{toShape:function(e){return this.object.toDropShape(e)}}),C(u.Command.Twocell,{toShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=t.duplicate(),r=new le(d.none,n);n.twocellmodmapobject=t.twocellmodmapobject||new u.Object(j.empty,new u.ObjectBox.Dir("","|")),n.twocellhead=t.twocellhead||new u.Object(j.empty,new u.ObjectBox.Dir("",">")),n.twocelltail=t.twocelltail||new u.Object(j.empty,new u.ObjectBox.Dir("","")),n.twocellarrowobject=t.twocellarrowobject||new u.Object(j.empty,new u.ObjectBox.Dir("","=>")),n.twocellUpperCurveObjectSpacer=t.twocellUpperCurveObjectSpacer,n.twocellUpperCurveObject=t.twocellUpperCurveObject,n.twocellLowerCurveObjectSpacer=t.twocellLowerCurveObjectSpacer,n.twocellLowerCurveObject=t.twocellLowerCurveObject,n.twocellUpperLabel=G.empty,n.twocellLowerLabel=G.empty,n.twocellCurvatureEm=G.empty,n.twocellShouldDrawCurve=!0,n.twocellShouldDrawModMap=!1,this.switches.foreach((function(i){i.setup(r)})),this.twocell.toShape(r,this.arrow),e.appendShapeToFront(r.shape)}}),C(u.Command.Twocell.Hops2cell,{toShape:function(e,t){var n=e.env,r=n.c,i=n.angle,a=n.c,s=this.targetPosition(e);if(a!==void 0&&s!==void 0){var c=s.x-a.x,l=s.y-a.y;if(c!==0||l!==0){var h=new O.Point(a.x+.5*c,a.y+.5*l),m=Math.atan2(l,c),p=m+Math.PI/2,f=n.twocellCurvatureEm.getOrElse(this.getDefaultCurvature()),y=Math.cos(p),x=Math.sin(p),w=this.getUpperControlPoint(a,s,h,f,y,x),b=this.getLowerControlPoint(a,s,h,f,y,x);if(n.twocellShouldDrawCurve){var P,M;if(M=(P=n.twocellUpperCurveObjectSpacer)===void 0?new u.Object(j.empty,new u.ObjectBox.Dir("","-")):n.twocellUpperCurveObject===void 0?void 0:n.twocellUpperCurveObject.getOrElse(void 0),this.toUpperCurveShape(e,a,w,s,P,M),n.lastCurve.isDefined){n.angle=m;var B=this.getUpperLabelPosition(a,s,h,f,y,x),A=this.getUpperLabelAngle(p,a,s,h,f,y,x);n.twocellUpperLabel.foreach((function(L){L.toShape(e,B,Math.cos(A),Math.sin(A),m)})),this.hasUpperTips&&t.toUpperTipsShape(e)}if(M=(P=n.twocellLowerCurveObjectSpacer)===void 0?new u.Object(j.empty,new u.ObjectBox.Dir("","-")):n.twocellLowerCurveObject===void 0?void 0:n.twocellLowerCurveObject.getOrElse(void 0),this.toLowerCurveShape(e,a,b,s,P,M),n.lastCurve.isDefined){n.angle=m;var R=this.getLowerLabelPosition(a,s,h,f,y,x),U=this.getLowerLabelAngle(p,a,s,h,f,y,x);n.twocellLowerLabel.foreach((function(L){L.toShape(e,R,Math.cos(U),Math.sin(U),m)})),this.hasLowerTips&&t.toLowerTipsShape(e)}}n.c=this.getDefaultArrowPoint(a,s,h,f,y,x),n.angle=p+Math.PI;var T=h;t.toArrowShape(e,T),n.c=r,n.angle=i}}},_toCurveShape:function(e,t,n,r,i,a){var s=e.env,c=new K.QuadBezier(t,n,r),l=c.tOfShavedStart(t),h=c.tOfShavedEnd(r);if(l===void 0||h===void 0||l>=h)s.lastCurve=ne.none;else{var m=c.toShape(e,i,a);s.lastCurve=new ne.QuadBezier(c,l,h,m)}},targetPosition:function(e){var t=e.env,n=t.xymatrixRow,r=t.xymatrixCol;if(n===void 0||r===void 0)throw ye("ExecutionError","rows and columns not found for hops ["+this.hops+"]");for(var i=0;i<this.hops.length;i++)switch(this.hops[i]){case"u":--n;break;case"d":n+=1;break;case"l":--r;break;case"r":r+=1}var a=n+","+r;return e.env.lookupPos(a,'in entry "'+t.xymatrixRow+","+t.xymatrixCol+'": No '+this+" (is "+a+") from here.").position(e)}}),C(u.Command.Twocell.Twocell,{getUpperControlPoint:function(e,t,n,r,i,a){return new O.Point(n.x+r*i,n.y+r*a)},getLowerControlPoint:function(e,t,n,r,i,a){return new O.Point(n.x-r*i,n.y-r*a)},getUpperLabelPosition:function(e,t,n,r,i,a){return new O.Point(n.x+.5*r*i,n.y+.5*r*a)},getLowerLabelPosition:function(e,t,n,r,i,a){return new O.Point(n.x-.5*r*i,n.y-.5*r*a)},getUpperLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?Math.PI:0)},getLowerLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?0:Math.PI)},getDefaultArrowPoint:function(e,t,n,r,i,a){return n},toUpperCurveShape:function(e,t,n,r,i,a){this._toCurveShape(e,t,n,r,i,a)},toLowerCurveShape:function(e,t,n,r,i,a){this._toCurveShape(e,t,n,r,i,a)},getDefaultCurvature:function(){return 3.5*o.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),C(u.Command.Twocell.UpperTwocell,{getUpperControlPoint:function(e,t,n,r,i,a){return new O.Point(n.x+r*i,n.y+r*a)},getLowerControlPoint:function(e,t,n,r,i,a){return n},getUpperLabelPosition:function(e,t,n,r,i,a){return new O.Point(n.x+.5*r*i,n.y+.5*r*a)},getLowerLabelPosition:function(e,t,n,r,i,a){return n},getUpperLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?Math.PI:0)},getLowerLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?0:Math.PI)},getDefaultArrowPoint:function(e,t,n,r,i,a){return new O.Point(n.x+.25*r*i,n.y+.25*r*a)},toUpperCurveShape:function(e,t,n,r,i,a){this._toCurveShape(e,t,n,r,i,a)},toLowerCurveShape:function(e,t,n,r,i,a){var s=t.edgePoint(r.x,r.y),c=r.edgePoint(t.x,t.y);s.x!==c.x||s.y!==c.y?e.env.lastCurve=new ne.Line(s,c,t,r,void 0):e.env.lastCurve=ne.none},getDefaultCurvature:function(){return 7*o.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!1}),C(u.Command.Twocell.LowerTwocell,{getUpperControlPoint:function(e,t,n,r,i,a){return n},getLowerControlPoint:function(e,t,n,r,i,a){return new O.Point(n.x+r*i,n.y+r*a)},getUpperLabelPosition:function(e,t,n,r,i,a){return n},getLowerLabelPosition:function(e,t,n,r,i,a){return new O.Point(n.x+.5*r*i,n.y+.5*r*a)},getUpperLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?0:Math.PI)},getLowerLabelAngle:function(e,t,n,r,i,a,s){return e+(i<0?Math.PI:0)},getDefaultArrowPoint:function(e,t,n,r,i,a){return new O.Point(n.x+.25*r*i,n.y+.25*r*a)},toUpperCurveShape:function(e,t,n,r,i,a){var s=t.edgePoint(r.x,r.y),c=r.edgePoint(t.x,t.y);s.x!==c.x||s.y!==c.y?e.env.lastCurve=new ne.Line(s,c,t,r,void 0):e.env.lastCurve=ne.none},toLowerCurveShape:function(e,t,n,r,i,a){this._toCurveShape(e,t,n,r,i,a)},getDefaultCurvature:function(){return-7*o.measure.lineElementLength},hasUpperTips:!1,hasLowerTips:!0}),C(u.Command.Twocell.CompositeMap,{getUpperControlPoint:function(e,t,n,r,i,a){var s=this.getMidBoxSize();return new O.Ellipse(n.x+r*i,n.y+r*a,s,s,s,s)},getLowerControlPoint:function(e,t,n,r,i,a){var s=this.getMidBoxSize();return new O.Ellipse(n.x+r*i,n.y+r*a,s,s,s,s)},getUpperLabelPosition:function(e,t,n,r,i,a){var s=n.x+r*i-t.x,c=n.y+r*a-t.y;return new O.Point(t.x+.5*s,t.y+.5*c)},getLowerLabelPosition:function(e,t,n,r,i,a){var s=n.x+r*i-e.x,c=n.y+r*a-e.y;return new O.Point(e.x+.5*s,e.y+.5*c)},getUpperLabelAngle:function(e,t,n,r,i,a,s){var c=n.x-r.x+i*a,l=n.y-r.y+i*s,h=Math.atan2(l,c),m=i<0?Math.PI:0;return h+Math.PI/2+m},getLowerLabelAngle:function(e,t,n,r,i,a,s){var c=r.x+i*a-t.x,l=r.y+i*s-t.y,h=Math.atan2(l,c),m=i<0?Math.PI:0;return h+Math.PI/2+m},getDefaultArrowPoint:function(e,t,n,r,i,a){return n},toUpperCurveShape:function(e,t,n,r,i,a){var s=e.env,c=t,l=n,h=c.edgePoint(l.x,l.y),m=l.edgePoint(c.x,c.y),p=s.p,f=s.c;s.p=c,s.c=l,new K.Line(h,m).toShape(e,void 0,"-",""),s.p=p,s.c=f},toLowerCurveShape:function(e,t,n,r,i,a){var s=e.env,c=n,l=r,h=c.edgePoint(l.x,l.y),m=l.edgePoint(c.x,c.y),p=s.p,f=s.c;s.p=c,s.c=l,new K.Line(h,m).toShape(e,void 0,"-",""),s.p=p,s.c=f},getMidBoxSize:function(){return .5*o.measure.lineElementLength},getDefaultCurvature:function(){return 3.5*o.measure.lineElementLength},hasUpperTips:!0,hasLowerTips:!0}),C(u.Command.Twocell.Switch.UpperLabel,{setup:function(e){e.env.twocellUpperLabel=new G.Some(this)},toShape:function(e,t,n,r,i){this.label.toShape(e,t,n,r,i)}}),C(u.Command.Twocell.Switch.LowerLabel,{setup:function(e){e.env.twocellLowerLabel=new G.Some(this)},toShape:function(e,t,n,r,i){this.label.toShape(e,t,n,r,i)}}),C(u.Command.Twocell.Switch.SetCurvature,{setup:function(e){var t=e.env;this.nudge.isOmit?t.twocellShouldDrawCurve=!1:t.twocellCurvatureEm=new G.Some(this.nudge.number*o.measure.lineElementLength)}}),C(u.Command.Twocell.Switch.DoNotSetCurvedArrows,{setup:function(e){e.env.twocellShouldDrawCurve=!1}}),C(u.Command.Twocell.Switch.PlaceModMapObject,{setup:function(e){e.env.twocellShouldDrawModMap=!0}}),C(u.Command.Twocell.Switch.ChangeHeadTailObject,{setup:function(e){var t=e.env;switch(this.what){case"`":t.twocelltail=this.object;break;case"'":t.twocellhead=this.object}}}),C(u.Command.Twocell.Switch.ChangeCurveObject,{setup:function(e){var t=e.env;switch(this.what){case"":t.twocellUpperCurveObjectSpacer=this.spacer,t.twocellUpperCurveObject=this.maybeObject,t.twocellLowerCurveObjectSpacer=this.spacer,t.twocellLowerCurveObject=this.maybeObject;break;case"^":t.twocellUpperCurveObjectSpacer=this.spacer,t.twocellUpperCurveObject=this.maybeObject;break;case"_":t.twocellLowerCurveObjectSpacer=this.spacer,t.twocellLowerCurveObject=this.maybeObject}}}),C(u.Command.Twocell.Label,{toShape:function(e,t,n,r,i){var a,s=this.maybeNudge;if(s.isDefined){var c=s.get;if(c.isOmit)return;a=c.number*o.measure.lineElementLength}else a=this.getDefaultLabelOffset();var l=e.env,h=l.c;l.c=new O.Point(t.x+a*n,t.y+a*r),this.labelObject.toDropShape(e),l.c=h},getDefaultLabelOffset:function(){return o.measure.lineElementLength}}),C(u.Command.Twocell.Nudge.Number,{isOmit:!1}),C(u.Command.Twocell.Nudge.Omit,{isOmit:!0}),C(u.Command.Twocell.Arrow,{toTipsShape:function(e,t,n){var r=e.env,i=r.lastCurve,a=r.c,s=r.angle,c=t?Math.PI:0,l=i.tOfPlace(!0,!0,t?0:1,0);r.c=i.position(l),r.angle=i.angle(l)+c,r.twocellhead.toDropShape(e),l=i.tOfPlace(!0,!0,t?1:0,0),r.c=i.position(l),r.angle=i.angle(l)+c,n?r.twocellhead.toDropShape(e):r.twocelltail.toDropShape(e),r.twocellShouldDrawModMap&&(l=i.tOfPlace(!1,!1,.5,0),r.c=i.position(l),r.angle=i.angle(l)+c,r.twocellmodmapobject.toDropShape(e)),r.c=a,r.angle=s}}),C(u.Command.Twocell.Arrow.WithOrientation,{toUpperTipsShape:function(e){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"'":this.toTipsShape(e,!1,!1);break;case"`":this.toTipsShape(e,!0,!1);break;case'"':this.toTipsShape(e,!1,!0)}},toLowerTipsShape:function(e){switch(this.tok){case"":case"^":case"_":case"=":case"\\omit":case"`":this.toTipsShape(e,!1,!1);break;case"'":this.toTipsShape(e,!0,!1);break;case'"':this.toTipsShape(e,!1,!0)}},toArrowShape:function(e,t){var n=e.env,r=n.c;switch(this.tok){case"^":var i=n.angle;n.angle=i+Math.PI,n.twocellarrowobject.toDropShape(e),n.c=new O.Point(r.x+o.measure.lineElementLength*Math.cos(i-Math.PI/2),r.y+o.measure.lineElementLength*Math.sin(i-Math.PI/2)),this.labelObject.toDropShape(e),n.angle=i;break;case"":case"_":i=n.angle,n.twocellarrowobject.toDropShape(e),n.c=new O.Point(r.x+o.measure.lineElementLength*Math.cos(i+Math.PI/2),r.y+o.measure.lineElementLength*Math.sin(i+Math.PI/2)),this.labelObject.toDropShape(e);break;case"=":i=n.angle;var a=new d.TwocellEqualityArrowheadShape(n.c,n.angle);e.appendShapeToFront(a),n.c=new O.Point(r.x+o.measure.lineElementLength*Math.cos(i+Math.PI/2),r.y+o.measure.lineElementLength*Math.sin(i+Math.PI/2)),this.labelObject.toDropShape(e);break;default:this.labelObject.toDropShape(e)}n.c=r}}),C(u.Command.Twocell.Arrow.WithPosition,{toUpperTipsShape:function(e){this.toTipsShape(e,!1,!1)},toLowerTipsShape:function(e){this.toTipsShape(e,!1,!1)},toArrowShape:function(e,t){var n,r=e.env,i=r.c,a=r.angle,s=this.nudge;if(s.isOmit)n=i;else{var c=s.number*o.measure.lineElementLength;n=new O.Point(t.x+c*Math.cos(a),t.y+c*Math.sin(a))}r.c=n,r.twocellarrowobject.toDropShape(e),s.isOmit||(r.c=new O.Point(n.x+o.measure.lineElementLength*Math.cos(a+Math.PI/2),n.y+o.measure.lineElementLength*Math.sin(a+Math.PI/2)),this.labelObject.toDropShape(e)),r.c=i}}),C(u.Pos.Xyimport.TeXCommand,{toShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=t.duplicate(),r=new le(d.none,n),i=this.graphics.toDropShape(r),a=this.width,s=this.height;if(a===0||s===0)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var c=n.c,l=c.l+c.r,h=c.u+c.d;if(l===0||h===0)throw ye("ExecutionError","the width and height of the graphics to import should be non-zero.");var m=this.xOffset,p=this.yOffset;t.c=c.toRect({u:h/s*(s-p),d:h/s*p,l:l/a*m,r:l/a*(a-m)}),t.setXBase(l/a,0),t.setYBase(0,h/s);var f=c.l-t.c.l,y=c.d-t.c.d;i=new d.TranslateShape(f,y,r.shape),e.appendShapeToFront(i)}}),C(u.Pos.Xyimport.Graphics,{toShape:function(e){var t=e.env;if(t.c===void 0)return d.none;var n=t.duplicate(),r=new le(d.none,n),i=this.width,a=this.height;if(i===0||a===0)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\xyimport should be non-zero.");var s=this.graphics;if(s.setup(r),!n.includegraphicsWidth.isDefined||!n.includegraphicsHeight.isDefined)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");var c=n.includegraphicsWidth.get,l=n.includegraphicsHeight.get;if(c===0||l===0)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics should be non-zero.");var h=this.xOffset,m=this.yOffset;t.c=n.c.toRect({u:l/a*(a-m),d:l/a*m,l:c/i*h,r:c/i*(i-h)}),t.setXBase(c/i,0),t.setYBase(0,l/a);var p=new d.ImageShape(t.c,s.filepath);e.appendShapeToFront(p)}}),C(u.Command.Includegraphics,{setup:function(e){var t=e.env;t.includegraphicsWidth=G.empty,t.includegraphicsHeight=G.empty,this.attributeList.foreach((function(n){n.setup(e)}))}}),C(u.Command.Includegraphics.Attr.Width,{setup:function(e){e.env.includegraphicsWidth=new G.Some(o.measure.length2em(this.dimen))}}),C(u.Command.Includegraphics.Attr.Height,{setup:function(e){e.env.includegraphicsHeight=new G.Some(o.measure.length2em(this.dimen))}});var Xe={};Xe.Macro=pr.Z.Macro,Xe.xybox=function(e,t,n){var r=st(e,at.xybox(),u.xypic.prototype.kind);e.Push(r)},Xe.xymatrixbox=function(e,t,n){var r=st(e,at.xymatrixbox(),u.xypic.prototype.kind);e.Push(r)},Xe.newdir=function(e,t,n){var r=st(e,at.newdir(),u.xypic.newdir.prototype.kind);e.Push(r)},Xe.xyincludegraphics=function(e,t,n){var r=st(e,at.includegraphics(),u.xypic.includegraphics.prototype.kind);e.Push(r)},Xe.xyEnvironment=function(e,t){var n=st(e,at.xy(),u.xypic.prototype.kind);return e.Push(t),n},new Qe.QQ("xypic-command",{hole:["Macro","{\\style{visibility:hidden}{x}}"],objectstyle:["Macro","\\textstyle"],labelstyle:["Macro","\\scriptstyle"],twocellstyle:["Macro","\\scriptstyle"],xybox:["xybox","xybox"],xymatrix:["xymatrixbox","xymatrix"],newdir:["newdir","newdir"],includegraphics:["xyincludegraphics","includegraphics"]},Xe),new Qe.QM("xypic-environment",fr.Z.environment,{xy:["xyEnvironment",null,!1]},Xe),te.VK.create("xypic",{handler:{macro:["xypic-command"],environment:["xypic-environment"]},preprocessors:[function(e){e.math,e.document,e.data,o.xypicCommandIdCounter=0,o.xypicCommandMap={},o.textObjectIdCounter=0,o.wrapperOfTextObjectMap={}}],nodes:{xypic:function(e,t,n){var r=e.mmlFactory;return new u.xypic(r,t,n)},"xypic-newdir":function(e,t,n){var r=e.mmlFactory;return new u.xypic.newdir(r,t,n)},"xypic-includegraphics":function(e,t,n){var r=e.mmlFactory;return new u.xypic.includegraphics(r,t,n)}}}),Hn.embeddedModifierMap={o:new u.Modifier.Shape.Circle,l:new u.Modifier.Shape.L,r:new u.Modifier.Shape.R,u:new u.Modifier.Shape.U,d:new u.Modifier.Shape.D,c:new u.Modifier.Shape.C,aliceblue:new u.Modifier.Shape.ChangeColor("aliceblue"),antiquewhite:new u.Modifier.Shape.ChangeColor("antiquewhite"),aqua:new u.Modifier.Shape.ChangeColor("aqua"),aquamarine:new u.Modifier.Shape.ChangeColor("aquamarine"),azure:new u.Modifier.Shape.ChangeColor("azure"),beige:new u.Modifier.Shape.ChangeColor("beige"),bisque:new u.Modifier.Shape.ChangeColor("bisque"),black:new u.Modifier.Shape.ChangeColor("black"),blanchedalmond:new u.Modifier.Shape.ChangeColor("blanchedalmond"),blue:new u.Modifier.Shape.ChangeColor("blue"),blueviolet:new u.Modifier.Shape.ChangeColor("blueviolet"),brown:new u.Modifier.Shape.ChangeColor("brown"),burlywood:new u.Modifier.Shape.ChangeColor("burlywood"),cadetblue:new u.Modifier.Shape.ChangeColor("cadetblue"),chartreuse:new u.Modifier.Shape.ChangeColor("chartreuse"),chocolate:new u.Modifier.Shape.ChangeColor("chocolate"),coral:new u.Modifier.Shape.ChangeColor("coral"),cornflowerblue:new u.Modifier.Shape.ChangeColor("cornflowerblue"),cornsilk:new u.Modifier.Shape.ChangeColor("cornsilk"),crimson:new u.Modifier.Shape.ChangeColor("crimson"),cyan:new u.Modifier.Shape.ChangeColor("cyan"),darkblue:new u.Modifier.Shape.ChangeColor("darkblue"),darkcyan:new u.Modifier.Shape.ChangeColor("darkcyan"),darkgoldenrod:new u.Modifier.Shape.ChangeColor("darkgoldenrod"),darkgray:new u.Modifier.Shape.ChangeColor("darkgray"),darkgreen:new u.Modifier.Shape.ChangeColor("darkgreen"),darkgrey:new u.Modifier.Shape.ChangeColor("darkgrey"),darkkhaki:new u.Modifier.Shape.ChangeColor("darkkhaki"),darkmagenta:new u.Modifier.Shape.ChangeColor("darkmagenta"),darkolivegreen:new u.Modifier.Shape.ChangeColor("darkolivegreen"),darkorange:new u.Modifier.Shape.ChangeColor("darkorange"),darkorchid:new u.Modifier.Shape.ChangeColor("darkorchid"),darkred:new u.Modifier.Shape.ChangeColor("darkred"),darksalmon:new u.Modifier.Shape.ChangeColor("darksalmon"),darkseagreen:new u.Modifier.Shape.ChangeColor("darkseagreen"),darkslateblue:new u.Modifier.Shape.ChangeColor("darkslateblue"),darkslategray:new u.Modifier.Shape.ChangeColor("darkslategray"),darkslategrey:new u.Modifier.Shape.ChangeColor("darkslategrey"),darkturquoise:new u.Modifier.Shape.ChangeColor("darkturquoise"),darkviolet:new u.Modifier.Shape.ChangeColor("darkviolet"),deeppink:new u.Modifier.Shape.ChangeColor("deeppink"),deepskyblue:new u.Modifier.Shape.ChangeColor("deepskyblue"),dimgray:new u.Modifier.Shape.ChangeColor("dimgray"),dimgrey:new u.Modifier.Shape.ChangeColor("dimgrey"),dodgerblue:new u.Modifier.Shape.ChangeColor("dodgerblue"),firebrick:new u.Modifier.Shape.ChangeColor("firebrick"),floralwhite:new u.Modifier.Shape.ChangeColor("floralwhite"),forestgreen:new u.Modifier.Shape.ChangeColor("forestgreen"),fuchsia:new u.Modifier.Shape.ChangeColor("fuchsia"),gainsboro:new u.Modifier.Shape.ChangeColor("gainsboro"),ghostwhite:new u.Modifier.Shape.ChangeColor("ghostwhite"),gold:new u.Modifier.Shape.ChangeColor("gold"),goldenrod:new u.Modifier.Shape.ChangeColor("goldenrod"),gray:new u.Modifier.Shape.ChangeColor("gray"),grey:new u.Modifier.Shape.ChangeColor("grey"),green:new u.Modifier.Shape.ChangeColor("green"),greenyellow:new u.Modifier.Shape.ChangeColor("greenyellow"),honeydew:new u.Modifier.Shape.ChangeColor("honeydew"),hotpink:new u.Modifier.Shape.ChangeColor("hotpink"),indianred:new u.Modifier.Shape.ChangeColor("indianred"),indigo:new u.Modifier.Shape.ChangeColor("indigo"),ivory:new u.Modifier.Shape.ChangeColor("ivory"),khaki:new u.Modifier.Shape.ChangeColor("khaki"),lavender:new u.Modifier.Shape.ChangeColor("lavender"),lavenderblush:new u.Modifier.Shape.ChangeColor("lavenderblush"),lawngreen:new u.Modifier.Shape.ChangeColor("lawngreen"),lemonchiffon:new u.Modifier.Shape.ChangeColor("lemonchiffon"),lightblue:new u.Modifier.Shape.ChangeColor("lightblue"),lightcoral:new u.Modifier.Shape.ChangeColor("lightcoral"),lightcyan:new u.Modifier.Shape.ChangeColor("lightcyan"),lightgoldenrodyellow:new u.Modifier.Shape.ChangeColor("lightgoldenrodyellow"),lightgray:new u.Modifier.Shape.ChangeColor("lightgray"),lightgreen:new u.Modifier.Shape.ChangeColor("lightgreen"),lightgrey:new u.Modifier.Shape.ChangeColor("lightgrey"),lightpink:new u.Modifier.Shape.ChangeColor("lightpink"),lightsalmon:new u.Modifier.Shape.ChangeColor("lightsalmon"),lightseagreen:new u.Modifier.Shape.ChangeColor("lightseagreen"),lightskyblue:new u.Modifier.Shape.ChangeColor("lightskyblue"),lightslategray:new u.Modifier.Shape.ChangeColor("lightslategray"),lightslategrey:new u.Modifier.Shape.ChangeColor("lightslategrey"),lightsteelblue:new u.Modifier.Shape.ChangeColor("lightsteelblue"),lightyellow:new u.Modifier.Shape.ChangeColor("lightyellow"),lime:new u.Modifier.Shape.ChangeColor("lime"),limegreen:new u.Modifier.Shape.ChangeColor("limegreen"),linen:new u.Modifier.Shape.ChangeColor("linen"),magenta:new u.Modifier.Shape.ChangeColor("magenta"),maroon:new u.Modifier.Shape.ChangeColor("maroon"),mediumaquamarine:new u.Modifier.Shape.ChangeColor("mediumaquamarine"),mediumblue:new u.Modifier.Shape.ChangeColor("mediumblue"),mediumorchid:new u.Modifier.Shape.ChangeColor("mediumorchid"),mediumpurple:new u.Modifier.Shape.ChangeColor("mediumpurple"),mediumseagreen:new u.Modifier.Shape.ChangeColor("mediumseagreen"),mediumslateblue:new u.Modifier.Shape.ChangeColor("mediumslateblue"),mediumspringgreen:new u.Modifier.Shape.ChangeColor("mediumspringgreen"),mediumturquoise:new u.Modifier.Shape.ChangeColor("mediumturquoise"),mediumvioletred:new u.Modifier.Shape.ChangeColor("mediumvioletred"),midnightblue:new u.Modifier.Shape.ChangeColor("midnightblue"),mintcream:new u.Modifier.Shape.ChangeColor("mintcream"),mistyrose:new u.Modifier.Shape.ChangeColor("mistyrose"),moccasin:new u.Modifier.Shape.ChangeColor("moccasin"),navajowhite:new u.Modifier.Shape.ChangeColor("navajowhite"),navy:new u.Modifier.Shape.ChangeColor("navy"),oldlace:new u.Modifier.Shape.ChangeColor("oldlace"),olive:new u.Modifier.Shape.ChangeColor("olive"),olivedrab:new u.Modifier.Shape.ChangeColor("olivedrab"),orange:new u.Modifier.Shape.ChangeColor("orange"),orangered:new u.Modifier.Shape.ChangeColor("orangered"),orchid:new u.Modifier.Shape.ChangeColor("orchid"),palegoldenrod:new u.Modifier.Shape.ChangeColor("palegoldenrod"),palegreen:new u.Modifier.Shape.ChangeColor("palegreen"),paleturquoise:new u.Modifier.Shape.ChangeColor("paleturquoise"),palevioletred:new u.Modifier.Shape.ChangeColor("palevioletred"),papayawhip:new u.Modifier.Shape.ChangeColor("papayawhip"),peachpuff:new u.Modifier.Shape.ChangeColor("peachpuff"),peru:new u.Modifier.Shape.ChangeColor("peru"),pink:new u.Modifier.Shape.ChangeColor("pink"),plum:new u.Modifier.Shape.ChangeColor("plum"),powderblue:new u.Modifier.Shape.ChangeColor("powderblue"),purple:new u.Modifier.Shape.ChangeColor("purple"),red:new u.Modifier.Shape.ChangeColor("red"),rosybrown:new u.Modifier.Shape.ChangeColor("rosybrown"),royalblue:new u.Modifier.Shape.ChangeColor("royalblue"),saddlebrown:new u.Modifier.Shape.ChangeColor("saddlebrown"),salmon:new u.Modifier.Shape.ChangeColor("salmon"),sandybrown:new u.Modifier.Shape.ChangeColor("sandybrown"),seagreen:new u.Modifier.Shape.ChangeColor("seagreen"),seashell:new u.Modifier.Shape.ChangeColor("seashell"),sienna:new u.Modifier.Shape.ChangeColor("sienna"),silver:new u.Modifier.Shape.ChangeColor("silver"),skyblue:new u.Modifier.Shape.ChangeColor("skyblue"),slateblue:new u.Modifier.Shape.ChangeColor("slateblue"),slategray:new u.Modifier.Shape.ChangeColor("slategray"),slategrey:new u.Modifier.Shape.ChangeColor("slategrey"),snow:new u.Modifier.Shape.ChangeColor("snow"),springgreen:new u.Modifier.Shape.ChangeColor("springgreen"),steelblue:new u.Modifier.Shape.ChangeColor("steelblue"),tan:new u.Modifier.Shape.ChangeColor("tan"),teal:new u.Modifier.Shape.ChangeColor("teal"),thistle:new u.Modifier.Shape.ChangeColor("thistle"),tomato:new u.Modifier.Shape.ChangeColor("tomato"),turquoise:new u.Modifier.Shape.ChangeColor("turquoise"),violet:new u.Modifier.Shape.ChangeColor("violet"),wheat:new u.Modifier.Shape.ChangeColor("wheat"),white:new u.Modifier.Shape.ChangeColor("white"),whitesmoke:new u.Modifier.Shape.ChangeColor("whitesmoke"),yellow:new u.Modifier.Shape.ChangeColor("yellow"),yellowgreen:new u.Modifier.Shape.ChangeColor("yellowgreen")};var $n=ke(81),Gr=ke(748),Bt=ke(226);function ln(e){return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(e)}function mn(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pn(e,t)}function pn(e,t){return pn=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},pn(e,t)}function fn(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=Ot(e);if(t){var i=Ot(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vr(this,n)}}function Vr(e,t){if(t&&(ln(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return dn(e)}function dn(e){if(e===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ot(e){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(e)}function He(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function Kn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qe(e,t,n){return t&&Kn(e.prototype,t),n&&Kn(e,n),e}var Ir=ot,At=(function(){function e(){He(this,e)}return qe(e,null,[{key:"createSVG",value:function(t,n,r,i,a,s,c){return new zr(t,n,r,i,a,s,c)}}]),e})(),yn=(function(){function e(t){He(this,e),this.xypicWrapper=t}return qe(e,[{key:"createElement",value:function(t){return this.xypicWrapper.svg(t)}},{key:"createGroup",value:function(t){return new Wr(this,t)}},{key:"createChangeColorGroup",value:function(t){return new Nr(this,t)}},{key:"createSVGElement",value:function(t,n){var r=this.createElement(t);if(n){for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].toString();i==="xlink:href"?this.xypicWrapper.setAttribute(r,i,a,"http://www.w3.org/1999/xlink"):this.xypicWrapper.setAttribute(r,i,a)}}return this.appendChild(r),r}},{key:"appendChild",value:function(t){return this.xypicWrapper.adaptor.append(this.drawArea,t),t}},{key:"transformBuilder",value:function(){return new Qr}}]),e})(),zr=(function(e){mn(n,e);var t=fn(n);function n(r,i,a,s,c,l,h){var m;He(this,n);var p=(m=t.call(this,r)).createElement("svg");if(m.xypicWrapper.setAttribute(p,"xmlns","http://www.w3.org/2000/svg"),m.xypicWrapper.setAttribute(p,"version","1.1"),h)for(var f in h)h.hasOwnProperty(f)&&m.xypicWrapper.setAttribute(p,f,h[f].toString());for(var y in p.style&&(p.style.width=o.measure.Em(s),p.style.height=o.measure.Em(i+a)),h={fill:"none",stroke:l,"stroke-linecap":"round","stroke-width":o.measure.em2px(c)},m.drawArea=m.createElement("g"),h)h.hasOwnProperty(y)&&m.xypicWrapper.setAttribute(m.drawArea,y,h[y].toString());return m.xypicWrapper.append(p,m.drawArea),m.svg=p,m.boundingBox=void 0,m.color=l,m}return qe(n,[{key:"setHeight",value:function(r){this.xypicWrapper.setStyle(this.svg,"height",o.measure.Em(r))}},{key:"setWidth",value:function(r){this.xypicWrapper.setStyle(this.svg,"width",o.measure.Em(r))}},{key:"setAttribute",value:function(r,i){this.xypicWrapper.setAttribute(this.svg,r,i.toString())}},{key:"extendBoundingBox",value:function(r){this.boundingBox=O.combineRect(this.boundingBox,r)}},{key:"getOrigin",value:function(){return{x:0,y:0}}},{key:"getCurrentColor",value:function(){return this.color}}]),n})(yn),Qr=(function(){function e(t){He(this,e),this.transform=t||j.empty}return qe(e,[{key:"translate",value:function(t,n){return new e(this.transform.append(new _r(t,n)))}},{key:"rotateDegree",value:function(t){return new e(this.transform.append(new er(t/180*Math.PI)))}},{key:"rotateRadian",value:function(t){return new e(this.transform.append(new er(t)))}},{key:"toString",value:function(){var t="";return this.transform.foreach((function(n){t+=n.toTranslateForm()})),t}},{key:"apply",value:function(t,n){var r={x:t,y:n};return this.transform.foreach((function(i){r=i.apply(r.x,r.y)})),r}}]),e})(),_r=(function(){function e(t,n){He(this,e),this.dx=t,this.dy=n}return qe(e,[{key:"apply",value:function(t,n){return{x:t-this.dx,y:n+this.dy}}},{key:"toTranslateForm",value:function(){return"translate("+o.measure.em2px(this.dx)+","+o.measure.em2px(-this.dy)+") "}}]),e})(),er=(function(){function e(t){He(this,e),this.radian=t}return qe(e,[{key:"apply",value:function(t,n){var r=Math.cos(this.radian),i=Math.sin(this.radian);return{x:r*t+i*n,y:-i*t+r*n}}},{key:"toTranslateForm",value:function(){return"rotate("+Ir(-180*this.radian/Math.PI)+") "}}]),e})(),Wr=(function(e){mn(n,e);var t=fn(n);function n(r,i){var a;He(this,n),(a=t.call(this,r.xypicWrapper)).parent=r,a.drawArea=r.createSVGElement("g",i===void 0?{}:{transform:i.toString()});var s=r.getOrigin();return a.origin=i===void 0?s:i.apply(s.x,s.y),F(dn(a),"getCurrentColor"),a}return qe(n,[{key:"remove",value:function(){this.xypicWrapper.remove(this.drawArea)}},{key:"extendBoundingBox",value:function(r){this.parent.extendBoundingBox(r)}},{key:"getOrigin",value:function(){return this.origin}},{key:"getCurrentColor",value:function(){return this.parent.getCurrentColor()}}]),n})(yn),Nr=(function(e){mn(n,e);var t=fn(n);function n(r,i){var a;return He(this,n),(a=t.call(this,r.xypicWrapper)).parent=r,a.drawArea=r.createSVGElement("g",{stroke:i}),a.color=i,F(dn(a),"getOrigin"),a}return qe(n,[{key:"remove",value:function(){this.xypicWrapper.remove(this.drawArea)}},{key:"extendBoundingBox",value:function(r){this.parent.extendBoundingBox(r)}},{key:"getOrigin",value:function(){return this.parent.getOrigin()}},{key:"getCurrentColor",value:function(){return this.color}}]),n})(yn);function vn(e){return vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vn(e)}function Ur(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(function(l,h){if(l){if(typeof l=="string")return tr(l,h);var m=Object.prototype.toString.call(l).slice(8,-1);if(m==="Object"&&l.constructor&&(m=l.constructor.name),m==="Map"||m==="Set")return Array.from(l);if(m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return tr(l,h)}})(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var l=n.next();return s=l.done,l},e:function(l){c=!0,a=l},f:function(){try{s||n.return==null||n.return()}finally{if(c)throw a}}}}function tr(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Et(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lt(e,t,n){return t&&nr(e.prototype,t),n&&nr(e,n),e}function jt(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}function xn(e,t){return xn=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},xn(e,t)}function Dt(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=Tt(e);if(t){var i=Tt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Xr(this,n)}}function Xr(e,t){if(t&&(vn(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Tt(e)}var Hr="http://www.w3.org/2000/svg",ct=ot;function rr(e,t){var n=(function(s){jt(l,s);var c=Dt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;Et(this,l),p=c.call(this,h,m,f);for(var y=o.wrapperOfTextObjectMap,x=m.textMmls,w=p.childNodes,b=x.length,P=0;P<b;P++){var M=x[P].xypicTextObjectId;y[M]=w[P]}return p._textObjects=[],p}return Lt(l,[{key:"getElement",value:function(){return this.chtml}},{key:"appendTextObject",value:function(h){this._textObjects.push(h)}},{key:"getChildWrapper",value:function(h){var m=h.xypicTextObjectId;if(m==null)throw ye("IllegalStateError","BUG");var p=o.wrapperOfTextObjectMap[m];if(p==null)throw ye("IllegalStateError","unknown textObjectId:"+m);return p}},{key:"toCHTML",value:function(h){var m=o.svgForDebug,p=o.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this._toCHTML(h),o.svgForDebug=m,o.svgForTestLayout=p}},{key:"setupMeasure",value:function(h){var m=ot,p=h.length2em("1em"),f=parseFloat(h.px(100).replace("px",""))/100,y=h.font.params.axis_height,x=h.length2em("0.15em"),w=function(b){return Math.round(parseFloat(h.px(100*b).replace("px","")))/100};o.measure={length2em:function(b){return m(h.length2em(b))},oneem:p,em2length:function(b){return m(b/p)+"em"},Em:function(b){return h.em(b)},em:f,em2px:w,axis_height:y,strokeWidth:h.length2em("0.04em"),thickness:x,jot:h.length2em("3pt"),objectmargin:h.length2em("3pt"),objectwidth:h.length2em("0pt"),objectheight:h.length2em("0pt"),labelmargin:h.length2em("2.5pt"),turnradius:h.length2em("10pt"),lineElementLength:h.length2em("5pt"),axisHeightLength:y*h.length2em("10pt"),dottedDasharray:p+" "+w(x)}}},{key:"append",value:function(h,m){this.adaptor.append(h,m)}},{key:"remove",value:function(h){this.adaptor.remove(h)}},{key:"svg",value:function(h){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return this.adaptor.node(h,m,p,Hr)}},{key:"setAttribute",value:function(h,m,p,f){return this.adaptor.setAttribute(h,m,p,f)}},{key:"setStyle",value:function(h,m,p){this.adaptor.setStyle(h,m,p)}},{key:"drawTextObject",value:function(h,m,p){var f=o.measure.length2em("0.2em"),y=m.xypicWrapper,x=y.getChildWrapper(h.math),w=x.adaptor,b=x.getBBox(),P=b.scale,M=(b.h+f)*P,B=(b.d+f)*P,A=(b.w+2*f)*P,R=(M+B)/2,U=A/2,T=h.c;if(h.originalBBox={H:M,D:B,W:A},!p){var L=x.html("mjx-xypic-object");w.append(y.getElement(),L),w.setStyle(L,"color",m.getCurrentColor()),x.toCHTML(L);var X=m.getOrigin();w.setAttribute(L,"data-x",T.x-U-X.x+f*P),w.setAttribute(L,"data-y",-T.y-R-X.y+f*P),w.setAttribute(L,"data-xypic-id",h.math.xypicTextObjectId),y.appendTextObject(L)}return T.toRect({u:R,d:R,l:U,r:U})}}]),l})(e),r=(function(s){jt(l,s);var c=Dt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Et(this,l),(p=c.call(this,h,m,f)).shape=null,p}return Lt(l,[{key:"computeBBox",value:function(h){h.empty();var m=this.node.cmd;if(m){var p=this.length2em("0.2em");if(this.shape==null){var f=o.svgForDebug,y=o.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this.adaptor;var x=o.measure.strokeWidth,w=1,b=0,P=1,M=o.measure.em2px,B="black",A=At.createSVG(this,w,b,P,x,B,{viewBox:[0,-M(w+b),M(P),M(w+b)].join(" "),role:"img",focusable:!1,overflow:"visible"});o.svgForDebug=A,o.svgForTestLayout=A;var R=new be,U=new le(d.none,R);m.toShape(U),this.shape=U.shape,o.svgForDebug=f,o.svgForTestLayout=y}var T=this.shape,L=T.getBoundingBox();L!==void 0&&(L=new O.Rect(0,0,{l:Math.max(0,-(L.x-L.l)),r:Math.max(0,L.x+L.r),u:Math.max(0,L.y+L.u),d:Math.max(0,-(L.y-L.d))}),h.updateFrom(new Bt.bK({w:L.l+L.r+2*p,h:L.u+2*p,d:L.d})))}}},{key:"kind",get:function(){return u.xypic.prototype.kind}},{key:"_toCHTML",value:function(h){var m=this.standardCHTMLnode(h);this.cthml=m;var p=this.adaptor,f=this.length2em("0.2em"),y=o.measure.strokeWidth,x=1,w=0,b=1,P=o.measure.em2px,M=At.createSVG(this,x,w,b,y,"black",{viewBox:[0,-P(x+w),P(b),P(x+w)].join(" "),role:"img",focusable:!1,overflow:"visible"});o.svgForDebug=M,o.svgForTestLayout=M,p.append(m,M.svg);var B=this.node.cmd;if(B){if(this.shape==null){var A=new be,R=new le(d.none,A);B.toShape(R),this.shape=R.shape}var U=this.shape;U.draw(M);var T=U.getBoundingBox();if(T!==void 0){var L=(T=new O.Rect(0,0,{l:Math.max(0,-(T.x-T.l)),r:Math.max(0,T.x+T.r),u:Math.max(0,T.y+T.u),d:Math.max(0,-(T.y-T.d))})).x-T.l-f,X=-T.y-T.u-f,q=T.l+T.r+2*f,J=T.u+T.d+2*f;M.setWidth(q),M.setHeight(J),M.setAttribute("viewBox",[P(L),P(X),P(q),P(J)].join(" ")),p.setStyle(m,"vertical-align",ct(-T.d-f+o.measure.axis_height)+"em");var Y,ee=Ur(this._textObjects);try{for(ee.s();!(Y=ee.n()).done;){var re=Y.value,$=parseFloat(p.getAttribute(re,"data-x")),ue=parseFloat(p.getAttribute(re,"data-y"));p.setStyle(re,"left",ct($-L)+"em"),p.setStyle(re,"top",ct(ue+T.y-T.d-.5*f)+"em")}}catch(me){ee.e(me)}finally{ee.f()}}else p.remove(M.svg)}else p.remove(M.svg)}}],[{key:"styles",get:function(){return{"mjx-xypic path":{"stroke-width":"inherit"},".MathJax mjx-xypic path":{"stroke-width":"inherit"},"mjx-xypic-object":{"text-align":"center",position:"absolute"},"mjx-xypic":{position:"relative"}}}}]),l})(n);t[r.prototype.kind]=r;var i=(function(s){jt(l,s);var c=Dt(l);function l(h,m){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Et(this,l),c.call(this,h,m,p)}return Lt(l,[{key:"kind",get:function(){return u.xypic.newdir.prototype.kind}},{key:"_toCHTML",value:function(h){var m=this.node.cmd;o.repositories.dirRepository.put(m.dirMain,m.compositeObject)}}]),l})(n);t[i.prototype.kind]=i;var a=(function(s){jt(l,s);var c=Dt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Et(this,l),(p=c.call(this,h,m,f))._setupGraphics(),p.computeBBox(p.bbox),p.bboxComputed=!0,p}return Lt(l,[{key:"kind",get:function(){return u.xypic.includegraphics.prototype.kind}},{key:"_setupGraphics",value:function(){this.setupMeasure(this);var h=new be,m=new le(d.none,h),p=this.node.cmd;if(p.setup(m),!h.includegraphicsWidth.isDefined||!h.includegraphicsHeight.isDefined)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");var f=h.includegraphicsWidth.get,y=h.includegraphicsHeight.get;this.imageWidth=this.length2em(f),this.imageHeight=this.length2em(y),this.filepath=p.filepath}},{key:"computeBBox",value:function(h){h.empty(),h.updateFrom(new Bt.bK({w:this.imageWidth,h:this.imageHeight,d:0}))}},{key:"_toCHTML",value:function(h){var m=this.standardCHTMLnode(h);this.cthml=m,this.adaptor.setStyle(m,"position","relative"),this.adaptor.setStyle(m,"vertical-align","0em");var p=this.html("img");this.adaptor.setAttribute(p,"src",this.filepath),this.adaptor.setStyle(p,"width",ct(this.imageWidth)+"em"),this.adaptor.setStyle(p,"height",ct(this.imageHeight)+"em"),this.adaptor.append(m,p)}}]),l})(n);t[a.prototype.kind]=a}$n.wO!==void 0&&rr($n.wO,Gr.w);var ir=ke(952),qr=ke(84);function gn(e){return gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(e)}function Jr(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(function(l,h){if(l){if(typeof l=="string")return ar(l,h);var m=Object.prototype.toString.call(l).slice(8,-1);if(m==="Object"&&l.constructor&&(m=l.constructor.name),m==="Map"||m==="Set")return Array.from(l);if(m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m))return ar(l,h)}})(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(l){throw l},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var l=n.next();return s=l.done,l},e:function(l){c=!0,a=l},f:function(){try{s||n.return==null||n.return()}finally{if(c)throw a}}}}function ar(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Rt(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e,t,n){return t&&or(e.prototype,t),n&&or(e,n),e}function Gt(e,t){if(typeof t!="function"&&t!==null)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}function wn(e,t){return wn=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},wn(e,t)}function Vt(e){var t=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})();return function(){var n,r=It(e);if(t){var i=It(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Zr(this,n)}}function Zr(e,t){if(t&&(gn(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw TypeError("Derived constructors may only return object or undefined");return(function(n){if(n===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n})(e)}function It(e){return It=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},It(e)}var Yr="http://www.w3.org/2000/svg",Sn=ot;function ur(e,t){var n=(function(s){Gt(l,s);var c=Vt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;Rt(this,l),p=c.call(this,h,m,f);for(var y=o.wrapperOfTextObjectMap,x=m.textMmls,w=p.childNodes,b=x.length,P=0;P<b;P++){var M=x[P].xypicTextObjectId;y[M]=w[P]}return p._textObjects=[],p}return Ft(l,[{key:"getElement",value:function(){return this.svgNode}},{key:"appendTextObject",value:function(h){this._textObjects.push(h)}},{key:"getChildWrapper",value:function(h){var m=h.xypicTextObjectId;if(m==null)throw ye("IllegalStateError","BUG");var p=o.wrapperOfTextObjectMap[m];if(p==null)throw ye("IllegalStateError","unknown textObjectId:"+m);return p}},{key:"toSVG",value:function(h){var m=o.svgForDebug,p=o.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this._toSVG(h),o.svgForDebug=m,o.svgForTestLayout=p}},{key:"setupMeasure",value:function(h){var m=ot,p=h.length2em("1em"),f=parseFloat(h.px(100).replace("px",""))/100,y=h.font.params.axis_height,x=h.length2em("0.15em"),w=function(b){return Math.round(parseFloat(h.px(100*b).replace("px","")))/100};o.measure={length2em:function(b){return m(h.length2em(b))},oneem:p,em2length:function(b){return m(b/p)+"em"},Em:function(b){return h.em(b)},em:f,em2px:w,axis_height:y,strokeWidth:h.length2em("0.04em"),thickness:x,jot:h.length2em("3pt"),objectmargin:h.length2em("3pt"),objectwidth:h.length2em("0pt"),objectheight:h.length2em("0pt"),labelmargin:h.length2em("2.5pt"),turnradius:h.length2em("10pt"),lineElementLength:h.length2em("5pt"),axisHeightLength:y*h.length2em("10pt"),dottedDasharray:p+" "+w(x)}}},{key:"append",value:function(h,m){this.adaptor.append(h,m)}},{key:"remove",value:function(h){this.adaptor.remove(h)}},{key:"svg",value:function(h){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return this.adaptor.node(h,m,p,Yr)}},{key:"setAttribute",value:function(h,m,p,f){return this.adaptor.setAttribute(h,m,p,f)}},{key:"setStyle",value:function(h,m,p){this.adaptor.setStyle(h,m,p)}},{key:"drawTextObject",value:function(h,m,p){var f=o.measure.length2em("0.2em"),y=m.xypicWrapper,x=y.getChildWrapper(h.math),w=x.adaptor,b=x.getBBox(),P=b.scale,M=(b.h+f)*P,B=(b.d+f)*P,A=(b.w+2*f)*P,R=(M+B)/2,U=A/2,T=h.c;if(h.originalBBox={H:M,D:B,W:A},!p){var L=x.svg("g");w.append(y.getElement(),L),w.setAttribute(L,"stroke",m.getCurrentColor()),w.setAttribute(L,"fill",m.getCurrentColor()),x.toSVG(L);var X=m.getOrigin();w.setAttribute(L,"data-x",T.x-U-X.x+f*P),w.setAttribute(L,"data-y",-T.y+(M-B)/2-X.y),w.setAttribute(L,"data-xypic-id",h.math.xypicTextObjectId),y.appendTextObject(L)}return T.toRect({u:R,d:R,l:U,r:U})}}]),l})(e),r=(function(s){Gt(l,s);var c=Vt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Rt(this,l),(p=c.call(this,h,m,f)).shape=null,p}return Ft(l,[{key:"computeBBox",value:function(h){h.empty();var m=this.node.cmd;if(m){var p=this.length2em("0.2em");if(this.shape==null){var f=o.svgForDebug,y=o.svgForTestLayout;this._textObjects=[],this.setupMeasure(this),this.adaptor;var x=o.measure.strokeWidth,w=1,b=0,P=1,M=o.measure.em2px,B="black",A=At.createSVG(this,w,b,P,x,B,{viewBox:[0,-M(w+b),M(P),M(w+b)].join(" "),role:"img",focusable:!1,overflow:"visible"});o.svgForDebug=A,o.svgForTestLayout=A;var R=new be,U=new le(d.none,R);m.toShape(U),this.shape=U.shape,o.svgForDebug=f,o.svgForTestLayout=y}var T=this.shape,L=T.getBoundingBox();L!==void 0&&(L=new O.Rect(0,0,{l:Math.max(0,-(L.x-L.l)),r:Math.max(0,L.x+L.r),u:Math.max(0,L.y+L.u),d:Math.max(0,-(L.y-L.d))}),h.updateFrom(new Bt.bK({w:L.l+L.r+2*p,h:L.u+2*p,d:L.d})))}}},{key:"kind",get:function(){return u.xypic.prototype.kind}},{key:"_toSVG",value:function(h){var m=this.standardSVGnode(h);this.svgNode=m;var p=this.adaptor,f=this.length2em("0.2em"),y=o.measure.strokeWidth,x=1,w=0,b=1,P=o.measure.em2px,M=At.createSVG(this,x,w,b,y,"black",{viewBox:[0,-P(x+w),P(b),P(x+w)].join(" "),role:"img",focusable:!1,overflow:"visible"});o.svgForDebug=M,o.svgForTestLayout=M,p.append(m,M.drawArea);var B=this.node.cmd;if(B){if(this.shape==null){var A=new be,R=new le(d.none,A);B.toShape(R),this.shape=R.shape}var U=this.shape;U.draw(M);var T=U.getBoundingBox();if(T!==void 0){var L=(T=new O.Rect(0,0,{l:Math.max(0,-(T.x-T.l)),r:Math.max(0,T.x+T.r),u:Math.max(0,T.y+T.u),d:Math.max(0,-(T.y-T.d))})).x-T.l-f,X=-T.y-T.u-f,q=T.l+T.r+2*f,J=T.u+T.d+2*f;M.setWidth(q),M.setHeight(J),M.setAttribute("viewBox",[P(L),P(X),P(q),P(J)].join(" "));var Y=this.fixed(1)/P(1);p.setAttribute(M.drawArea,"transform","translate("+this.fixed(-L)+","+this.fixed(T.y+o.measure.axis_height)+") scale("+Y+", "+-Y+")");var ee,re=Jr(this._textObjects);try{for(re.s();!(ee=re.n()).done;){var $=ee.value,ue=parseFloat(p.getAttribute($,"data-x")),me=parseFloat(p.getAttribute($,"data-y")),ie=ue-L,he=-me+T.y+o.measure.axis_height;this.place(ie,he,$)}}catch(ae){re.e(ae)}finally{re.f()}}else p.remove(M.drawArea)}else p.remove(M.drawArea)}}],[{key:"styles",get:function(){return{'g[data-mml-node="xypic"] path':{"stroke-width":"inherit"},'.MathJax g[data-mml-node="xypic"] path':{"stroke-width":"inherit"}}}}]),l})(n);t[r.prototype.kind]=r;var i=(function(s){Gt(l,s);var c=Vt(l);function l(h,m){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Rt(this,l),c.call(this,h,m,p)}return Ft(l,[{key:"kind",get:function(){return u.xypic.newdir.prototype.kind}},{key:"computeBBox",value:function(h){var m=this.node.cmd;o.repositories.dirRepository.put(m.dirMain,m.compositeObject)}},{key:"_toSVG",value:function(h){var m=this.node.cmd;o.repositories.dirRepository.put(m.dirMain,m.compositeObject)}}]),l})(n);t[i.prototype.kind]=i;var a=(function(s){Gt(l,s);var c=Vt(l);function l(h,m){var p,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return Rt(this,l),(p=c.call(this,h,m,f))._setupGraphics(),p.computeBBox(p.bbox),p.bboxComputed=!0,p}return Ft(l,[{key:"kind",get:function(){return u.xypic.includegraphics.prototype.kind}},{key:"_setupGraphics",value:function(){this.setupMeasure(this);var h=new be,m=new le(d.none,h),p=this.node.cmd;if(p.setup(m),!h.includegraphicsWidth.isDefined||!h.includegraphicsHeight.isDefined)throw ye("ExecutionError","the 'width' and 'height' attributes of the \\includegraphics are required.");var f=h.includegraphicsWidth.get,y=h.includegraphicsHeight.get;this.imageWidth=this.length2em(f),this.imageHeight=this.length2em(y),this.filepath=p.filepath}},{key:"computeBBox",value:function(h){h.empty(),h.updateFrom(new Bt.bK({w:this.imageWidth,h:this.imageHeight,d:0}))}},{key:"_toSVG",value:function(h){var m=this.standardSVGnode(h);this.svgNode=m;var p=this.fixed(1),f=this.svg("image",{x:"0",y:"0",preserveAspectRatio:"none",width:Sn(this.imageWidth),height:Sn(this.imageHeight),transform:"scale("+p+","+-p+") translate(0,"+Sn(-this.imageHeight)+")"});this.adaptor.setAttribute(f,"xlink:href",this.filepath,"http://www.w3.org/1999/xlink"),this.adaptor.append(m,f)}}]),l})(n);t[a.prototype.kind]=a}ir.y!==void 0&&ur(ir.y,qr.N);var bn=MathJax._.components.loader.Loader;bn&&(MathJax._.output.chtml.Wrapper.CHTMLWrapper||bn.ready("output/chtml").then((function(){var e=MathJax._.output.chtml;rr(e.Wrapper.CHTMLWrapper,e.Wrappers_ts.CHTMLWrappers)})).catch((function(e){return console.log("Caught",e)})),MathJax._.output.svg.Wrapper.SVGWrapper||bn.ready("output/svg").then((function(){var e=MathJax._.output.svg;ur(e.Wrapper.SVGWrapper,e.Wrappers_ts.SVGWrappers)})).catch((function(e){return console.log("Caught",e)})))})()})()),hr}var mr=ei();const ti=$r(mr),ri=Kr({__proto__:null,default:ti},[mr]);export{ri as x};
